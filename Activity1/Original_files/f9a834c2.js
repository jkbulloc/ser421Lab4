(function(){var nt,tt,c,r,l,v,k,w,u,it,ft,o,et,ot;try{var f=window.$MicrosoftMaps8,t=f.Internal,bt=f.Anchor,d=t.CanvasDrawingContext,a=t._CanvasLabelRenderer,ht=t._Color,ct=f.CoordinateProjection,e=t._Debug,lt=t._EntityHelper,s=f.GlobalConfig,h=t._Gimme,n=t._Helper,kt=t._IconLabel,dt=t.HitTestIndex,gt=t._LabelData,ni=s.features.labels,rt=t._LruCache,ti=f.Matrix2D,at=t._NAARectangle,ii=t._Observable,y=f.Point,vt=f.Rectangle,ri=t.RelativePlacement,ut=f.Size,ui=f.Viewport,fi=f.ZoomLevel,yt=f.VectorImageTemplate,ei=f.VectorMapLayer,i=t._VectorMath,oi=t._WorkDispatcher,si=t._LayerRendererManager,hi=t.LabelRenderer,pt=t.LabelController,wt=t.VectorLabels,p=t._VectorLayerRenderer,b=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),g=function(t){function i(n,i,r,u,f){var e=t.call(this,n,i,r,u,f)||this;return h.Browser.is_safari&&h(window).add_event("pagehide",function(){e.dispose()}),e}return b(i,t),i.prototype.transformContainer=function(i){var r=t.prototype.transformContainer.call(this,i);return n._renderAllPoiAndLabelsGL()&&this._adapter&&this._adapter.render(this._map,null,null,null,0,!0,n._getDpr(),0),r},i.prototype.copyCanvas=function(n){var i,r;t.prototype.copyCanvas.call(this,n);i=this._adapter;i&&(i.draw(this._map),r=i.getCanvas()[0],n.drawImage(r,0,0,r.width,r.height))},i.prototype.dispose=function(){t.prototype.dispose.call(this);this._canvasGL&&this._canvasGL.removeFromParent();n._clearDisposables([this._adapter,this._frameLoadedHandler]);n._nullifyClass(this)},i.prototype._positionCanvas=function(r,u){var f=this,e=t.prototype._positionCanvas.call(this,r),o=this._renderEntityTypes.indexOf(1)>-1,c,l,a;return r||(c=this._adapter,l=n._renderAllPoiAndLabelsGL(),c?l&&c.updateSize(e):i._adapterFailed||(a=function(){f._appendCanvas();try{var r=o?2048:256,t=s.features.labels;f._adapter=new it(f._canvasGL,e,r,!1,t.allowSoftwareGL,h.Browser.is_safari,t.preserveGLBuffer);i._adapterFailed=!1}catch(u){console.warn(u);n._disableRenderGL();i._adapterFailed=!0}},l&&(o||u)?a():this._frameLoadedHandler||o&&(this._frameLoadedHandler=this._map.getFrameManager().frameRendered.addOne(a)))),e},i.prototype._drawLabels=function(r,u,f){var s,it,c,l,v,rt,y,h,g,o,ft;if(n._renderAllPoiAndLabelsGL()){var nt=i._dataUpdateLevel(u,f),p=this._orderedLabels,w=a._getSortedPriorityKeys(Object.keys(p)),tt={},b=[];for(e.clearTestHooksLog(e.LabelDrawOrderTag),s=0,it=w.length;s<it;s++){if(c=p[w[s]],l=Object.keys(c),!l.length){delete p[w[s]];continue}for(v=0,rt=l.length;v<rt;v++){var ut=l[v],k=c[ut],d=Object.keys(k);if(d.length)for(y=d.length-1;y>=0;y--)(h=d[y],r||nt!==0||(g=k[h],o=g&&g.region,!o||o.type!==1||(ft=o&&o.label&&o.label.data&&o.label.data.primitives&&o.label.data.primitives[0],ft.taintedTemplate||!n._renderAllPoiAndLabelsGL())))&&(tt[h]=k[h],b.unshift(h));else delete c[ut]}}b.length>0?(this._positionCanvas(u,!0),this._drawLabelsInLayerGL(tt,b,r,u,this._drawingContext,this._dpiScale,f,nt)):this._adapter&&this._adapter.clear()}else t.prototype._drawLabels.call(this,r,u,f),this._adapter&&this._adapter.clear()},i.prototype._appendCanvas=function(){var i=this,t;this._canvasGL||(t=this._canvasGL=n._createElement("canvas"),t.set_attr("id",this._canvasId),t.set_attr("class","labelCanvas"),t.set_style({outline:"none",position:"absolute",zIndex:this._canvasZIndex}),this._map.getMode().getRootElement().append(t),h(t).add_event("webglcontextlost",function(n){i._handleRenderFailure(n)},!1))},i.prototype._handleRenderFailure=function(r){console.warn(r);n._disableRenderGL();i._adapterFailed=!0;this._adapter&&(this._adapter.dispose(),this._adapter=null);t.prototype.endDraw.call(this,this._currentLabelRenderingContext,this._isAnimationFrame)},i.prototype._drawLabelsInLayerGL=function(i,r,u,f,o,s,h,c){var w,l,y,a,v,nt,b;this._isAnimationFrame=f;var k=0,d=[],g=o?o.getDevicePixelRatio():n._getDpr(),p,tt=this._adapter&&n._renderAllPoiAndLabelsGL();for(w=r.length-1;w>=0;w--)if(l=i[r[w]],e.logLabelDrawOrder(l.text),y=l.region,a=y.label.data.primitives[0],p=null,v=l.iconTemplates,!u||(nt=v&&v[0],b=lt.getClickable(a&&a.entity),b||(b=nt&&nt.getIsHitTestable()),b&&a&&a.layer)){if(y.type===1){if(!v||!v.length)continue;e.logPoiLayerStyleStart();u?this._renderHitTesting(v,a,l,y):p=this._renderTemplates(o,g,v,a,l,s,y,c);e.logPoiLayerStyleEnd(e.UserLogTag);e.logPushpinPrimitive(e.UserLogTag,a)}else l.style&&(tt?k+=this._drawTextLabelGL(l,g,u,f,d):t.prototype._drawTextLabel.call(this,l,u,f));p&&(d.push(p),p.cached||k++);t.prototype._renderDebugLabelBoundaries.call(this,u,y,o,s)}if(!u&&this._adapter)try{this._adapter.render(this._map,h,d,null,k,f,g,c)}catch(it){this._handleRenderFailure(it)}},i.prototype._renderTemplates=function(i,r,u,f,e,o,s,h){var c,y=this._adapter&&!f.taintedTemplate&&n._renderAllPoiAndLabelsGL(),a=s.anchor.x*o,v=s.anchor.y*o;return y?h!==0&&(c=l.packGLTemplates(i,this._adapter,r,u,f,e,o,a,v)):(f.taintedTemplate&&(this._taintedTemplatesExists=!0,t.prototype._validate2DCanvas.call(this)),l.renderCanvasTemplates(i,u,f,e,o,a,v)),c},i.prototype._drawTextLabelGL=function(r,u,f,e,o){for(var s,y,p,l=this._adapter&&this._adapter.currentData&&this._adapter.currentData.atlas.records,h,c,w=t.prototype._getTextLabelData.call(this,r,f,e,u),b=0,k=r.region.anchor,v=0,d=w.labels.length;v<d;v++)if(s=w.labels[v],s.text.trim().length!==0){c=s.text+s.font+s.style.styleDynamic.fontColor+s.rotation+s.outlineColor+s.outlineSize+s.relativePlacement+s.horizontalAlignment;y=l&&l.getItem(c);y?(h=n._copyObject(y),h.cached=!0):h=i._constructTextRecord(s,u,c);p=0;switch(s.horizontalAlignment){case 2:p=-a._hintLabelPadding*u}h.left=(s.x+s.anchorOffetX+h.adjustX+p)/u;h.top=(s.y+s.anchorOffetY+h.adjustY)/u;h.anchor=k;h.cached||(l.addItem(c,h),b++);h.visibleZoom=0;o.push(h)}return b},i._dataUpdateLevel=function(t,i){var r;if(i)if(t)r=n._renderAllPoiAndLabelsGL()?3:0;else switch(i.cause){case 7:r=0;break;case 3:r=2;default:r=4}else r=0;return r},i._constructTextRecord=function(n,t,r){var f,u,o=0,h=0,c=n.rotation,y,s,p;if(n.w*=t,n.h*=t,c===0)f=n.w,u=n.h;else{var w=vt.fromPoints({x:0,y:0},{x:n.w,y:n.h}),l=new at(w,c).bbox,e=l.minPoint,v=l.maxPoint;f=v.x-e.x;u=v.y-e.y;o=-e.x;h=-e.y}return y=a._getVerticalAdjustment(n.relativePlacement).verticalAdjustmentRatio*u,f=Math.ceil(f),f+=f%2,u=Math.ceil(u),u+=u%2,s=h+y,p=function(t,r,u){i._drawText(t,n,n.textBaseline,r+o,u+s)},{width:f,height:u,id:r,left:0,top:0,visibleZoom:0,adjustX:-o,adjustY:-s,renderLabel:p,atlasX:-1,atlasY:-1}},i._drawText=function(n,t,i,r,u){var f=n.getRawContext();switch(t.horizontalAlignment){default:case 1:f.textAlign="left";break;case 0:f.textAlign="center";r+=t.w/2;break;case 2:f.textAlign="right";r+=t.w}f.textBaseline=i;f.font=t.font;t.rotation!==0||t.resetFont?(n.save(),f.translate(r,u),f.rotate(t.rotation),a._strokeAndFillText(f,t.style,t.text,0,0,!1,t.glowColor,t.glowSize,t.outlineColor,t.outlineSize),n.restore(t.resetFont)):a._strokeAndFillText(f,t.style,t.text,r,u,!1,t.glowColor,t.glowSize,t.outlineColor,t.outlineSize)},i}(a);g.init();nt=function(){function n(t){n.isSupported(t.dashes)&&(this._attributes=t)}return n.isSupported=function(n){return n&&n.length>0&&n[0]===0},n.prototype.makeAtlasRecords=function(n,t,i,r,u){var e,f=this._attributes,o=f.outerWidth>f.width?f.outerWidth:f.width,s=f.rawColor+"_"+f.width+"_"+f.rawOuterColor+"_"+o*i;return e=n.records.getItem(s),e||(e={width:o*i,height:o*i,left:0,top:0,adjustX:0,adjustY:0,atlasX:-1,atlasY:-1,visibleZoom:-1,id:s},e.templateResults=[{resultImages:[this._constructCircle(o,i)]}]),c.generateRecords(e,this._attributes.dashes,i,t,r,u)},n.prototype._constructCircle=function(n,t){var r=this._attributes,u=new d(null,null,t),f=n/2,e=f,o=2*Math.PI,h=r.rawColor,s=r.rawOuterColor,i;return u.setSize(n,n),i=u.getRawContext(),s&&r.outerWidth>r.width&&(i.beginPath(),i.arc(f,e,r.outerWidth/2,0,o),i.fillStyle=s,i.fill(),i.closePath()),i.beginPath(),i.arc(f,e,r.width/2,0,o),i.fillStyle=h,i.fill(),i.closePath(),{width:n*t,height:n*t,drawX:0,drawY:0,source:u.getRootElement()[0]}},n}();tt=function(){function t(n,t,i,r,u){this._translation={};this.updateData(n,t,i,r,u)}return t.prototype.updateData=function(t,i,r,u,f){var e,o,s,h;this._gl=t;e=r.width>1?r.width:1;e=e>999?999:e;this._attributes=n._copyObject(r);this._attributes.width=e;o=t.canvas.width/2;s=t.canvas.height/2;e===1?this._lineStrip=c.generateBufferData(c.cleanData(i),o,s,u,f):e>=2&&(h=c.getTriangleStrip(i,r),this._innerTriangles=c.generateBufferData(h,o,s,u,f))},t.prototype.render=function(n,i,r,u,f){var e=this._gl,h={width:e.canvas.width/f,height:e.canvas.height/f},s;l.computeTranslate(u,h,r,this._translation);s=o.getMatrices(r,e.canvas.width,e.canvas.height,this._translation.translate.x*f,this._translation.translate.y*f);e.uniformMatrix4fv(n.u_PTMatrix,!1,s);this._lineStrip?((!this._lineStripBuffer||i)&&(this._lineStripBuffer=t._upsertBuffer(e,this._lineStripBuffer,this._lineStrip)),t._renderPass(e,n,e.LINE_STRIP,this._lineStripBuffer,this._attributes.color,4,this._lineStrip.length/4)):((!this._innerBuffer||i)&&(this._innerBuffer=t._upsertBuffer(e,this._innerBuffer,this._innerTriangles)),t._renderPass(e,n,e.TRIANGLE_STRIP,this._innerBuffer,this._attributes.color,4,this._innerTriangles.length/4))},t.prototype.dispose=function(){this._gl&&(this._innerBuffer&&this._gl.deleteBuffer(this._innerBuffer),this._lineStripBuffer&&this._gl.deleteBuffer(this._lineStripBuffer));this._gl=this._lineStripBuffer=this._innerBuffer=this._innerTriangles=this._lineStrip=null},t._upsertBuffer=function(n,t,i){return i&&i.length>0&&(t||(t=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,i,n.STATIC_DRAW)),t},t._renderPass=function(n,t,i,r,f,e,o){r&&(u.readBuffer(n,t.a_position,r,n.ARRAY_BUFFER,e,n.FLOAT,!1,0,0),n.uniform4f(t.u_color,f[0],f[1],f[2],f[3]),n.drawArrays(i,0,o))},t}(),function(t){function s(n,t){var r=e(n),s=r.length,f=[],l,g,k;if(s>1&&t.width>1&&t.width<999){var w=t.cap||"round",tt=t.join||"round",it=t.miterLimit||10,d=t.width/2,h=[],b=!0,a=t.cullface,o;if(s===2)y.pointsEqual(r[0],r[1])||f.push.apply(f,v(w,r[0],r[1],d,a));else{for(y.pointsEqual(r[0],r[s-1])&&(g=r.shift(),k=i.getMidpoint2D(g,r[0]),r.unshift(k),r.push(k),b=!1),s=r.length,o=0;o<s-1;o++)o===0?h.push(r[0]):o===s-2?h.push(r[s-1]):h.push(i.getMidpoint2D(r[o],r[o+1]));for(s=h.length,o=1;o<s;o++){var nt=o===1,rt=o===s-1,c=i.rotatingDirection(h[o-1],r[o],h[o])!==2;l=p(h[o-1],r[o],h[o],c,d,tt,it,nt,rt,a);b&&nt&&(c?f.push.apply(f,u(w,r[0],l[1]["export"](),l[0]["export"](),c,a)):f.push.apply(f,u(w,r[0],l[0]["export"](),l[1]["export"](),c,a)));f.push.apply(f,l)}s=f.length;b&&(c?f.push.apply(f,u(w,r[r.length-1],f[s-2]["export"](),f[s-1]["export"](),c,a)):f.push.apply(f,u(w,r[r.length-1],f[s-1]["export"](),f[s-2]["export"](),c,a)))}}return f}function e(n){var t=[],i,r;if(n&&n.length>0)for(i=0;i<n.length;i++)r=n[i],r&&!y.pointsEqual(r,t[t.length-1])&&t.push(r);return t}function h(n,t,i,u,f){for(var o=[],s=f.pixelScale,e=0;e<n.length;e++){var h=n[e]instanceof r,c=h?n[e].anchor:n[e],l=(c.x*u-t)/s,a=(i-c.y*u)/s;o.push(l);o.push(a);h?(o.push(n[e].offsetX*u),o.push(-n[e].offsetY*u)):o.push(0,0)}return new Float32Array(o)}function c(n,t,r,u,f,e){var rt=n.width/r,ut=rt/2,ft=t&&t.length>=2?t[1]:1,s,g,nt,y,p,h,ct;t=[0,ft];t=d.prepareLineDashes(t,rt,!1);var w=t[1],c=[],et=[],a,v,b,k;for(s=1;s<u.length;s++){if(g=u[s].x,nt=u[s].y,isNaN(a)||isNaN(v))b=u[s-1].x,k=u[s-1].y;else if(y=i.intersectLineCircle({x:u[s-1].x,y:u[s-1].y},{x:g,y:nt},{x:a,y:v},w),y&&y.length!==0)b=y[0].x,k=y[0].y;else continue;var tt=g-b,it=nt-k,ot=Math.atan2(it,tt),lt=Math.sqrt(tt*tt+it*it),at=Math.ceil(lt/w),st=Math.cos(ot)*w,ht=Math.sin(ot)*w;for(p=0;p<at;p++)a=b+p*st,v=k+p*ht,h=o(n,a,v,ut,f),ct=c.length,h.visibleZoom=l(ft,e,ct),c.push(h),h=o(n,a+st/2,v+ht/2,ut,f),h.visibleZoom=e+.5,et.push(h)}return c.push.apply(c,et),c}function o(t,i,r,u,f){var e=n._copyObject(t);return e.top=r-u,e.left=i-u,e.adjustX=e.adjustY=u,e.priority=f,e}function l(n,t,i){var r=f[n],u;for(r||(r=a(n),f[n]=r),u=0;u<3;u++){if(i%2==1)return t+r[u];i=i>>>1}return-1}function a(n){var t=(n-1)/(n/2),i=-t,u=[i],r=i,f=i-3;t<=0&&(t=.5);do r-=t,u.push(r);while(r>f);return u}function v(n,t,f,e,o){var h,c,s;if(t&&f){t.x>f.x&&(c=t,t=f,f=c);s=f.subtract(t);s=i.perpendicular2D(s).invert();s=i.normalizeVector2D(s).scalarMultiply(e);var l=new r(t,s.x,s.y),a=new r(t,-s.x,-s.y),v=new r(f,s.x,s.y),y=new r(f,-s.x,-s.y),p=[l,a,v,y];h=[];h.push.apply(h,u(n,t,a["export"](),l["export"](),!0,o));h.push.apply(h,p);h.push.apply(h,u(n,f,v["export"](),y["export"](),!0,o))}return h}function p(n,t,u,f,e,o,s,h,c,l){var y=[],a=t.subtract(n),st=i.getMagnitudeOfVector2D(a),v=u.subtract(t),ht=i.getMagnitudeOfVector2D(v),et,ot,it,rt;a=i.perpendicular2D(a);v=i.perpendicular2D(v);f&&(a=a.invert(),v=v.invert());a=i.normalizeVector2D(a).scalarMultiply(e);v=i.normalizeVector2D(v).scalarMultiply(e);var ut=new r(n,a.x,a.y),d=new r(t,a.x,a.y),ft=new r(u,v.x,v.y),nt=new r(t,v.x,v.y),tt=i.intersect2D(ut["export"](),d["export"](),ft["export"](),nt["export"]()),p,k=Number.MAX_VALUE;return tt&&(p=tt.subtract(t),k=i.getMagnitudeOfVector2D(p)),et=new r(n,-a.x,-a.y),ot=new r(u,-v.x,-v.y),k>st||k>ht?(it=new r(t,-a.x,-a.y),rt=new r(t,-v.x,-v.y)):it=rt=new r(t,-p.x,-p.y),y.push.apply(y,w(f,h,ut,et,d,it)),y.push.apply(y,g(o,t,d["export"](),nt["export"](),k,e,s,tt,f,l)),y.push.apply(y,b(f,c,nt,rt,ft,ot)),y}function w(n,t,i,r,u,f){var e=[];return n?(t&&(e.push(i),e.push(r)),e.push(u),e.push(f)):(t&&(e.push(r),e.push(i)),e.push(f),e.push(u)),e}function b(n,t,i,r,u,f){var e=[];return n?(e.push(i),e.push(r),t&&(e.push(u),e.push(f))):(e.push(r),e.push(u),t&&(e.push(f),e.push(u))),e}function u(n,t,i,r,u,f){var e;return n==="round"&&(e=k.sector(t,i,r,u,f)),e}function g(n,t,i,u,f,e,o,s,h,c){var l,p,a,v,y;return n==="round"?l=k.sector(t,i,u,h,c):(p=f/e,n==="bevel"||n==="miter"&&p>=o||!s?h||(a=i.subtract(u),l=[new r(t,0,0),new r(i,-a.x,-a.y)]):(v=i.subtract(s),y=new r(i,-v.x,-v.y),l=[y,y])),l}var f={};t.getTriangleStrip=s;t.cleanData=e;t.generateBufferData=h;t.generateRecords=c}(c||(c={}));r=function(){function n(n,t,i){this.anchor=n;this.offsetX=t;this.offsetY=i}return n.prototype["export"]=function(){return new y(this.anchor.x+this.offsetX,this.anchor.y+this.offsetY)},n}(),function(t){function i(n,t,i,r){var u;if(r){var f=0,e=0,o=t.width/2,s=t.height/2;r.viewportCenter&&(u=n.getMode().tryLocationToPoint(r.viewportCenter),f=u.x-o,e=s-u.y);var h=r.translate?r.translate.x:0,c=r.translate?r.translate.y:0,l=f/i.pixelScale,a=e/i.pixelScale;h+=l;c+=a;r.viewportCenter=n.getMode().tryPointToLocation(new y(o,s));r.translate={x:h,y:c}}}function r(i,r,u,s,h,c,l,a,v){var y,lt=c?c.text:"",k=f(s,lt,u),rt=r&&r.currentData&&r.currentData.atlas.records,ut=0,ft=0,et=0,ot=0,at=rt&&rt.getItem(k),w,p,b,vt,yt,d,nt,tt,st,ht,it,ct;if(at)y=n._copyObject(at),y.cached=!0;else{for(p=[],b=0,vt=s.length;b<vt;b++){if(yt=s[b],yt.tainted){h.taintedTemplate=!0;t.renderCanvasTemplates(i,s,h,c,l,a,v);p=null;break}if(w=s[b].renderData(u,{id:null,name:lt},0,0,l,e.UserLogTag,h),w&&w.resultImages&&w.resultImages.length>0){for(d=0;d<w.resultImages.length;d++){var g=w.resultImages[d],pt=g.drawX*u,wt=g.drawY*u;ut=Math.min(ut,pt);ft=Math.min(ft,wt);et=Math.max(et,pt+g.width);ot=Math.max(ot,wt+g.height)}p.push(w)}}nt=et-ut;tt=ot-ft;nt+=nt%2;tt+=tt%2;p.length===1&&p[0].resultImages.length===1?(st=p[0].resultImages[0].anchorAdjustX,ht=p[0].resultImages[0].anchorAdjustY):(it=c.region.anchor,ct=c.region.bounds.bbox.getCenter(),st=ct.x-it.x,ht=ct.y-it.y);y={width:nt,height:tt,id:k,left:0,top:0,visibleZoom:0,adjustX:Math.ceil(st),adjustY:Math.ceil(ht),templateResults:p,atlasX:-1,atlasY:-1}}return y.left=a-y.width/2/u+y.adjustX,y.top=v-y.height/2/u+y.adjustY,y.id=k,y.anchor=it,y.cached||rt.addItem(k,y),y.visibleZoom=o(h.visibilities),y}function u(n,t,i,r,u,f,o){for(var s=0,h=t.length;s<h;s++)t[s].renderCanvas(n,{id:null,name:r.text},f,o,u,e.UserLogTag,i)}function f(n,t,i){for(var r,u=[],f=!1,e=0;e<n.length;e++)r=n[e],!f&&r instanceof yt&&r.hasText&&(f=!0),r.id&&u.push(r.id+r.getScale());return(f?u.join()+t:u.join())+i}function o(n){var i=-1,t;if(n)for(i=0,t=0;t<n.length;t++)if(n[t].visible){i=n[t].zoom;break}return i}t.computeTranslate=i;t.packGLTemplates=r;t.renderCanvasTemplates=u}(l||(l={})),function(n){var t="precision mediump float;";n.textureVertex=t+"\n            attribute vec4 a_position;\n            attribute vec2 a_texCoord;\n            attribute float a_visibleZoom;\n\n            uniform mat4 u_PTMatrix;\n            uniform vec2 u_halfScreen;\n            uniform float u_extrusionScale;\n            uniform float u_zoom;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n                vec4 clipPosition= u_PTMatrix * vec4(a_position.xy, 0, 1);\n                float visibilityFlag = u_zoom < a_visibleZoom ? 0.0: 1.0;\n                vec2 clipSpaceExtrusion = a_position.zw / u_halfScreen * clipPosition.w * u_extrusionScale * visibilityFlag;\n                vec4 afterExtrusion = vec4(clipPosition.xy+clipSpaceExtrusion, clipPosition.z, clipPosition.w);\n                gl_Position = vec4(afterExtrusion.xy , clipPosition.z, clipPosition.w);\n\n                /* pass the texCoord to the fragment shader */\n                v_texCoord = a_texCoord;\n            }";n.textureFragment=t+"\n            /* our texture */\n            uniform sampler2D u_image;\n\n            /* the texCoords passed in from the vertex shader. */\n            varying vec2 v_texCoord;\n\n            void main() {\n            gl_FragColor = texture2D(u_image, v_texCoord);\n            }";n.solidColorVertex=t+"\n        attribute vec4 a_position;\n\n        uniform mat4 u_PTMatrix;\n        uniform vec2 u_halfScreen;\n        uniform vec4 u_color;\n\n        varying vec4 col;\n\n        void main() {\n            col = u_color;\n\n            vec4 clipPosition= u_PTMatrix * vec4(a_position.xy, 0, 1);\n            vec2 clipSpaceExtrusion = a_position.zw / u_halfScreen * clipPosition.w;\n        \n            vec4 afterExtrusion = vec4(clipPosition.xy+clipSpaceExtrusion, clipPosition.z, clipPosition.w);\n            gl_Position = vec4(afterExtrusion.xy , clipPosition.z, clipPosition.w);\n        }";n.solidColorFragment=t+"\n          varying vec4 col;\n           void main() {\n           gl_FragColor = col;\n        }"}(v||(v={})),function(n){function t(n,t,r,f,e){var o=i.twoPI;return o=-i.getAngleBetween(n,t,r),f?o>0&&(o-=i.twoPI):o<0&&(o=o+i.twoPI),u(n,t,o,f,e)}function u(n,t,u,f,e){var c=i.getMagnitudeOfVector2D(n.subtract(t)),s=[],h=Math.ceil(Math.abs(u*c)/4),p=-i.getAngleOfSegment2D(n,t),y,l,o,a,v;for(h+=h%2,y=u/h,l=new r(n,0,0),o=0;o<=h;o++)a=p+y*o,v=new r(n,c*Math.cos(a),-c*Math.sin(a)),f?(s.push(v),(e||o%2==0)&&s.push(l)):((e||o%2==0)&&s.push(l),s.push(v));return s}n.sector=t}(k||(k={})),function(n){function i(n,t,i,u){var l=n.records,s=[],a=Object.keys(l.getInternalDictionary()),e=n.state,h,v,o,c;for(e||(n.state=e={lastAllocatedIndex:-1,lastRowHeight:0,resumePoint:{x:0,y:0},size:new ut(t/2,t*2)}),h=0,v=a.length;h<v;h++)o=l.getItem(a[h]),o.cached&&o.atlasX!==-1&&o.atlasY!==-1||s.push(o);return e=n.state=f(s,e,1),c=e.lastAllocatedIndex===s.length-1,c&&!u&&e.updatedArea.w>0&&e.updatedArea.h>0&&r(n,s,i),c}function r(n,t,i){var r=n.context,f=n.state,o=f.size,l,e;if(r){var s=f.updatedArea.w,h=f.updatedArea.h,c=r.getSize();c.width===s&&c.height===h?r.clear():r.setSize(s,h)}else r=new d(null,null,1),r.setSize(o.width,o.height);for(n.context=r,l=t.length,e=0;e<l;e++)u(r,t[e],f.updatedArea.y,i)}function u(n,t,i,r){var e=t.templateResults,h,c,l,f,o;if(e&&(h=e.length)>0&&t.width>0&&t.height>0)for(c=t.atlasX+t.width/2,l=t.atlasY-i+t.height/2,f=0;f<h;f++)for(o=0;o<e[f].resultImages.length;o++){var u=e[f].resultImages[o],a=r*(u.drawX-t.adjustX)+c,v=r*(u.drawY-t.adjustY)+l,s;u.shadow&&(s=n.getStyle(),n.setStyle(u.shadow));n.drawImage(u.source,a,v,u.width,u.height);s&&n.setStyle(s)}else t.renderLabel&&t.renderLabel(n,t.atlasX,t.atlasY-i)}function f(n,i,r){function g(){var n;return o+u.height+r>w?n=!1:(o+=s+r,s=0,f=0,n=!0),n}var f=i.resumePoint.x,o=i.resumePoint.y,s=i.lastRowHeight,p=i.size.width,w=i.size.height,c=w,l=p,h=0,a=0,b,k,u;for(n.sort(t);h<n.length;)if(u=n[h],u&&(u.templateResults||u.renderLabel)&&u.width>0&&u.height>0)if(b=p-f-r,k=w-o-r,e(u,f,o,b,k))l=Math.min(f,l),c=Math.min(o,c),s=Math.max(u.height+r,s),f+=u.width+r,a=Math.max(a,f),h++,u.cached=!0;else if(g())a=p;else break;else h++;var d=o+s,v=a-l,y=d-c;return v=v>0?v:0,y=y>0?y:0,{lastAllocatedIndex:h-1,lastRowHeight:s,resumePoint:{x:0,y:d},size:i.size,updatedArea:{x:l,y:c,w:v,h:y}}}function e(n,t,i,r,u){return r>=n.width&&u>=n.height?(n.atlasX=t,n.atlasY=i,!0):!1}function t(n,t){var i=t.height-n.height;return i===0&&(i=t.width-n.width),i}n.build=i}(w||(w={})),function(n){function u(n,i,r,u,f){var s,e,o;if(window.WebGLRenderingContext){for(s={antialias:r,premultipliedAlpha:!0,preserveDrawingBuffer:u,stencil:!1,failIfMajorPerformanceCaveat:!i},o=0;o<t.length;o++)if(e=n.getContext(t[o],s),e)return e.enable(e.BLEND),f?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.clearColor(0,0,0,0),e;throw"WebGL initialization failed";}throw"Browser does not support WebGL";}function f(n){n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)}function e(n,t,i,r){var u;return u=t?t:n.createBuffer(),n.bindBuffer(i,u),n.bufferData(i,r,n.DYNAMIC_DRAW),u}function o(n,t,i,r,u,f,e,o,s){n.bindBuffer(r,i);n.enableVertexAttribArray(t);n.vertexAttribPointer(t,u,f,e,o,s)}function s(n,t,r){var u;return u=t?t:n.createTexture(),i(n,0,u),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),u}function h(n,t,r,u,f){return t&&(i(n,0,t),n.texSubImage2D(n.TEXTURE_2D,0,r,u,n.RGBA,n.UNSIGNED_BYTE,f)),t}function c(n,t,i){var u=n.createProgram();if(r(n,n.VERTEX_SHADER,t,u),r(n,n.FRAGMENT_SHADER,i,u),n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS))throw n.getProgramInfoLog(u);return u}function l(n,t,i,r,u){return t&&(n.bindBuffer(i,t),n.bufferSubData(i,r,u)),t}function i(n,t,i){n.activeTexture(n.TEXTURE0+t);n.bindTexture(n.TEXTURE_2D,i)}function r(n,t,i,r){var u=n.createShader(t);if(n.shaderSource(u,i),n.compileShader(u),!n.getShaderParameter(u,n.COMPILE_STATUS))throw n.getShaderInfoLog(u);n.attachShader(r,u);n.deleteShader(u)}var t=["webgl","experimental-webgl"];n.createContext=u;n.clear=f;n.uploadBuffer=e;n.readBuffer=o;n.createAndUploadTexture=s;n.updateTexture=h;n.createProgram=c;n.updateBuffer=l}(u||(u={}));it=function(){function t(n,t,i,r,f,e,o){var s=u.createContext(n[0],f,e||r,o),c=s.getParameter(s.MAX_TEXTURE_SIZE),h;if(!f&&c<8192)throw"Hardware texture size "+c+", does not meet the required texture size of 8192";this._context=s;this._canvas=n;this.updateSize(t);h=u.createProgram(s,v.textureVertex,v.textureFragment);this._program={glProgram:h,a_position:s.getAttribLocation(h,"a_position"),a_texCoord:s.getAttribLocation(h,"a_texCoord"),a_visibleZoom:s.getAttribLocation(h,"a_visibleZoom"),u_PTMatrix:s.getUniformLocation(h,"u_PTMatrix"),u_halfScreen:s.getUniformLocation(h,"u_halfScreen"),u_extrusionScale:s.getUniformLocation(h,"u_extrusionScale"),u_zoom:s.getUniformLocation(h,"u_zoom")};r&&(h=u.createProgram(s,v.solidColorVertex,v.solidColorFragment),this._vectorProgram={glProgram:h,a_position:s.getAttribLocation(h,"a_position"),u_PTMatrix:s.getUniformLocation(h,"u_PTMatrix"),u_halfScreen:s.getUniformLocation(h,"u_halfScreen"),u_color:s.getUniformLocation(h,"u_color")});this._maxTextureSize=i;this._initRenderData()}return t.prototype.render=function(t,i,r,u,f,e,s,h){var b=r&&r.length>0,c=this.currentData,y=u&&Object.keys(u).length>0,k=c&&c.polylineKeysToRender&&c.polylineKeysToRender.length>0,d=c&&c.textures.length>0,v;if(s=typeof s!="number"||s<=0?n._getDpr():s,d||b||y||k){var p=t.getMercatorZoomLevel(),w=this._context,a=o.getScale(p);c.dpr!==s&&(h=4,this._initRenderData(s));h===4&&y&&(v=this._buildVectorEntityData(u,s,a,p),r&&r.length>0?r.push.apply(r,v):r=v);(h===4||h===1)&&this._buildAndUpdateAtlas(w,r,f,0,s);(h===4||h===2||h===3)&&this._buildAndUploadRenderData(w,r,s,a,h);l.computeTranslate(t,this._canvas.get_size(),a,this.currentData.translation);this.draw(t,e)}},t.prototype._buildVectorEntityData=function(n,t,i,r){function it(n,t,i,r,u,f,e,o,s,h,c,l,a){var y=n.getItem(t),p,v;return y||(p=ht.parse(u),v={width:f,cap:e,join:o,color:[p.red/255,p.green/255,p.blue/255,p.alpha],dashes:c},c?(v.outerWidth=l,v.rawColor=u,v.rawOuterColor=a,y=new nt(v)):y=new tt(i,r,v,s,h),n.addItem(t,y)),y}var rt=this.currentData.polylineKeysToRender=[],s=this.currentData.polylineCache,o=[],h=[],f,l,ut,a,b,v,y,e,u,ft,k;for(f in n)if(n.hasOwnProperty(f)){var c=f+"_o",p=f+"_i",w=n[f];if(w){for(l=0,ut=w.length;l<ut;l++)for(a=w[l],b=a.shapes,v=0;v<b.length;v++)if(y=b[v],e=y.points,y.type===2&&e)if(u=y.style,u&&u.dashes&&u.dashes.length>0)ft=it(s,f,this._context,e,u.strokeStyle,u.lineWidth,d,g,t,i,u.dashes,u.secondaryLineWidth,u.secondaryStrokeStyle),k=ft.makeAtlasRecords(this.currentData.atlas,e,t,a.glPriority,r),a.glPriority===1?h.push.apply(h,k):o.push.apply(o,k);else{var d=u.lineCap,g=u.lineJoin,et=u.secondaryLineWidth;et?it(s,c,this._context,e,u.secondaryStrokeStyle,et,d,g,t,i):s.addItem(c,!0);it(s,p,this._context,e,u.strokeStyle,u.lineWidth,d,g,t,i);rt.push(c,p)}}else rt.push(c,p)}return this.currentData.vectorPriorityRecordCounter=h.length,o.push.apply(o,h),o},t.prototype.updateSize=function(t){var f=this._canvas.get_size(),i=this._context,e=n._getDpr(),r=t.width*e,u=t.height*e;(f.width!==t.width||f.height!==t.height||i.drawingBufferWidth!==r||i.drawingBufferHeight!==u)&&(this._canvas.set_style({width:t.width,height:t.height,left:0,top:0}),i.canvas.width=r,i.canvas.height=u,i.viewport(0,0,r,u))},t.prototype.getCanvas=function(){return this._canvas},t._prepareDraw=function(n,t,i,r){n.useProgram(t.glProgram);n.uniformMatrix4fv(t.u_PTMatrix,!1,i);n.uniform2f(t.u_halfScreen,n.canvas.width/2,n.canvas.height/2);typeof t.u_extrusionScale!="undefined"&&n.uniform1f(t.u_extrusionScale,1);typeof t.u_zoom!="undefined"&&n.uniform1f(t.u_zoom,r)},t._drawTextureEntities=function(n,i,r,f,e,s){var v;if(r.renderedRecords){var h=r.vectorPriorityRecordCounter,c=r.renderedRecords.length-h,l=s?h:c;if(l>0){var y=l*6,a=20,p=s?c:0,w=p*6*Uint16Array.BYTES_PER_ELEMENT;u.readBuffer(n,i.a_position,r.vertexBuffer,n.ARRAY_BUFFER,4,n.FLOAT,!1,a,0);u.readBuffer(n,i.a_texCoord,r.vertexBuffer,n.ARRAY_BUFFER,2,n.UNSIGNED_SHORT,!0,a,16);u.readBuffer(n,i.a_visibleZoom,r.visibilityBuffer,n.ARRAY_BUFFER,1,n.FLOAT,!1,0,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.elementIndexBuffer);v=o.getMatrices(f,n.canvas.width,n.canvas.height,r.translation.translate.x*r.dpr,r.translation.translate.y*r.dpr);t._prepareDraw(n,i,v,e);n.drawElements(n.TRIANGLES,y,n.UNSIGNED_SHORT,w)}}},t._drawVectorEntities=function(n,t,i,r,u,f,e){var s=i.polylineKeysToRender,o,h;if(s&&s.length>0){if(n.useProgram(t.glProgram),n.uniform2f(t.u_halfScreen,n.canvas.width/2,n.canvas.height/2),o=0,e)for(o=0;o<e.length;o++)n.disableVertexAttribArray(e[o]);for(o=0;o<s.length;o++)h=i.polylineCache.getItem(s[o]),h&&h instanceof tt&&h.render(t,!1,u,f,i.dpr)}},t.prototype.draw=function(n,i){var f=this.currentData,r=this._context,e=n.getMercatorZoomLevel(),s=o.getScale(e);u.clear(r);t._drawTextureEntities(r,this._program,f,s,e,!1);t._drawVectorEntities(r,this._vectorProgram,f,i,s,n,[this._program.a_texCoord,this._program.a_visibleZoom]);t._drawTextureEntities(r,this._program,f,s,e,!0)},t.prototype._buildAndUpdateAtlas=function(n,i,r,f,e){var s=this.currentData,o=s.atlas,h,c,a,l;if(t._upsertAtlas(o,i,!1)){if(h=w.build(o,s.maxTextureSize,e),!h&&(t._upsertAtlas(o,i,!0),h=w.build(o,s.maxTextureSize,e),!h&&(o.state=null,s.maxTextureSize*=2,o.context&&o.context.dispose(),o.context=null,t._upsertAtlas(o,i,!0),h=w.build(o,s.maxTextureSize,e),!h)))throw"Too many records to render in WebGL";c=o.state.updatedArea;c.w>0&&c.h>0&&(a=o.context.getRootElement()[0],l=s.textures[f],l&&s.textureSizes[f]===s.maxTextureSize?u.updateTexture(n,l,c.x,c.y,a):(l=s.textures[f]=u.createAndUploadTexture(n,null,a),s.textureSizes[f]=s.maxTextureSize))}},t.prototype._buildAndUploadRenderData=function(n,t,i,r,f){var l=f!==3,e=this._mergeRenderData(t,l),h=e.renderedRecords?e.renderedRecords.length:0,y,ut,p,s,c,ht,ct,w,lt;if(h>0){var at=e.atlas.state.size.width,vt=e.atlas.state.size.height,g=this._canvas.get_size(),yt=g.width/2,pt=g.height/2,nt=r.pixelScale/i,a,v,tt,b,it=0,rt=0;for(l&&(b=new ArrayBuffer(h*80),tt=new DataView(b)),y=new ArrayBuffer(h*Float32Array.BYTES_PER_ELEMENT*4),ut=new DataView(y),p=0;p<h;p++){if(s=e.renderedRecords[p],l){c=e.atlas.records.getItem(s.id);a=c.width;v=c.height;var ft=s.left+a/2/i,et=s.top+v/2/i,k=ft,d=et,ot=0,st=0;s.anchor&&(k=s.anchor.x,d=s.anchor.y,ot=(k-ft)*i,st=(et-d)*i);ht=(k-yt)/nt;ct=(pt-d)/nt;it=o.fillRectangleData(tt,it,ht,ct,c.atlasX,c.atlasY,a,v,-a/2-ot,-v/2-st,at,vt)}rt=o.fillOneRectangleVisibleZoom(ut,rt,s.visibleZoom)}w=e.visibilityBuffer;l?(e.vertexBuffer=u.uploadBuffer(n,e.vertexBuffer,n.ARRAY_BUFFER,b),w=e.visibilityBuffer=u.uploadBuffer(n,w,n.ARRAY_BUFFER,y),lt=o.buildRectangleVertexIndex(h),e.elementIndexBuffer=u.uploadBuffer(n,e.elementIndexBuffer,n.ELEMENT_ARRAY_BUFFER,lt)):u.updateBuffer(n,w,n.ARRAY_BUFFER,0,y)}},t.prototype._mergeRenderData=function(n,t){var u=this.currentData,e,o,i,f,r;if(t)u.translation={},u.renderedRecords=n;else{for(e={},o=u.renderedRecords,i=0,f=n.length;i<f;i++)n[i].visibleZoom>=0&&(e[n[i].id]=!0);for(i=0,f=o.length;i<f;i++)r=o[i],r.visibleZoom>=0&&r.visibleZoom!==127&&!e[r.id]&&(r.visibleZoom=127)}return u},t.prototype._initRenderData=function(t){var i=this.currentData,r={records:new rt(5e3)},u=new rt(1e3);i&&i.polylineCache&&i.polylineCache.clear();t&&i?(i.dpr=t,i.renderedRecords=[],i.atlas=r,i.translation={},i.frame=null,i.polylineCache=u):this.currentData={textures:[],textureSizes:[],renderedRecords:[],vectorPriorityRecordCounter:0,atlas:r,translation:{},frame:null,dpr:t||n._getDpr(),maxTextureSize:this._maxTextureSize,polylineCache:u}},t.prototype.clear=function(){var t=this._context,n=this.currentData,i;if(n.textures&&n.textures.length>0){for(i=0;i<n.textures.length;i++)t.deleteTexture(n.textures[i]);t.deleteBuffer(n.elementIndexBuffer);t.deleteBuffer(n.vertexBuffer);t.deleteBuffer(n.visibilityBuffer)}this._initRenderData();t.clear(t.COLOR_BUFFER_BIT)},t.prototype.dispose=function(){var n=this._context;n&&(this.clear(),this._program&&n.deleteProgram(this._program.glProgram),this._canvas=null,this._program=null,this._context=null)},t._upsertAtlas=function(t,i,r){var c=!1,h=t.records,f,u,e,o,s;if(r&&(h.clear(),t.state=null),i)for(f=0;f<i.length;f++)u=i[f],e=u.id,u.width>0&&u.height>0&&(o=h.getItem(e),o&&o.atlasX!==-1&&o.width!==0||(c=!0,s=n._copyObject(u),s.id=e,r&&(s.cached=!1),h.addItem(e,s)));return c},t}();ft=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return b(t,n),t.prototype._constructVectorLabel=function(){return new et(this._map)},t}(pt),function(n){function f(n,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,n,t,i,1,]}function e(n,t,i,r){var u=1/(i-r);return[n/t,0,0,0,0,n,0,0,0,0,(i+r)*u,-1,0,0,i*r*u*2,0]}function o(n,t){var i=n[0],r=n[1],u=n[2],f=n[3],e=n[4],o=n[5],s=n[6],h=n[7],c=n[8],l=n[9],a=n[10],v=n[11],y=n[12],p=n[13],w=n[14],b=n[15],k=t[0],d=t[1],g=t[2],nt=t[3],tt=t[4],it=t[5],rt=t[6],ut=t[7],ft=t[8],et=t[9],ot=t[10],st=t[11],ht=t[12],ct=t[13],lt=t[14],at=t[15];return[k*i+d*e+g*c+nt*y,k*r+d*o+g*l+nt*p,k*u+d*s+g*a+nt*w,k*f+d*h+g*v+nt*b,tt*i+it*e+rt*c+ut*y,tt*r+it*o+rt*l+ut*p,tt*u+it*s+rt*a+ut*w,tt*f+it*h+rt*v+ut*b,ft*i+et*e+ot*c+st*y,ft*r+et*o+ot*l+st*p,ft*u+et*s+ot*a+st*w,ft*f+et*h+ot*v+st*b,ht*i+ct*e+lt*c+at*y,ht*r+ct*o+lt*l+at*p,ht*u+ct*s+lt*a+at*w,ht*f+ct*h+lt*v+at*b,]}function s(n){var u,e=i+.5,f,r;for(f in t)if(t.hasOwnProperty(f)&&(r=parseInt(f),u=r,Math.abs(n-r)<=e)){u=r;break}return u}function h(n){var i=s(n),r=Math.pow(2,n-i),u=r*t[i];return{align:i,pixelScale:u,zoomDelta:r}}function c(n,i,s,h,c){var l=s/2,a=l/r,v=l*u,y=t[n.align],p=e(y,i/s,a,v),w=l/n.zoomDelta,b=f(h,c,-w);return o(p,b)}function l(n,t,i,r,u,f,e,o,s,h,c,l){var a=b(u,f,e,o,c,l),v=w(i,r,e,o,s,h);return y(n,t,{vertices:v,textureLookup:a})}function a(n){for(var u=n*6,i=new Uint16Array(u),r=0,t=0;t<u;t+=6)i[t]=0+r,i[t+1]=1+r,i[t+2]=2+r,i[t+3]=2+r,i[t+4]=1+r,i[t+5]=3+r,r+=4;return i}function v(n,t,i){for(var r=0;r<4;r++)n.setFloat32(t,i,!0),t+=Float32Array.BYTES_PER_ELEMENT;return t}function y(n,t,i){for(var r,f=i.vertices,e=i.textureLookup,u=0;u<4;u++){for(r=0;r<4;r++)n.setFloat32(t,f[u*4+r],!0),t+=Float32Array.BYTES_PER_ELEMENT;for(r=0;r<2;r++)n.setUint16(t,e[u*2+r]*65535,!0),t+=Uint16Array.BYTES_PER_ELEMENT}return t}function p(n,t){return[n,0,0,0,n,t,0,t,]}function w(n,t,i,r,u,f){for(var e=[n,t,i,r,n,t,0,r,n,t,i,0,n,t,0,0,],o=0;o<e.length;o+=4)e[o+2]+=u,e[o+3]+=f;return e}function b(n,t,i,r,u,f){for(var e=p(i,r),o=0;o<e.length;o+=2)e[o]=(n+e[o])/u,e[o+1]=(t+e[o+1])/f;return e}var t={"4":.0078125,"11":1,"18":128},i=3,r=2<<i,u=2<<i+2;n.getScale=h;n.getMatrices=c;n.fillRectangleData=l;n.buildRectangleVertexIndex=a;n.fillOneRectangleVisibleZoom=v}(o||(o={}));et=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return b(t,n),t.prototype._constructRenderers=function(n,t){var i=[];return s.features.taskFramework.glMicroPoi&&!s.glPolyline&&i.push(new g(n,t,"vectorgl",10099,[2])),i.push(new g(n,t,"labelgl",20001,[1])),i},t}(wt);ot=function(t){function i(r,u,f,e){var o=t.call(this,r,null,f,e,i._vectorGLCanvasId,n._getDpr())||this;o._map=u;h.Browser.is_safari&&h(window).add_event("pagehide",function(){o.dispose()});try{o._adapter=new it(o._canvasElement,o._map.getActualSize(),256,s.glPolyline,s.features.labels.allowSoftwareGL,h.Browser.is_safari,!0);o._disposables.push(o._adapter)}catch(c){console.warn(c);p.glFailure=!0}return o}return b(i,t),i.prototype._setupCanvas=function(i){if(!this._canvasElement){var r=n._createElement("canvas");r.add_event("webglcontextlost",function(){p.glFailure=!0},!1);this._canvasElement=h(r)}t.prototype._setupCanvas.call(this,i)},i.prototype.transformCanvas=function(){s.glPolyline&&this._adapter&&this._adapter.render(this._map,null,null,null,0,!0,n._getDpr(),0)},i.prototype.clear=function(){this._adapter.clear()},i.prototype.copyCanvas=function(n){var t=this._canvasElement[0];n.drawImage(t,0,0,t.width,t.height)},i.prototype._prepareCanvas=function(n){var i=this._adapter.getCanvas().get_size(),t=new ut(n.viewport.pixelWidth*1,n.viewport.pixelHeight*1);(i.width!==t.width||i.height!==t.height)&&this._adapter.updateSize(t)},i.prototype._drawTemplateRenderingResults=function(t,i,r,u){var f;if(!u)if(r&&Object.keys(r).length!==0||i&&i.length!==0)try{this._adapter.render(this._map,null,i,r,0,!1,n._getDpr(),4)}catch(e){console.warn(e);this.clear();p.glFailure=!0;f=t}else this.clear();return f},i.prototype._renderIconTemplates=function(n,t,i,r){var u=new ct(i.crs,n);return u.project(i.geometry.x,i.geometry.y),l.packGLTemplates(t,this._adapter,this._dpr,r,i,null,1,u.lastProjectedX,u.lastProjectedY)},i.prototype._vectorEntitiesGL=function(){return s.glPolyline&&!p.glFailure},i.prototype._isStyleSupported=function(n){var i=!0,r,u,f,t;if(n)for(r=0;r<n.length;r++){if(u=n[r],u.shapes)for(f=0;f<u.shapes.length;f++)t=u.shapes[f].style,t&&t.dashes&&t.dashes.length>0&&(i=i&&nt.isSupported(t.dashes));if(!i)break}return i},i.prototype._isCached=function(n){var t=this._adapter.currentData.polylineCache,i=!1;return t&&(i=!!t.getItem(n+"_i")&&!!t.getItem(n+"_o")),i},i._vectorGLCanvasId="vectorgl",i}(p);t._LabelControllerGL=ft;t._VectorLayerRendererGL=ot}catch(st){if(f.logger)f.logger.logCriticalError(st);else throw st;}}).call(window)