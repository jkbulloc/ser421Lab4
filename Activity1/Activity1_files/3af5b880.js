(function(){try{(function(){var n={L_Link_Generating_Text:"Creating the link â€¦",L_Link_GenerationFailed_Text:"There was a problem creating the link. Try again.",L_Permalink_Prompt:"Share this map",L_TaskBar_Label_SearchBox:"Add a search",L_TaskBar_Label_Clear:"Clear Search Term",L_TaskBar_Label_Search:"Search",L_TaskBar_Label_Directions:"Directions",L_TaskBar_Label_Traffic:"Traffic",L_TaskBar_Label_Favorites:"My Places",L_TaskBar_Label_More:"More",L_SearchNearbyTransit:"Nearby Transit",L_SearchNearbyParking:"Parking",L_Permalink_Email_Button_Tooltip:"Email link",L_Print_Submit:"Print",L_PrintPreview:"Print Preview",L_PrintMapAndText:"Map & Text",L_PrintMapOnly:"Map only",L_PrintTextOnly:"Text only",L_PermalinkCopy_Text:"Copy",L_PermalinkEmail_Text:"Email",L_Permalink_Email_Button_Text:"Email",L_PermalinkFacebook_Text:"Facebook",L_PermalinkTwitter_Text:"Twitter",L_Twitter_Tag_Text:"on #BingMaps",L_PermalinkHeaderPrompt_Text:"Share",L_PermalinkLink_Text:"Link",L_PermalinkPrompt_Text:"Select the cards above that you would like to share",L_Link_TooManyItemsSelected_Text:"Unable to share. Please unselect some items and try sharing in smaller groupings (5-10 items at a time).",L_Link_EmailTitleManyCards_Text:"Bing Maps session shared with you",L_Link_EmailFooter_Text:"Shared from Bing Maps",L_LengthenButton_Text:"Show full URL",L_ShortenButton_Text:"Shorten",L_EditMapDone_Text:"Done",L_EditMap_Text:"Move or zoom map",L_SlideOutMenu_MapType:"Map",L_SlideOutMenu_MapType_Road:"Road View",L_SlideOutMenu_MapType_Aerial:"Aerial View",L_SlideOutMenu_MapType_Birdseye:"Birds View",L_SlideOutMenu_SeeAllCards:"See all card",L_SlideOutMenu_BingHome:"Bing Home",L_SlideOutMenu_Feedback:"Feedback",L_SlideOutMenu_ExitPreview:"Exit preview",L_PrintNotes:"Notes",L_PrintNotesWatermark:"Type your notes here",L_PermalinkEmbed_Text:"Embed",L_Menu_Exit_Text:"Previous Version",L_Menu_Feedback_Text:"Feedback",L_TaskBar_Label_Print:"Print",L_TaskBar_Label_Embed:"Embed a map",L_TaskBar_Label_Share:"Share",L_Menu_Tips_Text:"Tips",L_TaskBar_Label_Fullscreen:"Full Screen",Taskbar_Label_ExitFullScreen:"Exit Full Screen",TaskBarLogoTitle:"Back to Bing search",BEV2DetailsInstruction:"1. In cards",BEV2Introduction:"New and crisp Bird's Eye imagery is available in many metropolitan areas.",BEV2TransientLensInstruction:"2. Right-click on the map",BEV2WelcomeText:"Bird's Eye has changed",BEV2ImageIntroduction:"There are two ways of viewing the new Bird's Eye.",BEV2TipNote:"Note: Bird's Eye may not be available in your area as outdated imagery is no longer available.",L_CategoryLayerDropdownButton:"All {0}",L_CategoryLayerDropdownTitle:"Show on map",L_CategoryLayer_Schools:"Schools",L_CategoryLayer_Transit:"Transit",L_CategoryLayer_Commutability:"Commute",ShareEmailToolTip:"Send in email",ShareFBToolTip:"Share to Facebook",ShareTwitterToolTip:"Post to Twitter",L_CmtControlTitleText:"Enter your location to see a 15 min commute range.",L_CmtControlAddLocationText:"Add location",L_CmtControlCommuteTime30Text:"30 min",L_CmtControlCommuteTime45Text:"45 min",L_CmtControlCommuteTime60Text:"1 hr",L_CmtControlCommuteTime15Text:"15 min",L_CmtControlCommutePeak_Text:"Peak",L_CmtControlCommuteOffPeak_Text:"Off Peak",L_CmtControlPushpinTitle:"A",L_CmtControlPushpinTwoTitle:"B",L_CmtEditText:"Options",L_CmtDoneText:"Done",L_CmtPlaceHolderText:"Commute to (e.g. work, home, school)",L_CmtTitle:"{time} min commute to {addresses} in {trafficCondition} traffic",L_CmtTooltipTitle:"{time} min drive time",L_CmtTooltipDescription:"click to change address or drag to new location",L_CmtTitleAddresses:"both {addr1} and {addr2}",L_CmtErrorMessage:"Can't retreive boundary, please try again later",ShareClose:"Close",ShareUrlLabel:"Copy URL",L_CategoryUserTip_Header:"Show on map",L_CategoryUserTip_Message1:"We've turned on the map layers you selected",L_CategoryUserTip_Message2:"Pan and Zoom to see more results",L_ZoomInUserTip_Message:"Zoom in or use filters to narrow your search",L_Tooltip_Itinerary_Saved_Text:"Itinerary saved to My Places",L_Tooltip_Rename_Button:"Rename",L_Tooltip_Update_Button:"Update",SearchGhostText:"Search Bing Maps",L_MoreSearchTip:"Search for more businesses",L_RemoveFromMap:"Remove from map",L_EditYourSearch:"Edit your search",BingMapsLogo:"Bing Maps logo",AddAnotherSearchGhostText:"Add another search",PrintMiniMapAltText:"Mini map"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("InternalControls",n):window.$MicrosoftMaps8.ResourcesObject=n})();var r=window.$MicrosoftMaps8,u=r.Internal,ir=u.TaskData,ef=r.Anchor,of=r.GlobalConfig.features.autosuggest,rr=r.CommonControls.AutosuggestViewModel,ur=r.CommonControls.AutosuggestV2,ui=u._BaseMapTemplateSelector,sf=u.BaseTask,fi=u.BaseTaskViewModel,hf=r.BitmapImageTemplate,ei=ir.CollectionActions,rt=u._ComponentNames,ct=u.Control,nt=u.ControlTemplate,e=r.DataHandlerKeys,cf=u._Debug,lf=r.DefaultTemplateSelector,b=r.GlobalConfig.features.directions,fr=r.CommonControls.DropdownItem,c=u._EntryPoints,v=u._FeatureNames,af=r.GlobalConfig.features.feedback,vf=r.FiltersBarModuleViewModel,yf=r.FiltersBar,pf=r.FiltersBarItem,wf=r.FiltersBarItemData,bf=u.GeolocationProvider,n=u._Gimme,h=r.GlobalConfig,o=r.GlobalDataEventHandler,l=u._Helper,kf=r.CommonControls.IDropDownListData,df=r.ImageFromCssHelper,pt=r.ImageryMapLayer,er=r.Infobox,f=u._JSEvent,oi=r.Layer,gf=r.LocationRect,ne=r.LocalSearchTask,ut=u._LocalStorageCache,g=u._LoggerConstants,lt=u._LruCache,te=u.MapInteractionBehavior,st=u.MapHelper,wt=r.Location,ie=r.MapsFeedback,y=r.MapTypeId,or=r.MapView,bt=r.CommonControls.ModalDialogViewModel,re=r.MoveableSimplePointPrimitive,sr=u._Network,ue=r.GlobalConfig.features.notification,si=u._ObservableObject,at=u._ObservableCollection,fe=u._OverlayEntity,hi=u._Overlay,tt=r.Point,hr=r.CommonControls.PopOutButtonViewModel,ee=h.features.parking,k=u.Permalink,oe=r.PrimitiveOverlayHelper,it=r.GlobalConfig.features.print,cr=u.PrintContent,lr=r.Pushpin,t=r.ResourceManager.InternalControls,ci=u.ReverseGeocoder,ar=r.CommonControls.SearchBoxAutosuggestDataModel,se=u.SDKPrimitiveTemplateSelector,he=r.SimplePointPrimitive,li=r.Size,d=r.GlobalConfig.features.sharing,et=u.SharingInstrumentationAction,vr=u.TaskData.TimeTypes,ai=r.LabelVisibility,ce=u._StreetsidePerfConstants,le=r.GlobalConfig.features.streetside,i=r.GlobalConfig.features.taskBar,ae=u._TaskDataHandlerHelper,yr=r.CommonControls.TaskBarDropdownViewModel,s=r.TaskTypes,ve=h.features.traffic,ye=u._Url,pe=r.MouseEventArgs,kt=r.VectorMapLayer,we=r.VenueMaps,vi=u.TaskData.Waypoint,vt=r.ZoomLevel,pr='<div>    <div class="sliBack" event:click="clickBackgroundHandler"><\/div>    <div class="sliMenu">        <ItemsControl ItemsSource="{Binding menuItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul class="sliMenuList"><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding type}" >                        <a href="#" id="{Binding htmlId}" class="{Binding cssClass}" event:click="clickHandler">                            <TextBlock text="{Binding name}" />                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <\/div>  <\/div>',wr='<div class="bm_categorySearchContainer" data-tag="ShowMeControls" >    <div class="recommendedCategoryContainer">        <div class="showMeImage">            <span class="showMeIcon" role="presentation"><\/span>        <\/div>        <div><a style:display="{TemplateBinding ShowCreateAlertButton Converter=boolToDisplay}" onclick="javascript:sj_evt.fire(\'createAlertClicked\')">Create Alert<\/a><\/div>        <ItemsControl ItemsSource="{TemplateBinding CategoryList}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="contextCategory">                        <a class="recommendedCategory" data-tag="recommendedCategory" style:display="{Binding Recommended Converter=boolToDisplay}" event:click="onItemClick" role="checkbox" aria-checked="{Binding Checked}" href="#">                            <span class="{Binding Checked Converter=itemCheckedClass}"><\/span>                            <span class="{Binding Icon}"><\/span>                            <span class="categoryName">                                <TextBlock Text="{Binding Name}" />                            <\/span>                        <\/a>                        <span class="categoryChevron" style:display="{Binding CollapseEnabled Converter=boolToDisplay}" event:click="onCollapseClick" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="{TemplateBinding CheckCount Converter=countClassConverter}" data-tag="CategoryDropdown">        <MultiselectDropdown ItemList="{TemplateBinding CategoryList}" ButtonName="{TemplateBinding DropdownButtonName}" DropdownTitle="{TemplateBinding dropdownTitle}" ButtonIcon="moreIcon" />    <\/div><\/div>',br='<div class="bm_BirdsEyeV2Dialog">    <div class="bm_BEMessageTitleContainer" data-tag="BEMessageTitleContainer">        <div class="BEV2TitleText" title="{TemplateBinding resources.BEV2WelcomeText}">            <TextBlock Text="{TemplateBinding resources.BEV2WelcomeText}" />        <\/div>    <\/div>    <div class="bm_BEMessageContainer" data-tag="BEMessageContainer">        <div class="bm_BEV2Introduction" title="{TemplateBinding resources.BEV2Introduction}">            <TextBlock Text="{TemplateBinding resources.BEV2Introduction}" />        <\/div>    <\/div>    <div class="bm_BEImageIntroContainer" data-tag="BEImageIntroContainer">        <div class="bm_ImageIntroText" title="{TemplateBinding resources.BEV2ImageIntroduction}">            <TextBlock Text="{TemplateBinding resources.BEV2ImageIntroduction}" />        <\/div>    <\/div>    <div class="bm_BEImagesContainer" data-tag="BEImagesContainer">        <div class="bm_DetailsImageContainer" data-tag="DetailsImageContainer">            <div class="bm_DetailsInstructionText" title="{TemplateBinding resources.BEV2DetailsInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2DetailsInstruction}" />            <\/div>            <img src="" class="bm_DetailsBEV2Image" data-tag="DetailsBEV2Image"/>        <\/div>        <div class="bm_TransientImageContainer" data-tag="TransientImageContainer">            <div class="bm_TransientInstructonText" title="{TemplateBinding resources.BEV2TransientLensInstruction}">                <TextBlock Text="{TemplateBinding resources.BEV2TransientLensInstruction}" />            <\/div>            <img src="" class="bm_TransientBEV2Image" data-tag="TransientBEV2Image" />        <\/div>    <\/div>    <div class="bm_BEv2TipNoteContainer" data-tag="BEv2TipNoteContainer">        <div class="bm_BEv2NoteText" title="TemplateBinding resources.BEV2TipNote">            <TextBlock Text="{TemplateBinding resources.BEV2TipNote}"/>        <\/div>    <\/div><\/div>',dt='<div id="cmt_container" class="cmt_container collapsed" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>        <button id="cmt_edit" class="cmt_button" event:click="onEditClicked" event:touchstart="onEditClicked">{editText}<\/button>        <button id="cmt_done" class="cmt_button hidden" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_body" class="cmt_body hidden">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />                <div id="cmt_delete_1" class="cmt_delete hidden" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>            <div class="cmt_addressDiv hidden" id="cmt_addressDivTwo">                <input type="text" class="cmt_address" id="cmt_addressTwo" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressTwoValue Mode=TwoWay}" />                <div id="cmt_delete_2" class="cmt_delete" event:click="onDeleteClicked" event:touchstart="onDeleteClicked"><\/div>            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>        <div id="cmt_BtmArea" class="cmt_BtmArea" event:click="onAddLocClicked" event:touchstart="onAddLocClicked">            <div id="cmt_addIcon" class="cmt_addIcon"><\/div>            <div id="cmt_addAdr" class="cmt_addAddr">{commuteAddLoc}<\/div>        <\/div>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',gt='<div id="cmt_container" class="cmt_container cmt_v2" event:mouseover="stopEvent" event:mouseenter="stopEvent" event:click="stopEvent" event:mousedown="stopEvent" event:mouseup="stopEvent" event:mouseout="stopEvent" event:contextmenu="stopEvent" event:focus="stopEvent">    <div id="cmt_topArea" class="cmt_topArea">        <div id="cmt_titleWrapper" class="cmt_titleWrapper">            <div id="cmt_title" class="cmt_title">{commuteControlTitle}<\/div>        <\/div>    <\/div>    <div id="cmt_body" class="cmt_body">        <div class="cmt_addresses" id="cmt_addresses">            <div class="cmt_addressDiv" id="cmt_addressDivOne">                <input type="text" class="cmt_address" id="cmt_addressOne" autocomplete="off" placeholder="{placeHolder}" value="{StaticBinding addressValue Mode=TwoWay}" />            <\/div>        <\/div>        <div class="cmt_settings">            <div class="cmt_timeArea">                <button id="cmt_time15" class="cmt_button cmt_time selected" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime15}<\/button>                <button id="cmt_time30" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime30}<\/button>                <button id="cmt_time45" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime45}<\/button>                <button id="cmt_time60" class="cmt_button cmt_time" event:click="onTimeClicked" event:touchstart="onTimeClicked">{commuteTime60}<\/button>            <\/div>            <div class="cmt_Depart">                <button id="cmt_peak" class="cmt_button selected" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commutePeak}<\/button>                <button id="cmt_offpeak" class="cmt_button" event:click="onPeakClicked" event:touchstart="onPeakClicked">{commuteOffPeak}<\/button>            <\/div>        <\/div>    <\/div>    <div id="cmt_btm" class="cmt_btm">        <span id="cmt_err" class="cmt_err hidden">{errorMessage}<\/span>        <button id="cmt_done" class="cmt_button disabled" event:click="onDoneClicked" event:touchstart="onDoneClicked">{doneText}<\/button>    <\/div>    <div id="cmt_loader" class="cmt_loader">        <div id="cmt_spinner" class="cmt_spinner"><\/div>    <\/div><\/div>',yi='<div id="cmt_infobox">    <b id="cmt_infoboxTitle">{title}<\/b>    <div id="cmt_infoboxDescription">{description}<\/div><\/div>',pi='<div class="taskBar" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="logo" data-tag="TaskBar.Logo"><\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" data-tag="TaskBar.SearchBox"><\/input>                    <a href="#" class="clrSb" title="{Binding resources.L_TaskBar_Label_Clear}" role="button" data-tag="TaskBar.SearchBoxCancel"><\/a>                <\/div>            <\/div>            <div class="searchButton">                <a href="#" class="searchIcon" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="#" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>        <div class="clear"><\/div><\/div>',kr='<div class="printDialog" data-tag="printDialog" role="dialog">    <p class="printDlgHdr">        <div class="printPreviewTitle">            <TextBlock Text="{TemplateBinding resources.L_PrintPreview}" />        <\/div>        <div class="mapAndTextPrint">            <ul>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapAndText}" class="printMapAndText mapTextOptions selected" data-tag="printMapAndText" event:click="onMapTextClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapAndText}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapOnly}" class="printMapOnly mapTextOptions" data-tag="printMapOnly" event:click="onMapOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapOnly}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintTextOnly}" class="printTextOnly mapTextOptions" data-tag="printTextOnly" event:click="onTextOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintTextOnly}" />                    <\/a>                <\/li>            <\/ul>        <\/div>    <\/p>    <div>        <div class="printContent" data-tag="printContent" event:mousewheel="onMouseWheel">            <div class="printHeader" style:display="block">                <img class="bingMapsLogo" alt="{TemplateBinding resources.BingMapsLogo}" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATCAMAAADS32EkAAAAP1BMVEX///9RUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFAbX/lHAAAAFHRSTlMAECAwQFBgcHSAkKCwuMDQ4Obw8rSbhEIAAAGTSURBVHhe1ZLdjtwwCEY/DHbqn2KX8v7P2mGSrLKNVrPSqBc9F8jGcGQh4KMk/AP8gfznXi8IkIa85+WEK14RgH17z1t8bnz3vj+H5e6ryYc31QKAhMD8OFNkuVZhRiCQeOd9lVKORmKkshtypsO7+ROrCHzGeYO4QJc9yEB9FuhRsJrxXOoSD9oXQbTbsElINoYfXrJdfLR5JZ6enl6vRDbBrkL1LOhAsQ7UAcSnW4H4IJB21HrZB6rr4l0Aim9PrwHojuoJwDq8DKQIst+ROyTuKIbaL17kq7ch+urTG6nqGB4CPbxnIAW4T58KmYiEI+mU0yv6aQ59X7Krt33670dQJN8SysULbFbDW06rr4zADUBzvnqLF4D97o0RY+g5hyhAcrj/6H5Q6dy91ZYPXL00fXS/eyGLUCy8mlAsIxNo4fdP34n0gW7DrRFYGa0dv+BuVvXuRbc1s0K0u3kFmunM+HUZwWvWwB1KEUWRhBBwJPs5ghdkjtqCrxD9u8FiBC/xoOP7XqSM7yDbxvgabrjwB0awHHyuA7RgAAAAAElFTkSuQmCC" />            <\/div>            <div class="baseMapPrint" data-tag="baseMapPrint">                <div>                        <ul>                            <li data-tag="baseMapNotes" class="baseMapNotes">                                <div id="printNotesLabel">                                    <TextBlock Text="{TemplateBinding resources.L_PrintNotes}" />                                <\/div>                                <div class="baseMapTextArea screenNotes">                                    <textarea rows="9" cols="45" id="baseMapNotes" role="textbox" aria-label="{TemplateBinding resources.L_PrintNotesWatermark}" class="baseMapNotes" style:color="black" placeholder="{TemplateBinding resources.L_PrintNotesWatermark}" maxlength="{TemplateBinding notesMaxCharSize}"> <\/textarea>                                <\/div>                                <div class="printedNotes">                                <\/div>                            <\/li>                            <li data-tag="baseMapMiniMap" class="baseMapOverviewMap">                                <img src="{TemplateBinding overviewContextMap}" alt="{TemplateBinding resources.PrintMiniMapAltText}"/>                            <\/li>                        <\/ul>                        <div>                                <div class="printArea" data-tag="printArea">                                    <div class="printMap" data-tag="printMap">                                    <\/div>                                <\/div>                        <\/div>                <\/div>            <\/div>            <div class="taskPrintContent" data-tag="taskPrintContent">            <\/div>        <\/div>            <div class="printFooter" style:display="block">            <p class="printDlgFoot printButton">                <a class="textButton" aria-label="{TemplateBinding resources.L_Print_Submit}" event:click="onPrintClick" href="#" role="button" data-tag="printButton">                    <TextBlock Text="{TemplateBinding resources.L_Print_Submit}" />                <\/a>            <\/p>        <\/div>    <\/div><\/div>',dr='<div class="bm_sharePanel" data-tag="Share.SharePanel">    <div class="header text" data-tag="Share.HeaderText">        <div class="shareTitleIcon" data-tag="shareTitleIcon"><\/div>        <div class="shareTitle">            <h2>                <TextBlock text="{StaticBinding resources.L_PermalinkHeaderPrompt_Text}" />            <\/h2>        <\/div>        <a href="#" class="panelClose" title="{StaticBinding resources.ShareClose}" role="button" data-tag="Share.CloseButton" data-share=\'{ "action": "closeShare" }\'><div class="icon svg"><\/div><\/a>    <\/div>    <div class="content">        <div class="body">            <div class="textAndEmbed">                <div class="shareTextTitle">                    <TextBlock text="{StaticBinding resources.L_PermalinkHeaderPrompt_Text}" />                <\/div>                <div class="text" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                    <TextBlock text="{StaticBinding resources.L_PermalinkPrompt_Text}" />                <\/div>            <\/div>            <input class="text urlBox" data-tag="Share.UrlBox" type="text" value="{Binding permalinkString}" onclick="this.select();" aria-label="{StaticBinding resources.ShareUrlLabel}" />            <div class="linkBox">                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="linkStyleButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.ToggleLinkLength" event:click="toggleLinkLength" role="button">                    <TextBlock text="{Binding isShortPermalinkDisplayed Converter=displayStateToLinkText}" />                <\/a>                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="copyButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.Copy" event:click="copyToClipboard" role="button">                    <TextBlock text="{StaticBinding resources.L_PermalinkCopy_Text}" />                <\/a>            <\/div>            <div class="errorMessage" data-tag="Share.ErrorMessage" style:visibility="{Binding errorMessage Converter=errorMessageToVisibility}">                <TextBlock text="{Binding errorMessage}" />            <\/div>        <\/div>        <div class="footer" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}">            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="facebookIcon" style:visibility="{Binding enableSocialSharing}" data-tag="Share.Facebook" event:click="openFacebook" role="button" title="{StaticBinding resources.ShareFBToolTip}"><\/a>            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="twitterIcon" style:visibility="{Binding enableSocialSharing}" data-tag="Share.Twitter" event:click="openTwitter" role="button" title="{StaticBinding resources.ShareTwitterToolTip}"><\/a>            <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="emailIcon" data-tag="Share.Email" event:click="openEmail" role="button" title="{StaticBinding resources.ShareEmailToolTip}"><\/a>        <\/div>    <\/div><\/div>',gr='<div class="sharePrompt">    <TextBlock text="{TemplateBinding resources.L_Permalink_Prompt}" /><\/div><input class="shareUrlBox" data-tag="Share.UrlBox" type="text" value="{TemplateBinding permalinkString}" onclick="this.select();" readonly="readonly" /><a href="#" class="shareUrlShortenLink" data-tag="Share.ShortenButton" event:click="shortenClick"><TextBlock text="{TemplateBinding shortenButtonText}" /><\/a><a href="#" class="submitBtn padded" data-tag="Share.EmailButton" event:click="emailClick" role="button">    <TextBlock text="{TemplateBinding resources.L_Permalink_Email_Button_Text}" /><\/a>',nu='<div class="bm_taskBarNavLeft" data-tag="TaskBarNavLeft">    <div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">        <div class="bm_logo">            <ul>                <li class="sbElement">                    <a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">                        <h1 class="b_logo b_taskLogo"><\/h1>                    <\/a>                <\/li>            <\/ul>        <\/div>        <div class="bm_mainActions" data-tag="MainActions">            <ItemsControl ItemsSource="{Binding taskBarItems}">                <ItemsControl.Template>                    <DataTemplate>                        <ul class="actions"><ItemsPresenter /><\/ul>                    <\/DataTemplate>                <\/ItemsControl.Template>                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                            <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">                                <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                                    <TextBlock Text="{Binding name}" />                                <\/span>                            <\/a>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>        <div class="bm_auxActions" data-tag="AuxActions">            <div class="bm_auxActionHead"><\/div>            <ItemsControl ItemsSource="{Binding taskBarExtraItems}">                <ItemsControl.Template>                    <DataTemplate>                        <ul class="actions"><ItemsPresenter /><\/ul>                    <\/DataTemplate>                <\/ItemsControl.Template>                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                            <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">                                <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                                    <TextBlock Text="{Binding name}" />                                <\/span>                            <\/a>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>',tu='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t<input id="maps_sb" type="search" placeholder="{Binding resources.SearchGhostText}" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox"><\/input>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<ItemsControl ItemsSource="{Binding CapsuleList}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="bm_capsules_outsidesearchbox"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li class="bm_cardItem" id="{Binding id}">\t\t\t\t\t<div class="bm_cardCapsule">\t\t\t\t\t\t<a class="bm_cardCapsuleText" role="button" event:click="titleClickHandler" event:touchend="titleClickHandler" title="{Binding title}" href="#">\t\t\t\t\t\t\t<div class="{Binding imageClass}" id="bm_cardImage" />\t\t\t\t\t\t\t<div class="bm_capsuleText">\t\t\t\t\t\t\t\t<TextBlock Text="{Binding title}" />\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/a>\t\t\t\t\t\t<a class="bm_cardCapsuleClose" role="button" event:click="cardCloseHandler" event:touchend="cardCloseHandler" href="#" title="{StaticBinding resources.L_CloseTask_Text}">\t\t\t\t\t\t\t<div id="bm_cardCloseIcon"><\/div>\t\t\t\t\t\t<\/a>\t\t\t\t\t<\/div>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<ul class="bm_overflowCountContainer" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut">\t\t<li class="bm_overflowCounter">\t\t\t<div class="bm_overflowBox">\t\t\t\t<a class="bm_overflowLink" role="button">\t\t\t\t\t<TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />\t\t\t\t<\/a>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<ul class="bm_addNewSearchContainer" style="display: none;" event:click="addNewSearchClick" event:mouseout="addSearchMouseOut" event:mouseover="addSearchMouseOver">\t\t<li class="bm_addNewSearchInnerContainer">\t\t\t<div class="bm_addNewSearchBox">\t\t\t\t<a class="bm_addNewSearchLink" role="button"/>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<div class="bm_outsideBeak"><\/div>\t<div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler">\t\t<div class="bm_popoutTop1">\t\t\t<div class="bm_popOutInner1">\t\t\t\t<ItemsControl ItemsSource="{Binding OverflowCapsuleList}">\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t<div class="bm_overflowItem" id="{Binding id}" title="{Binding title}">\t\t\t\t\t\t\t\t<a class="bm_overflowCardText" href="#" event:click="titleClickHandler" event:touchend="titleClickHandler">\t\t\t\t\t\t\t\t\t<div class="{Binding imageClass}" id="bm_cardImage" />\t\t\t\t\t\t\t\t\t<span id="bm_overflowText">\t\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding title}" />\t\t\t\t\t\t\t\t\t<\/span>\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t\t<a class="bm_overflowCardClose" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" title="{StaticBinding resources.L_CloseTask_Text}" />\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t<\/ItemsControl>\t\t\t<\/div>\t\t<\/div>\t<\/div>\t<div id="ReactivateSearchTip">\t\tReactivate your previous search\t<\/div>\t<div id="PreviousSearchTip">\t\tPrevious searches are here\t<\/div>    <div id="AddSearchTip">        Click to add a search    <\/div>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">\t\t<div id="bm_contexualAndRelatedContainer">\t\t\t<!-- Container for contextual taskbar -->\t\t\t<div id="bm_contextualTaskbarContainer" data-tag="contextFilters">\t\t\t<\/div>\t\t\t<!-- Container for Related Searches in taskbar -->\t\t\t<div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">\t\t\t<\/div>\t\t\t<!-- Container for Directions search along the route in taskbar -->\t\t\t<div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">\t\t\t<\/div>\t\t<\/div>\t\t<!-- Container for the category layer dropdown -->\t\t<div id="bm_categoryLayerDropdownContainer">\t\t<\/div>\t<\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',iu='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t<ul class="bm_overflowCountContainer" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut">\t\t\t\t\t\t<li class="bm_overflowCounter">\t\t\t\t\t\t\t<div class="bm_overflowBox">\t\t\t\t\t\t\t\t<a class="bm_overflowLink" role="button">\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/li>\t\t\t\t\t<\/ul>\t\t\t\t\t<ItemsControl ItemsSource="{Binding CapsuleList}">\t\t\t\t\t\t<ItemsControl.Template>\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t<ul class="bm_capsules_insidesearchbox"><ItemsPresenter /><\/ul>\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t<\/ItemsControl.Template>\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t<li class="bm_cardItem" id="{Binding id}">                                    <div class="bm_cardCapsule">                                        <div class="bm_cardCapsuleText" role="button" title="{Binding title}">                                            <div class="{Binding imageClass}" id="bm_cardImage" />                                            <div id="bm_titleText">                                                <TextBlock Text="{Binding title}" />                                            <\/div>                                        <\/div>                                        <a class="bm_cardCapsuleClose" role="button" event:click="cardCloseHandler" event:touchend="cardCloseHandler" href="#" title="{StaticBinding resources.L_CloseTask_Text}">                                            <div id="bm_cardCloseIcon"><\/div>                                        <\/a>                                    <\/div>\t\t\t\t\t\t\t\t<\/li>\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t\t\t\t\t\t<input id="maps_sb" type="search" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox" placeholder="Search Bing Maps"><\/input>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>                    <div class="bm_outsideBeak" ><\/div>\t\t\t\t\t<div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler">\t\t\t\t\t\t<div class="bm_popoutTop1">\t\t\t\t\t\t\t<div class="bm_popOutInner1">\t\t\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding OverflowCapsuleList}">\t\t\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t<DataTemplate>                                            <div class="bm_overflowItem" id="{Binding id}">                                                <a class="bm_overflowCardText" href="#" event:click="titleClickHandler" event:touchend="titleClickHandler" title="{Binding title}">                                                    <div class="{Binding imageClass}" id="bm_cardImage" />                                                    <span id="bm_overflowText">                                                        <TextBlock Text="{Binding title}" />                                                    <\/span>                                                <\/a>                                                <a class="bm_overflowCardClose" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" title="{StaticBinding resources.L_CloseTask_Text}" />                                            <\/div>\t\t\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<ul class="bm_addNewSearchContainer" style="display: none;" event:click="addNewSearchClick" event:mouseout="addSearchMouseOut" event:mouseover="addSearchMouseOver">\t\t<li class="bm_addNewSearchInnerContainer">\t\t\t<div class="bm_addNewSearchBox">\t\t\t\t<a class="bm_addNewSearchLink" role="button" />\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<div id="PreviousSearchTip">\t\tPrevious searches are here\t<\/div>    <div id="AddSearchTip">        Click to add a search    <\/div>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">\t\t<div id="bm_contexualAndRelatedContainer">\t\t\t<!-- Container for contextual taskbar -->\t\t\t<div id="bm_contextualTaskbarContainer" data-tag="contextFilters">\t\t\t<\/div>\t\t\t<!-- Container for Related Searches in taskbar -->\t\t\t<div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">\t\t\t<\/div>\t\t\t<!-- Container for Directions search along the route in taskbar -->\t\t\t<div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">\t\t\t<\/div>\t\t<\/div>\t\t<!-- Container for the category layer dropdown -->\t\t<div id="bm_categoryLayerDropdownContainer">\t\t<\/div>\t<\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',ru='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t<ul class="bm_overflowCountContainer" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut">\t\t\t\t\t\t<li class="bm_overflowCounter">\t\t\t\t\t\t\t<div class="bm_overflowBox">\t\t\t\t\t\t\t\t<div class="bm_overflowLink">\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t<div class="bm_overflowDropDown">\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/li>\t\t\t\t\t<\/ul>\t\t\t\t\t<ItemsControl ItemsSource="{Binding CapsuleList}">\t\t\t\t\t\t<ItemsControl.Template>\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t<ul class="bm_capsules_insidesearchbox"><ItemsPresenter /><\/ul>\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t<\/ItemsControl.Template>\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t<li class="bm_cardItem" id="{Binding id}">                                    <div class="bm_cardCapsule">\t\t\t\t\t\t\t\t\t\t<a class="bm_cardCapsuleText" role="button" event:click="titleClickHandler" event:touchend="titleClickHandler" event:mouseover="titleMouseoverHandler" event:mouseout="titleMouseoutHandler" href="#">\t\t\t\t\t\t\t\t\t\t\t<div class="{Binding imageClass}" id="bm_cardImage" />\t\t\t\t\t\t\t\t\t\t\t<div id="bm_titleText">\t\t\t\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding title}" />\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t\t<div id="CapsuleTip">\t\t\t\t\t\t\t\t\t\t\t\t<TextBlock Text="{Binding capsuleTitle}" />\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t<\/a>                                        <a class="bm_cardCapsuleClose" role="button" event:click="cardCloseHandler" event:touchend="cardCloseHandler" href="#" title="{Binding closeTitle}">                                            <div id="bm_cardCloseIcon"><\/div>                                        <\/a>                                    <\/div>\t\t\t\t\t\t\t\t<\/li>\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t\t\t\t\t\t<input id="maps_sb" type="search" role="combobox" title="{Binding resources.SearchGhostText}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox" placeholder="{Binding resources.SearchGhostText}"><\/input>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.SearchGhostText}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>                    <div class="bm_outsideBeak" ><\/div>\t\t\t\t\t<div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler">\t\t\t\t\t\t<div class="bm_popoutTop1">\t\t\t\t\t\t\t<div class="bm_popOutInner1">\t\t\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding OverflowCapsuleList}">\t\t\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t\t\t<DataTemplate>                                            <div class="bm_overflowItem" id="{Binding id}">                                                <a class="bm_overflowCardText" href="#" event:mouseover="overflowTitleMouseoverHandler" event:mouseout="overflowTitleMouseoutHandler" event:click="overflowTitleClickHandler" event:touchend="titleClickHandler" title="{Binding title}">                                                    <div class="{Binding imageClass}" id="bm_cardImage" />                                                    <span id="bm_overflowText">                                                        <TextBlock Text="{Binding title}" />                                                    <\/span>                                                <\/a>                                                <a class="bm_overflowCardClose" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" title="{Binding closeTitle}" />                                            <\/div>\t\t\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<div id="PreviousSearchTip">\t\tView all your searches\t<\/div>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">\t\t<div id="bm_contexualAndRelatedContainer">\t\t\t<!-- Container for contextual taskbar -->\t\t\t<div id="bm_contextualTaskbarContainer" data-tag="contextFilters">\t\t\t<\/div>\t\t\t<!-- Container for Related Searches in taskbar -->\t\t\t<div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">\t\t\t<\/div>\t\t\t<!-- Container for Directions search along the route in taskbar -->\t\t\t<div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">\t\t\t<\/div>\t\t<\/div>\t\t<!-- Container for the category layer dropdown -->\t\t<div id="bm_categoryLayerDropdownContainer">\t\t<\/div>\t<\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',uu='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">                <h1 class="b_logo b_taskLogo"><\/h1>            <\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" placeholder="{Binding resources.SearchGhostText}" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox"><\/input>                    <div class="searchButton">                        <a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />                    <\/div>                <\/div>                <div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding CapsuleList}">        <ItemsControl.Template>            <DataTemplate>                <ul class="bm_capsules_outsidesearchbox"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="bm_cardItem" id="{Binding id}">                    <div class="bm_cardCapsule">                        <a class="bm_cardCapsuleText" role="button" event:click="titleClickHandler" event:touchend="titleClickHandler" title="{Binding title}" href="#">                            <div class="{Binding imageClass}" id="bm_cardImage" />                            <div class="bm_capsuleText">                                <TextBlock Text="{Binding title}" />                            <\/div>                        <\/a>                        <a class="bm_cardCapsuleClose" role="button" event:click="cardCloseHandler" event:touchend="cardCloseHandler" href="#" title="{Binding closeTitle}">                            <div id="bm_cardCloseIcon"><\/div>                        <\/a>                    <\/div>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <ul class="bm_overflowCountContainer" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut">        <li class="bm_overflowCounter">            <div class="bm_overflowBox">                <a class="bm_overflowLink" role="button">                    <TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />                <\/a>            <\/div>        <\/li>    <\/ul>    <div class="bm_outsideBeak"><\/div>    <div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler">        <div class="bm_popoutTop1">            <div class="bm_popOutInner1">                <ItemsControl ItemsSource="{Binding OverflowCapsuleList}">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <div class="bm_overflowItem" id="{Binding id}" title="{Binding title}">                                <a class="bm_overflowCardText" href="#" event:click="titleClickHandler" event:touchend="titleClickHandler">                                    <div class="{Binding imageClass}" id="bm_cardImage" />                                    <span id="bm_overflowText">                                        <TextBlock Text="{Binding title}" />                                    <\/span>                                <\/a>                                <a class="bm_overflowCardClose" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" title="{Binding closeTitle}"/>                            <\/div>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/div>        <\/div>    <\/div>        <div id="ReactivateSearchTip">            Reactivate your previous search        <\/div>        <div id="PreviousSearchTip">            Previous searches are here        <\/div>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">        <div id="bm_contexualAndRelatedContainer">            <!-- Container for contextual taskbar -->            <div id="bm_contextualTaskbarContainer" data-tag="contextFilters">            <\/div>            <!-- Container for Related Searches in taskbar -->            <div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">            <\/div>            <!-- Container for Directions search along the route in taskbar -->            <div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">            <\/div>        <\/div>        <!-- Container for the category layer dropdown -->        <div id="bm_categoryLayerDropdownContainer">        <\/div>    <\/div>    <!-- The following is the close button for local overlay on serp -->    <div class="overlayCloseBtn">        <a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">            <div class="icon svg"><\/div>        <\/a>    <\/div><\/div>',pi='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t <input id="maps_sb" type="search" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox"><\/input>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<div class="bm_contextualAndShowMe" data-tag="contextualAndShowMe">\t\t<div id="bm_contexualAndRelatedContainer">\t\t\t<!-- Container for contextual taskbar -->\t\t\t<div id="bm_contextualTaskbarContainer" data-tag="contextFilters">\t\t\t<\/div>\t\t\t<!-- Container for Related Searches in taskbar -->\t\t\t<div id="bm_relatedSearchesTaskbarContainer" class="bm_relatedSearchesTaskbarContainer" style="display: none;" data-tag="contextRelatedSrch">\t\t\t<\/div>\t\t\t<!-- Container for Directions search along the route in taskbar -->\t\t\t<div id="bm_directionsTaskbarContainer" class="bm_directionsTaskbarContainer" style="display: none;" data-tag="contextDirSatrCat">\t\t\t<\/div>\t\t<\/div>\t\t<!-- Container for the category layer dropdown -->\t\t<div id="bm_categoryLayerDropdownContainer">\t\t<\/div>\t<\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',fu='<div class="bm_tooltips saveOnSerpConfirmation" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <div class="tooltipsIcon">        <\/div>        <div class="tooltipsIconText">            <TextBlock Text="{TemplateBinding IconText}" />        <\/div>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding PreLink}" />            <a href="#" event:click="onLinkClicked" class="tooltipsLink">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',eu='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">        <\/a>        <div class="tooltipsMessage">            <TextBlock Text="{TemplateBinding resources.L_Tooltip_Itinerary_Saved_Text}" />        <\/div>        <div class="tooltipsMessage secondLine" style:display="{TemplateBinding showEditName Converter=boolToNotDisplay}">            <TextBlock Text="{TemplateBinding Name}" />            <TextBlock Text="{TemplateBinding separator}" />            <a class="bm_renameLink" href="#" event:click="renameClicked"><TextBlock Text="{TemplateBinding resources.L_Tooltip_Rename_Button}" /><\/a>        <\/div>        <div class="nameInputContainer" style:display="{TemplateBinding showEditName Converter=boolToDisplay}">            <input type="text" class="nameEditBox" maxlength="100" value="{StaticBinding Name Mode=TwoWay}" event:keydown="onKeyPressed" />            <a href="#" class="bm_tooltipSaveButton" event:click="onSaveLinkClick" event:touchend="onSaveLinkClick">                <TextBlock Text="{TemplateBinding resources.L_Tooltip_Update_Button}" />            <\/a>        <\/div>    <\/div><\/div>',ou='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">    <\/a>    <div class="tooltipsText">        <div class="tooltipsHeader" style:display="{TemplateBinding Title Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding Title}" />        <\/div>        <ItemsControl ItemsSource="{TemplateBinding MessageLines}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="tooltipsMessage">                        <TextBlock Text="{Binding $self$}" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <span>                <TextBlock Text="{TemplateBinding PreLink}" />            <\/span>            <a href="{TemplateBinding linkUrl}" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <span>                <TextBlock Text="{TemplateBinding PostLink}" />            <\/span>        <\/div>        <div style:display="{TemplateBinding SignInTitle Converter=nullToDisplayNone}">            <SignInPopUpControl SignInMessage="{TemplateBinding SignInTitle}" event:signedIn="onSignedIn" />        <\/div>    <\/div><\/div>',a=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wi=function(n){function i(){var i=this,r=t;return i=n.call(this,br,"bm_BirdsEyeV2DialogContainer",{onCloseClick:function(n){return i._onCloseClick(n)}},{},r)||this}return a(i,n),i.prototype.showBEDialog=function(){this.OpenDialog()},i.prototype._onCloseClick=function(n){n&&n.preventDefault();this.CloseDialog();this.dispose()},i}(bt),su=function(i){function u(n,f,e){var o=i.call(this,e)||this;return dt=dt.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteAddLoc}",t.L_CmtControlAddLocationText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{editText}",t.L_CmtEditText).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText),o.setTemplate(new nt(dt,{stopEvent:function(n){return o._stopEvent(n)},onAddLocClicked:function(){return o._onAddLocClicked()},onDeleteClicked:function(n){return o._onDeleteClicked(n)},onTimeClicked:function(n){return o._onTimeClicked(n)},onPeakClicked:function(n){return o._onPeakClicked(n)},onEditClicked:function(){return o._onEditClicked()},onDoneClicked:function(){return o._onDoneClicked()}})),o._map=n,o._cmtFeatureConfig=h.features.commutability,o.defineProperty("addressValue"),o.defineProperty("addressTwoValue"),o._secondAddrEnabled=!1,o._time=u._defaultSelectedTime,o._departureTime=o._cmtFeatureConfig.peakTime,o._location=o._map.getBounds(!0).center,o._pushpinLayer=new oi("Commutability_Layer"),o._pushpin=new r.Pushpin(o._location,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle}),o._pushpinLayer.add(o._pushpin),r.Events.addHandler(o._pushpin,"dragend",function(n){return o._pushpinDragEnd(o._pushpin,n)}),o._isochroneOptions={intersectionOptions:{fillColor:o._cmtFeatureConfig.intersectFillColor,strokeColor:o._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:o._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:o._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:o._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!o._cmtFeatureConfig.showIntersection,showUnion:!!o._cmtFeatureConfig.showUnion,showIsochrones:!!o._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof o._cmtFeatureConfig.applyCardinalSpline=="boolean"?o._cmtFeatureConfig.applyCardinalSpline:!1},o._isochroneLayer=f,o._isochroneLayer.attachMap(o._map),o._isochroneLayer.setOptions(o._isochroneOptions),o._updateCompleteHandler=function(){return o._updateIsochroneCompleted()},o._isochroneLayer.downloadCompleted.add(o._updateCompleteHandler),o._isochroneLayers=[],r.loadModule("Microsoft.Maps.AutoSuggest",function(){var i=o._cmtFeatureConfig.autoSuggestMaxResult||5,n={maxResults:i,map:o._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},t=r.AutosuggestManager;o._asManagerOne=new t(n);o._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!0);p.logAddressChange(c.Autosuggest,!1)});o._asManagerTwo=new t(n);o._asManagerTwo.attachAutosuggest("#cmt_addressTwo","#cmt_addressDivTwo",function(n){o._processAutoSuggestResult(n.location,n.formattedSuggestion,!1);p.logAddressChange(c.Autosuggest,!0)});o.disposables.push(o._asManagerOne,o._asManagerTwo)}),o}return a(u,i),u.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);p.logColtrolActivation()},u.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);p.logColtrolDeactivation()},u.prototype.dispose=function(){var n,t,r;for(this.detachIsochrone(),n=0,t=this._isochroneLayers;n<t.length;n++)r=t[n],r.dispose();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer.dispose();i.prototype.dispose.call(this);l._clearDisposables(this.disposables);l._nullifyClass(this)},u.prototype.postInit=function(){var f=this,e,i,t;if((this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._addAddressButton=n("#cmt_BtmArea"),this._addressesSection=n("#cmt_addresses"),this._address=n("#cmt_addressOne"),this._addressOneClose=n("#cmt_delete_1"),this._addressTwo=n("#cmt_addressTwo"),this._addressTwoContainer=n("#cmt_addressDivTwo"),this._editButton=n("#cmt_edit"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1),this._cmtFeatureConfig.prefetch))for(e=r.IsochroneLayer,i=0;i<u._times.length;i++){if(u._times[i]===this._time){this._isochroneLayers.push(this._isochroneLayer);this._isochroneLayer.downloadError.add(function(n){return f._handleIsochroneError(n)});continue}t=new e;t.setOptions(this._isochroneOptions);t.attachMap(this._map);t.downloadError.add(function(n){return f._handleIsochroneError(n)});this._isochroneLayers.push(t)}},u.prototype._stopEvent=function(n){n.stopPropagation()},u.prototype._onEditClicked=function(){var r=n("#cmt_body"),t,i;r.remove_class("hidden");this._cmtContainer.remove_class("collapsed");this._editButton.add_class("hidden");this._doneButton.remove_class("hidden");this._adjustAutosuggestWidth();t=this._map.getNavigationBar().getLocateMeControl();i=t&&t.getGeochainControl();i&&i.setIsCollapsed(!0);p.logButtonClick(this._editButton.get_attr("id"))},u.prototype._onDoneClicked=function(){var t=n("#cmt_body");t.add_class("hidden");this._cmtContainer.add_class("collapsed");this._doneButton.add_class("hidden");this._editButton.remove_class("hidden");p.logButtonClick(this._doneButton.get_attr("id"))},u.prototype._onAddLocClicked=function(){var n=this;this._downloadingIsochrone||this._addAddressButton.has_class("hidden")||(this._addAddressButton.add_class("hidden"),this._addressOneClose.remove_class("hidden"),this._addressTwoContainer.remove_class("hidden"),this._secondAddrEnabled=!0,this.setAddressTwoValue(""),this._addressTwo.set_attr("value",""),this._locationTwo=this._map.getBounds(!0).center,this._pushpinTwo=new lr(this._locationTwo,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTwoTitle}),this._pushpinLayer&&this._pushpinLayer.add(this._pushpinTwo),r.Events.addHandler(this._pushpinTwo,"dragend",function(t){return n._pushpinDragEnd(n._pushpinTwo,t)}),this._cmtContainer.add_class("expanded"),this._addressesSection.add_class("expanded"),this._adjustAutosuggestWidth(),p.logButtonClick(this._addAddressButton.get_attr("id")))},u.prototype._onDeleteClicked=function(n){if(!this._downloadingIsochrone){var t=n.target,i=t.id;i==="cmt_delete_1"&&(this._location=this._locationTwo,this._pushpin.setLocation(this._location),this.setAddressValue(this.getAddressTwoValue()),this._address.set_attr("value",this.getAddressValue()));this._addAddressButton.remove_class("hidden");this._addressOneClose.add_class("hidden");this._addressTwoContainer.add_class("hidden");this._cmtContainer.remove_class("expanded");this._addressesSection.remove_class("expanded");this._pushpinLayer.remove(this._pushpinTwo);this._secondAddrEnabled=!1;this._updateMapView();this._updateIsochrone();this._updateTitle();this._adjustAutosuggestWidth()}},u.prototype._onTimeClicked=function(t){var f=t.target,i=f.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=u._timeButtonIds.indexOf(i),this._changeSelectedTime(r),p.logButtonClick(i))},u.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),this._updateIsochrone(),this._updateTitle(),p.logButtonClick(i))},u.prototype._processAutoSuggestResult=function(n,t,i){var r=i?this._location:this._locationTwo;wt.areEqual(r,n,!0)||(i?(this._location=n,this.setAddressValue(t),this._pushpin.setLocation(n)):(this._locationTwo=n,this.setAddressTwoValue(t),this._pushpinTwo.setLocation(n)),this._updateMapView(),this._updateIsochrone(),this._updateTitle())},u.prototype._updateIsochrone=function(){var i,n,t,f,r,e;for(this._resetTimeButtons(),this.getAddressValue()||this._reverseGeocode(this._location,1),this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue()),this._secondAddrEnabled&&this._addressTwo.set_attr("value",this.getAddressTwoValue()),i=null,(!this._peakButton||this._peakButton.has_class("selected"))&&(i="timeWithTraffic"),n=0;n<u._times.length;n++)(t=u._times[n],this._cmtFeatureConfig.prefetch||t===this._time)&&(f=this._buildRequest(t,i,1),r=[f],this._secondAddrEnabled&&this.getAddressTwoValue()&&(e=this._buildRequest(t,i,2),r.push(e)),t===this._time?(this._setControlBusy(!0),this._isochroneLayer.setRequests(r)):this._isochroneLayers&&this._isochroneLayers.length>n&&this._isochroneLayers[n]&&this._isochroneLayers[n].setRequests(r))},u.prototype._buildRequest=function(n,t,i){var u=this._location,f=this._cmtFeatureConfig.isochroneOneFillColor,r;return i===2&&(u=this._locationTwo,f=this._cmtFeatureConfig.isochroneTwoFillColor),r={maxTime:n,startPoint:u,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:f,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}},r.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,r.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,r.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,r},u.prototype._updateMapView=function(){var i=[this._location];this._locationTwo&&!wt.areEqual(this._location,this._locationTwo)&&i.push(this._locationTwo);var n=this._map.getMode().getMapViewForLocationsInView(i),r=vt.fromLocation(n.cameraLocation,!1),u=this._map.getMercatorZoomLevel();if(r>u){var t=this._map.getViewportPadding(),f=this._map.getViewport(),e=new tt(t.left,t.top),o=new tt(f.pixelWidth-t.right,f.pixelHeight-t.bottom),s=new tt((e.x+o.x)/2,(e.y+o.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,u-r)}this._map.setView(n)},u.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}});this._asManagerTwo.setOptions({serpOptions:{width:n}})},u.prototype._pushpinDragEnd=function(n,t){n===this._pushpin?(this._location=t.location,this._reverseGeocode(t.location,1),p.logAddressChange(c.POI,!1)):n===this._pushpinTwo&&(this._locationTwo=t.location,this._reverseGeocode(t.location,2),p.logAddressChange(c.POI,!0));this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateTitle=function(){var u=this.getAddressValue(),i=u&&u.split(",")[0],n,r,f;this._secondAddrEnabled&&this.getAddressTwoValue()&&(n=this.getAddressTwoValue(),n&&(n=n.split(",")[0]),i!==n&&(i=t.L_CmtTitleAddresses.replace("{addr1}",i).replace("{addr2}",n)));r=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text;r=r.toLowerCase();f=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",i).replace("{trafficCondition}",r);this._title.set_text(f);var e=parseInt(this._title.get_style("height")),o=parseInt(this._title.get_style("lineHeight")),s=Math.round(e/o);s===1?this._title.set_style({padding:"9px 0px"}):this._title.set_style({padding:"0px"})},u.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},u.prototype._handleIsochroneError=function(t){var f=t.isochroneLayer,i,e,r;if(f&&(i=0,i=this._cmtFeatureConfig.prefetch?this._isochroneLayers.indexOf(f):u._times.indexOf(this._time),e=u._timeButtonIds[i],r=n("#"+e),(r&&r.has_class("selected")||!this._cmtFeatureConfig.prefetch)&&(this._setControlBusy(!1),this._changeSelectedTime(0)),!r.has_class("disabled")))while(i<u._timeButtonIds.length)this._enableTimeButton(i,!1),i++},u.prototype._changeSelectedTime=function(n){if(this._selectTimeButton(n),this._cmtFeatureConfig.prefetch){this._isochroneLayer.downloadCompleted.remove(this._updateCompleteHandler);var t=this._map.getLayers();t.remove(this._isochroneLayer);this._isochroneLayer=this._isochroneLayers[n];this._isochroneLayer.downloadCompleted.add(this._updateCompleteHandler);t.insert(this._isochroneLayer);this._isochroneLayer.downloading||this._isochroneLayer.getIsochrones().length!==0||this._updateIsochrone()}else this._updateIsochrone();this._isochroneLayer.downloading&&this._setControlBusy(!0);this._updateTitle()},u.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=u._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=u._times[t]}},u.prototype._resetTimeButtons=function(){for(var f,r,t=0,i=u._timeButtonIds;t<i.length;t++)f=i[t],r=n("#"+f),r&&r.remove_class("disabled")},u.prototype._enableTimeButton=function(t,i){var r=n("#"+u._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},u.prototype._reverseGeocode=function(n,t){var i=this,r=new ci;r.reverseGeocode(n,function(r){var u="";u=r&&r.success&&r.addressList&&r.addressList.length>0&&r.addressList[0].formattedAddress?r.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t===1?(i.setAddressValue(u),i._address.set_attr("value",u)):(i.setAddressTwoValue(u),i._addressTwo.set_attr("value",u));i._updateTitle()})},u._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],u._defaultSelectedTime=15,u._times=[15,30,45,60],u._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',u}(ct),hu=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new tt(0,0);i=n.call(this,r,1,u)||this}return i}return a(t,n),t}(hi),cu=function(i){function u(n,e,o){var s=i.call(this,o)||this;return gt=gt.replace("{commuteControlTitle}",t.L_CmtControlTitleText).replace("{commuteTime30}",t.L_CmtControlCommuteTime30Text).replace("{commuteTime45}",t.L_CmtControlCommuteTime45Text).replace("{commuteTime60}",t.L_CmtControlCommuteTime60Text).replace("{commuteTime15}",t.L_CmtControlCommuteTime15Text).replace("{commutePeak}",t.L_CmtControlCommutePeak_Text).replace("{commuteOffPeak}",t.L_CmtControlCommuteOffPeak_Text).replace("{doneText}",t.L_CmtDoneText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{placeHolder}",t.L_CmtPlaceHolderText).replace("{errorMessage}",t.L_CmtErrorMessage),s.setTemplate(new nt(gt,{stopEvent:function(n){return s._stopEvent(n)},onTimeClicked:function(n){return s._onTimeClicked(n)},onPeakClicked:function(n){return s._onPeakClicked(n)},onDoneClicked:function(){return s._onDoneClicked()}})),s._map=n,s._cmtFeatureConfig=h.features.commutability,s.defineProperty("addressValue"),s._time=u._defaultSelectedTime,s._departureTime=s._cmtFeatureConfig.peakTime,s._location=s._map.getBounds(!0).center,s._pushpinLayer=new oi("Commutability_Layer"),s._isochroneOptions={intersectionOptions:{fillColor:s._cmtFeatureConfig.intersectFillColor,strokeColor:s._cmtFeatureConfig.isochroneStrokeColor,strokeThickness:s._cmtFeatureConfig.isochroneStrokeThickness,secondaryStrokeColor:s._cmtFeatureConfig.isochroneSecondaryStrokeColor,secondaryStrokeThickness:s._cmtFeatureConfig.isochroneSecondaryStrokeThickness},showIntersection:!!s._cmtFeatureConfig.showIntersection,showUnion:!!s._cmtFeatureConfig.showUnion,showIsochrones:!!s._cmtFeatureConfig.showIsochrones,applyCardinalSpline:typeof s._cmtFeatureConfig.applyCardinalSpline=="boolean"?s._cmtFeatureConfig.applyCardinalSpline:!1},s._isochroneLayer=e,s._isochroneLayer.attachMap(s._map),s._isochroneLayer.setOptions(s._isochroneOptions),s._updateCompleteHandler=function(){return s._updateIsochroneCompleted()},s._isochroneLayer.downloadCompleted.add(s._updateCompleteHandler),s._isochroneLayer.downloadError.add(function(n){return s._handleIsochroneError(n)}),s.disposables.push(s.doneClickedEvent=new f),s.disposables.push(s.pushpinClickedEvent=new f),r.loadModule("Microsoft.Maps.AutoSuggest",function(){var n=s._cmtFeatureConfig.autoSuggestMaxResult||5,t={maxResults:n,map:s._map,serpOptions:{showMyLocation:!0,suggestionTypes:"place,business,address",selectFirstOnEnter:!0}},i=r.AutosuggestManager;s._asManagerOne=new i(t);s._asManagerOne.attachAutosuggest("#cmt_addressOne","#cmt_addressDivOne",function(n){s._processAutoSuggestResult(n.location,n.formattedSuggestion);p.logAddressChange(c.Autosuggest,!1)});s._adjustAutosuggestWidth();s.disposables.push(s._asManagerOne)}),s}return a(u,i),u.prototype.attachIsochrone=function(){this._map.getLayers().insertAll([this._isochroneLayer,this._pushpinLayer]);p.logColtrolActivation()},u.prototype.detachIsochrone=function(){this._map.getLayers().remove(this._isochroneLayer);this._map.getLayers().remove(this._pushpinLayer);p.logColtrolDeactivation()},u.prototype.dispose=function(){this.detachIsochrone();this._isochroneLayer&&this._isochroneLayer.dispose();this._pushpinLayer&&this._pushpinLayer.dispose();this._pushpin&&this._pushpin.dispose();i.prototype.dispose.call(this);l._clearDisposables(this.disposables);l._nullifyClass(this)},u.prototype.postInit=function(){(this._cmtContainer=n("#cmt_container"),this._cmtContainer)&&(this._title=n("#cmt_title"),this._address=n("#cmt_addressOne"),this._doneButton=n("#cmt_done"),this._peakButton=n("#cmt_peak"),this._loader=n("#cmt_loader"),this._error=n("#cmt_err"),this._currentSelectedTimeElement=n(".cmt_time.selected"),this._currentSelectedDepartureElement=n(".cmt_Depart .selected"),this._setControlBusy(!1))},u.prototype._stopEvent=function(n){n.stopPropagation()},u.prototype._onDoneClicked=function(){if(!this._doneButton.has_class("disabled")){if(this._pushpin){this._pushpin.setLocation(this._location);var n=t.L_CmtTooltipTitle.replace("{time}",this._time),i=t.L_CmtTooltipDescription;this._infobox.setHtmlContent(yi.replace("{title}",n).replace("{description}",i));this._infobox.setLocation(this._location)}else this._showPinAndInfobox();this._updateIsochrone();this._updateTitle();this.doneClickedEvent.invoke();p.logButtonClick(this._doneButton.get_attr("id"))}},u.prototype._onTimeClicked=function(t){var f=t.target,i=f.id,r;this._downloadingIsochrone||i===this._currentSelectedTimeElement.get_attr("id")||n("#"+i).has_class("disabled")||(r=u._timeButtonIds.indexOf(i),this._changeSelectedTime(r),p.logButtonClick(i))},u.prototype._onPeakClicked=function(t){var r=t.target,i=r.id;this._downloadingIsochrone||i===this._currentSelectedDepartureElement.get_attr("id")||(this._departureTime=i==="cmt_peak"?this._cmtFeatureConfig.peakTime:this._cmtFeatureConfig.offPeakTime,this._currentSelectedDepartureElement.remove_class("selected"),this._currentSelectedDepartureElement=n("#"+i),this._currentSelectedDepartureElement.add_class("selected"),p.logButtonClick(i))},u.prototype._processAutoSuggestResult=function(n,t){this._doneButton.remove_class("disabled");var i=this._location;this._pushpin&&wt.areEqual(i,n,!0)||(this._location=n,this.setAddressValue(t),this._hideInfobox(0),this._updateMapView())},u.prototype._updateIsochrone=function(){var n,t,i;this._resetTimeButtons();this._hideInfobox(0);this._error.add_class("hidden");this.getAddressValue()||this._reverseGeocode(this._location);this.getAddressValue()!==this._address.get_attr("value")&&this._address.set_attr("value",this.getAddressValue());n=null;(!this._peakButton||this._peakButton.has_class("selected"))&&(n="timeWithTraffic");t=this._buildRequest(this._time,n);i=[t];this._setControlBusy(!0);this._isochroneLayer.setRequests(i)},u.prototype._buildRequest=function(n,t){var r=this._location,u=this._cmtFeatureConfig.isochroneOneFillColor,i={maxTime:n,startPoint:r,departTime:this._departureTime,optimize:t,displayOptions:{fillColor:u,strokeColor:this._cmtFeatureConfig.isochroneStrokeColor}};return i.displayOptions.strokeThickness=this._cmtFeatureConfig.isochroneStrokeThickness,i.displayOptions.secondaryStrokeColor=this._cmtFeatureConfig.isochroneSecondaryStrokeColor,i.displayOptions.secondaryStrokeThickness=this._cmtFeatureConfig.isochroneSecondaryStrokeThickness,i},u.prototype._updateMapView=function(){var o=[this._location],n=this._map.getMode().getMapViewForLocationsInView(o),i=vt.fromLocation(n.cameraLocation,!1),r=this._map.getMercatorZoomLevel();if(i>r){var t=this._map.getViewportPadding(),u=this._map.getViewport(),f=new tt(t.left,t.top),e=new tt(u.pixelWidth-t.right,u.pixelHeight-t.bottom),s=new tt((f.x+e.x)/2,(f.y+e.y)/2);n=this._map.getMode().getMapViewZoomedAboutLocationAtPoint(n,n.cameraLocation,s,r-i)}this._map.setView(n)},u.prototype._adjustAutosuggestWidth=function(){var n=this._address.get_size().width;this._asManagerOne.setOptions({serpOptions:{width:n}})},u.prototype._pushpinDragEnd=function(n,t){this._location=t.location;this._reverseGeocode(t.location);this._hideInfobox(0);p.logAddressChange(c.POI,!1);this._downloadingIsochrone?this._updateWhenDownloadFinish=!0:(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateIsochroneCompleted=function(){this._setControlBusy(!1);this._updateWhenDownloadFinish&&(this._updateIsochrone(),this._updateWhenDownloadFinish=!1)},u.prototype._updateTitle=function(){var i=this.getAddressValue(),u=i&&i.split(",")[0],n=this._peakButton.has_class("selected")?t.L_CmtControlCommutePeak_Text:t.L_CmtControlCommuteOffPeak_Text,r;n=n.toLowerCase();r=t.L_CmtTitle.replace("{time}",this._time).replace("{addresses}",u).replace("{trafficCondition}",n);this._title.set_text(r)},u.prototype._setControlBusy=function(n){this._downloadingIsochrone=n;n?(this._loader&&this._loader.remove_class("hidden"),this._cmtContainer&&this._cmtContainer.add_class("disabled")):(this._cmtContainer&&this._cmtContainer.remove_class("disabled"),this._loader&&this._loader.add_class("hidden"))},u.prototype._handleIsochroneError=function(){this._setControlBusy(!1);this._error.remove_class("hidden")},u.prototype._changeSelectedTime=function(n){this._selectTimeButton(n);this._isochroneLayer.downloading&&this._setControlBusy(!0)},u.prototype._selectTimeButton=function(t){if(t>=0){this._currentSelectedTimeElement.remove_class("selected");var i=u._timeButtonIds[t];this._currentSelectedTimeElement=n("#"+i);this._currentSelectedTimeElement&&this._currentSelectedTimeElement.add_class("selected");this._time=u._times[t]}},u.prototype._resetTimeButtons=function(){for(var f,r,t=0,i=u._timeButtonIds;t<i.length;t++)f=i[t],r=n("#"+f),r&&r.remove_class("disabled")},u.prototype._enableTimeButton=function(t,i){var r=n("#"+u._timeButtonIds[t]);r&&(i?r.remove_class("disabled"):r.add_class("disabled"))},u.prototype._reverseGeocode=function(n){var t=this,i=new ci;i.reverseGeocode(n,function(i){var r="";r=i&&i.success&&i.addressList&&i.addressList.length>0&&i.addressList[0].formattedAddress?i.addressList[0].formattedAddress:n.latitude.toFixed(4)+","+n.longitude.toFixed(4);t.setAddressValue(r);t._address.set_attr("value",r);t._updateTitle()})},u.prototype._showPinAndInfobox=function(){var f=this,n,i;this._pushpin=new r.Pushpin(this._location,{icon:u._iconSvg,draggable:!0,text:t.L_CmtControlPushpinTitle});this._attachPushpinEventHandlers();this._pushpinLayer.add(this._pushpin);n=t.L_CmtTooltipTitle.replace("{time}",this._time);i=t.L_CmtTooltipDescription;this._infobox=new er(this._location,{htmlContent:yi.replace("{title}",n).replace("{description}",i),visible:!0,closeDelayTime:u._closeDelayTime,offset:u._tooltipAnchorOffset});this._infobox.setMap(this._map);this._infobox.mouseleave.addOne(function(){f._hideInfobox(0)})},u.prototype._hideInfobox=function(n){this._infobox&&this._infobox.getVisible()&&this._infobox.setOptions({closeDelayTime:n,visible:!1})},u.prototype._attachPushpinEventHandlers=function(){var n=this;this._pushpin.mouseover=new f;this._pushpin.mouseout=new f;this._pushpin.dragstart=new f;this._pushpin.dragend=new f;this._pushpin.click=new f;this.disposables.push(this._pushpin.mouseout.add(function(){return n._hideInfobox(0)}),this._pushpin.mouseover.add(function(){n._infobox.setOptions({visible:!0})}),this._pushpin.dragstart.add(function(){return n._hideInfobox(0)}),this._pushpin.dragend.add(function(t){n._infobox.setLocation(n._pushpin.getLocation());n._pushpinDragEnd(n._pushpin,t)}),this._pushpin.click.add(function(){n.pushpinClickedEvent&&n.pushpinClickedEvent.invoke()}))},u._timeButtonIds=["cmt_time15","cmt_time30","cmt_time45","cmt_time60"],u._defaultSelectedTime=15,u._times=[15,30,45,60],u._iconSvg='<svg width="24" height="31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M11 0C4.924 0 0 4.924 0 11c.011 1.666.708 3.474 1.68 5.348 1.668 3.173 4.223 6.517 6.125 8.822a91.61 91.61 0 0 0 2.517 2.898.906.906 0 0 0 1.35 0 91.509 91.509 0 0 0 2.516-2.898 76.508 76.508 0 0 0 2.587-3.306c1.278-1.734 2.561-3.648 3.54-5.516C21.292 14.474 21.99 12.667 22 11 22 4.924 17.076.002 11 0z" id="a"/><path id="b" d="M0 .25h12v7.008H0z"/><path id="d" d="M0 9.75h12V1H0z"/><\/defs><g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" fill-rule="nonzero"><use fill="#111" fill-rule="evenodd" xlink:href="#a"/><path stroke="#FFF" d="M11-.5c6.352.002 11.5 5.149 11.5 11.503-.01 1.617-.6 3.386-1.742 5.577-.907 1.73-2.117 3.595-3.58 5.58a76.458 76.458 0 0 1-2.604 3.328c-.75.91-1.638 1.926-2.53 2.915a1.406 1.406 0 0 1-2.094 0 89.323 89.323 0 0 1-2.531-2.915c-2.55-3.09-4.732-6.15-6.184-8.91C.097 14.382-.489 12.618-.5 11-.5 4.648 4.648-.5 11-.5z"/><\/g><g transform="translate(6 7.75)"><mask id="c" fill="#fff"><use xlink:href="#b"/><\/mask><path d="M2.88 5.12a1.25 1.25 0 1 0-1.76 1.777A1.25 1.25 0 0 0 2.88 5.12zM10 3H1a1 1 0 0 0-1 1v1.39a2.09 2.09 0 0 1 3.48-.87c.396.391.619.923.62 1.48h2.8a2.1 2.1 0 1 1 4.2 0h.9V5a2 2 0 0 0-2-2zM8.11 5.11A1.25 1.25 0 1 0 9 4.75a1.25 1.25 0 0 0-.88.37l-.01-.01zM7.29.54a.997.997 0 0 0-.71-.29h-4a1 1 0 0 0-.89.55L1 2.25h8L7.29.54z" fill="#FFF" mask="url(#c)"/><\/g><\/g><\/svg>',u._closeDelayTime=5e3,u._tooltipAnchorOffset=new tt(15,-15),u}(ct),lu=function(n){function t(t){var i=this;if(t){var r=t.getRootElement(),u=new tt(0,0);i=n.call(this,r,1,u)||this}return i}return a(t,n),t}(hi),p=function(){function n(){}return n.logAddressChange=function(t,i){var r={logData:{feature:v.Commutability,action:n.AddressChange,data:{METHOD:t,IS:i}}};o.invokeHandler(e.instrumentationDataHandlerKey,r)},n.logButtonClick=function(n){var t={logData:{feature:v.Commutability,action:g.Clicked,data:{BID:n}}};o.invokeHandler(e.instrumentationDataHandlerKey,t)},n.logColtrolActivation=function(){var n={logData:{feature:v.Commutability,action:g.Activated,data:{EP:c.ContextMenu}}};o.invokeHandler(e.instrumentationDataHandlerKey,n)},n.logColtrolDeactivation=function(){var n={logData:{feature:v.Commutability,action:g.Deactivated,data:{EP:c.ContextMenu}}};o.invokeHandler(e.instrumentationDataHandlerKey,n)},n}(),ni;(function(i){function g(t,u){var v=this,o,e;(r=n("#b_TriviaOverlay"),!r||r.length===0||h.isMapsAnswer||h.isSDK)||(l=u,a=t,i.serializableObjectChanged=new f,c=0,o=a.getContainer(),o.instanceAsync("BrowserHistoryManager",function(n){s=n;s&&s.register("MktTourHelper",v)},null,!0),e=r.select(".ulcSlides .slideImage"),e.length>0&&(e.for_each(function(n){var i=n.getAttribute("data-task"),t;i&&(t=n.getAttribute("data-serpquery"),t||n.addEventListener("click",function(n){return nt(n)}))}),ut(),ft()),sj_cook.set("_SS","BTQID","-",!1,"/"),k(e),ot(),sj_evt.bind("ovlShow",st))}function nt(n){var t=n.currentTarget,i,u,f;t.classList.contains("sldShown")||t.classList.contains("inactive")||(t.classList.add("sldShown"),c=Number(t.getAttribute("data-slideid")),p(),k(r.select(".ulcSlides .slideImage")),w(),b(t),y(),i=JSON.parse(t.getAttribute("data-task")),u=i&&i.state,o.invokeHandler(e.taskDataHandlerKey,i),f=u.query||u.taskTitle||u.title,v(f),d())}function tt(t){if(t!==null&&t.activeSlideId!=="undefined"&&t.activeSlideId>-1){var i=t.activeSlideId,u=r.select(".ulcSlides .slideImage");u.length>0&&(u.for_each(function(t){var r=Number(t.getAttribute("data-slideId"));r<=i?n(t).add_class("sldShown"):(n(t).remove_class("sldShown"),r>i+1&&n(t).add_class("inactive"))}),w(i),i>0&&y(),b(u[i]));c=i}}function it(){return{activeSlideId:c}}function rt(n){tt(n)}function ut(){var n=r.select(".nextULC .slideImage.btSINext");n&&n.length>0&&n.add_event("click",function(t){var f=_w.btULCinfo,s=n.get_attr("data-slideid"),h=Number(s),i,u;h===f.totalSlide?(t.preventDefault(),t.stopImmediatePropagation(),c=0,i=JSON.parse(n.get_attr("data-task")),i&&(p(),f.summaryPageUrl="",n.set_attr("data-url",""),o.invokeHandler(e.taskDataHandlerKey,i),v(""),et()),r.select("#rqCloseBtn").fireEvent("click")):(u=r.select(".btsImg"+n.get_attr("data-slideid")),u&&u.fireEvent("click"))})}function ft(){var n=r.select("#rqCloseBtn");n&&n.length>0&&n.add_event("click",function(){s&&s.unregister("MktTourHelper")})}function et(){var n=document.getElementById("maps_sb");n&&(n.placeholder=t.SearchGhostText,n.focus())}function v(n){var t=document.getElementById("maps_sb");t&&(t.value=n)}function y(){var n="_SS";sj_cook.set(n,"BTQID","-",!1,"/");sj_cook.set(n,"BTSID","-",!1,"/");sj_cook.set(n,"BTSlClk","-",!1,"/");sj_cook.set(n,"BTOID","-",!1,"/");sj_cook.set(n,"BTMC","-",!1,"/");sj_cook.set(n,"BTULCTtl","-",!1,"/")}function p(){l.removeAllStacks(!1)}function w(n){var i=r.select(".slideImage.btSINext"),f,t,e,u;i.length>0&&(n=n===null||n===undefined?Number(i.get_attr("data-slideid")):n,f=n+1,t=_w.btULCinfo,t&&(t.currentSlide=n,e=r.select(".btsImg"+f),u=r.select(".btULCTeaser"),i.set_attr("data-slideId",f.toString()),f===t.totalSlide?(u.length>0&&u.set_text(i.get_attr("data-title")),t.summaryPageUrl=i.get_attr("data-Url"),t.slideCompleted=!0):e.length>0&&u.length>0&&u.set_text(e.get_attr("title"))))}function b(n){var i=r.select(".bt_title"),t;i.set_text(n.getAttribute("data-title"));t=r.select(".bt_desc");t.set_text(n.getAttribute("data-description"))}function ot(){var t,i;r.select(".ulcSlides").set_style({width:"calc(100% - 280px)"});t=n("#b_footer");t&&t.length>0&&(i=n("ul",t[0]),i&&i.length>0&&t.insertBefore(r,i[0]));d()}function k(n){if(n.length!==0){var t=-1;n.for_each(function(n){n.classList.contains("sldShown")?t=Number(n.getAttribute("data-slideid")):Number(n.getAttribute("data-slideid"))-t>1?n.classList.contains("inactive")||n.classList.add("inactive"):n.classList.contains("inactive")&&n.classList.remove("inactive")})}}function d(){var t=n(".overlayPanel",r[0]),i;t&&t.length>0&&(t.set_style({"margin-top":"0","background-color":"#fafafa"}),u=t.get_style("height"),r.set_style({height:u}),i=n(".btOverlay",r[0]),i&&i.length>0&&i.set_style({bottom:"auto",height:u}))}function st(){var t,r,i,f;if(u&&(t=n(".ent_ovlc"),t&&t.length>0))for(r=0;r<t.length;r++)i=n(".ovl",t[r]),i&&i.length>0&&(i.set_style({bottom:u}),f=n("ovlbg",i[0]),f&&f.length>0&&f.set_style({bottom:u}))}var r,l,a,s,c,u;i.initialize=g;i.serialize=it;i.deserialize=rt})(ni||(ni={}));var w=function(){function n(){}return n.log=function(t,i,r){o.invokeHandler(e.instrumentationDataHandlerKey,{logData:{feature:n.Feature,action:t,data:i},flush:r})},n.Feature="PRT",n.Submit="S",n.Activate="A",n.Deactivate="D",n.TaskBar="T",n.Filter="FLTR",n.TaskCardHeader="H",n.TaskType="TYP",n.MapOnly="MO",n.TextOnly="TO",n.MapAndText="MAT",n}(),au=function(i){function u(r){var u=this,o={},s=t,e={};return u=i.call(this,kr,"PrintContainer",e,o,s)||this,u._poiLayers=[],u._map=r,u._window=n(window),u.resources=s,u._printMapReady=!1,u._printDisplayOption=0,u.onPrintDialogClose=new f,u.onPrintDialogOpen=new f,u.generateContextMapUrl(),e.onPrintClick=function(n){return u._onPrintClick(n)},e.onCloseClick=function(n){return u._onCloseClick(n)},e.onMouseWheel=function(n){return u._onMouseWheel(n)},e.onMapTextClick=function(n){n.preventDefault();n.stopImmediatePropagation();u._toggleMapAndText(!0,!0,u.getRootElement().select(".printMapAndText"))},e.onMapOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();u._toggleMapAndText(!0,!1,u.getRootElement().select(".printMapOnly"))},e.onTextOnlyClick=function(n){n.preventDefault();n.stopImmediatePropagation();u._toggleMapAndText(!1,!0,u.getRootElement().select(".printTextOnly"))},u.notesMaxCharSize=it.notesMaxChars,o.defineProperty("printContentList"),u.setPrintContentList(new at),u}return a(u,i),u.prototype.loadPrintMap=function(){var e=this,t,u,f;i.prototype.OpenDialog.call(this);t=this.getRootElement();u=t.getParent().select(".defaultPrintMessage");u.swap_class("showPrintErrorMessage","hidePrintErrorMessage");t.select(".PrintContainer").set_attr("data-tag","PrintContainer");this._hasPrintableTasks=this._getPrintTasksAvailable();this._hasPrintableTasks&&(n(".PrintContainer .baseMapPrint").removeFromParent(),this._addPrintPreviewContent());this._mapHolder=n(".PrintContainer .printMap");f={mapType:this._map.getMapType().id,zoom:this._map.getMercatorZoomLevel(),credentials:it.credentials,navigationOptions:{lockCameraAltitude:!1,lockCameraHeading:!0},enableInertia:!1,disableDiffFrame:!0,showLandmarks:!0,isPrintMode:!0,showLogo:!0,showLocateMeButton:!1,disableStreetside:!0,disableStreetsideAutoCoverage:!0,labelOptions:{labelVisibility:this._map.getLabelController().getIsLabelsEnabled()?ai.visible:ai.hidden},heading:this._map.getView().heading};r.loadMap({element:this._mapHolder,mapOptions:f},function(n){return e._finishPrintMapSetup(n)},!0)},u.prototype.addPrintContent=function(n){n&&this.getPrintContentList().insert(n)},u.prototype.setDialogSize=function(n){if(n.height&&n.width){var t=this.getRootElement();t.select(".printContent").set_style({height:(n.height>u.BaseMapHeaderFooterPadding?n.height-u.BaseMapHeaderFooterPadding:0)+"px"})}},u.prototype.onWindowResize=function(){this.setDialogSize(new li(window.innerWidth,window.innerHeight))},u.prototype._onMouseWheel=function(n){this._mapEditOn&&n.preventDefault();n.stopPropagation()},u.prototype._toggleMapAndText=function(n,t,i){var r=this.getRootElement(),u;r.select(".isMap").swap_class(n?"hideMap":"showMap",n?"showMap":"hideMap");r.select(".isText").swap_class(t?"hideText":"showText",t?"showText":"hideText");u=n&&!t;r.select(".taskMapPrint").swap_class(u?"taskMapPrintPageBreak":"taskMapPrintNoPageBreak",u?"taskMapPrintNoPageBreak":"taskMapPrintPageBreak");this.getRootElement().select(".mapTextOptions").remove_class("selected");i.add_class("selected");this._printDisplayOption=n?t?0:1:2;w.log(w.Filter,{CLK:n?t?w.MapAndText:w.MapOnly:w.TextOnly})},u.prototype._finishPrintMapSetup=function(t){var i=this,h,f,e,s,c,o,u;this._printMiniMap=t;h=st.getMapCenter(this._map);f=st.getMercatorZoomLevel(this._map);this._map.getMapType().id!==y.birdseye&&(f=f>2&&this._hasPrintableTasks?f-1:f);this._printMiniMap=t;this.disposables.push(this._printMiniMap);this._printMiniMap.setDesiredSize({width:-1,height:-1});this._printMiniMap.setView(new or(r.ZoomLevel.toLocation(h,f,!0),this._map.getView().heading),null);this._showMiniMapNavigationBar(!1);e=this.getRootElement();s=this._hasPrintableTasks?"taskMap":"baseMap";e.select(".printMap").add_class(s);e.select(".printArea").add_class(s);this.setDialogSize(new li(window.innerWidth,window.innerHeight));this._windowSizeHandler=function(){return i.onWindowResize()};this._window.add_event("resize",this._windowSizeHandler);e.select(".printContent")[0].scrollTop=0;n(".mapAndTextPrint").set_style({display:this._hasPrintableTasks?"inline":"none"});c=t.getContainer();c.instanceAsync("MapInteraction",function(n){i._mapInteraction=n;n.setOptions({disableAllInteractions:!0});n.disableInteractionModes(704)});n(".taskPrintContent").add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0});this._printMiniMap.getOverlayManager().then(function(){var e,o,t,r,u,n,f;for(i._updateLandmarkClickBehavior(),e=i.getPrintContentList(),o=i.getRootElement().select(".taskPrintContent"),t=0;t<e.length;t++){for(r=e[t],i._hasPrintableTasks||i._addContentToDom(r,o,t),u=r.getLayers(),n=0;u&&n<u.length;n++)i._addLayer(u[n]);for(f=r.getLayerIds(),n=0;f&&n<f.length;n++)i.addLayerPois(f[n])}i.onPrintDialogOpen.invoke();i._printMapReady=!0;i._addEditButton();i._isPrinted=!1});this._hasPrintableTasks?(o=n(".printMapAndText"),o&&o.length>0?o[0].focus():(u=n(".waypointNotes")?n(".waypointNotes"):n(".searchNotes")?n(".searchNotes"):n("#baseMapNotes"),u&&u.length>0&&u[0].focus())):(u=n("#baseMapNotes"),u&&u.length>0&&u[0].focus())},u.prototype.generateContextMapUrl=function(){var i=it.printImgOverviewMapUrlFormat,t=st.getMapCenter(this._map),r=it.credentials,n=st.getMercatorZoomLevel(this._map);n=n>4?n-2:2;this.overviewContextMap=i.replace("{credentials}",it.credentials).replace("{zoom}",n.toString()).replace("{lat}",t.latitude.toString()).replace("{lon}",t.longitude.toString()).replace("{culture}",h.dynamicProperties.market)},u.prototype._addEditButton=function(){var u=this,r=this.getRootElement().select(".printArea"),t,n,i;r&&(t=l._createElement("div"),t.add_class("bm_mapEditButton"),t.set_attr("data-tag","mapEditButton"),n=l._createElement("a"),n.add_class("textButton"),n.set_attr("href","#"),n.set_attr("role","button"),n.set_attr("data-tag","editButton"),n[0].innerHTML=this.resources.L_EditMap_Text,t.append(n),i=this.getRootElement().select(".printMap"),i&&i.length>0?r[0].insertBefore(t[0],i[0]):r.append(t),n.add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0;u._toggleEditMap(n)}))},u.prototype._toggleEditMap=function(n){this._mapEditOn=n.target.innerHTML===this.resources.L_EditMap_Text;n.target.innerHTML=this._mapEditOn?this.resources.L_EditMapDone_Text:this.resources.L_EditMap_Text;this._mapInteraction.setOptions({disableAllInteractions:!this._mapEditOn});this._showMiniMapNavigationBar(this._mapEditOn)},u.prototype._addPrintPreviewContent=function(){for(var i=this.getPrintContentList(),r=this.getRootElement().select(".taskPrintContent"),t=0;t<i.length;t++)this._addContentToDom(i[t],r,t);n(".svg",this.getRootElement()[0]).inlineDataSvgs().remove_class("svg")},u.prototype._addContentToDom=function(n,t,i){var u=n&&n.getHtmlContent(),f=n&&n.getCssScope(),r;u&&(r=l._createElement("div"),r.add_class(i==0?"bm_firstTaskContent":"bm_taskContent"),r.set_attr("data-tag","taskContent-"+i),f&&r.add_class(f),r[0].innerHTML=u,t.append(r))},u.prototype._getPrintTasksAvailable=function(){for(var t=this.getPrintContentList(),n=0;n<t.length;n++)if(t[n].getHtmlContent()!=null)return!0;return!1},u.prototype._updateLandmarkClickBehavior=function(){this._printMiniMap.getLandmarksManager().then(function(n){n.removePrimitiveTapped();n.removePrimitiveHover()})},u.prototype._addLayer=function(n){if(n){var t=this._printMiniMap.getLayers();t.insert(n);this._poiLayers.push(n)}},u.prototype.addLayerPois=function(n){var r=this._printMiniMap.getLayers(),t=ti.getMapLayerById(n,this._map),s=t.getZIndex(),f,o,h,e,i;if(t.getVisible()&&n!=="Microsoft.Maps.StreetsideCoverage")if(t instanceof kt){for(f=0;f<r.length;f++)if(o=r[f],o&&o.getId()===n)return;h=t;e=new kt(u.PrintLayerPrefix+t.getId(),h.getDataSource(),t.getTemplateSelector(),s);e.setRenderTarget(t.getRenderTarget());r.insert(e);this._poiLayers.push(e)}else if(t instanceof pt){var a=t,c=this._map.getView(),l=a.getScene(null,st.getMapCenter(this._map),vt.toScale(c.cameraLocation,vt.fromLocation(c.cameraLocation,!0),!0),0);l!=null&&(i=new pt(u.PrintLayerPrefix+t.getId(),s),i.setRenderTarget(t.getRenderTarget()),i.addScene(10,l,0),r.insert(i),this._poiLayers.push(i))}},u.prototype._removeLayerPois=function(){for(var t=this._printMiniMap.getLayers(),n=this._poiLayers.pop();n;)t.remove(n),n.dispose(),n=this._poiLayers.pop()},u.prototype._showMiniMapNavigationBar=function(n){var r=this,t=this._printMiniMap.getNavigationBar(),i;t?n?(t.setVisible(!0),t.setRotateButtonVisible(!1),t.setMapStyleSelectorControlVisible(!1),t.setLocateMeButtonVisible(!1),i=t.getZoomControl()?t.getZoomControl().zoomInButton:null,i&&i.getRootElement()[0].focus()):t.setVisible(!1):this._printMiniMap.navigationBarLoaded.addOne(function(){return r._showMiniMapNavigationBar(n)})},u.prototype._onPrintClick=function(n){(n.preventDefault(),this._printMapReady)&&(this.prepareForPrint(),window.print(),w.log(w.Submit,{NUM_TASKS:this.getPrintContentList().length,FLTR:this._printDisplayOption==2?w.TextOnly:this._printDisplayOption==1?w.MapOnly:w.MapAndText}),it.dialogOpenAfterPrint?this._isPrinted=!0:(this.revertPrintSetup(),this._closeDialog()))},u.prototype._onCloseClick=function(n){if(n.preventDefault(),w.log(w.Deactivate),this._isPrinted&&it.dialogOpenAfterPrint&&(this._isPrinted=!1,this.revertPrintSetup()),it.dialogOpenAfterPrint){var t=document.getElementsByName("viewport")[0];t&&t.setAttribute("content","user-scalable=no, width=device-width, maximum-scale=1.0")}this._closeDialog()},u.prototype._closeDialog=function(){var n=this.getRootElement(),t=n.getParent().select(".defaultPrintMessage");t.swap_class("hidePrintErrorMessage","showPrintErrorMessage");this._mapInteraction.setOptions({disableAllInteractions:!1});n&&(n.select(".printMap").clear(),n.select(".taskPrintContent").clear());this.onPrintDialogClose.invoke();this.CloseDialog();this.dispose()},u.prototype.prepareForPrint=function(){var t=this.getRootElement(),i=t.select(".screenNotes textarea")[0],r=t.select(".printedNotes")[0];i&&r&&(r.innerHTML=n.Internals.HTMLEncode(i.value).replace(/\n/g,"<BR>"));this._printDisplayOption==2&&(this._removeLayerPois(),t.select(".isMap").removeFromParent());n("#bingLogo").inlineDataSvgs().remove_attr("height").remove_attr("width").set_attr("viewBox","50 0 92 92")},u.prototype.revertPrintSetup=function(){var t=this.getRootElement(),n=t.select(".printedNotes")[0];n&&(n.innerHTML="")},u.prototype.dispose=function(){this._printMiniMap.dispose();this._windowSizeHandler&&(this._window.remove_event("resize",this._windowSizeHandler),this._windowSizeHandler=null);i.prototype.dispose.call(this)},u.BaseMapHeaderFooterPadding=136,u.PrintLayerPrefix="Print_",u}(bt),ti=function(){function n(t,i){this._map=t;this._taskManager=i;n.onPrintDialogClose=new f;n.onPrintDialogOpen=new f}return n.prototype.showPrintDialog=function(t){var u,r,i;t&&(ft.isFullScreen&&ft.exitFullScreen(),u=window.matchMedia("(orientation: portrait)"),it.dialogOpenAfterPrint&&u&&(r=document.getElementsByName("viewport")[0],r&&r.setAttribute("content","user-scalable=no, maximum-scale=1.0")),i=new au(this._map),i.onPrintDialogClose.addOne(function(){return n.onPrintDialogClose.invoke()}),i.onPrintDialogOpen.addOne(function(){return n.onPrintDialogOpen.invoke()}),this._createPrintContent(i,t),i.loadPrintMap(),w.log(w.Activate,{EP:t.source==1?w.TaskBar:w.TaskCardHeader,TYP:t.taskType?t.taskType:"",CD:t.data}))},n.getMapLayerById=function(n,t){for(var r=t.getLayers(),i=0;i<r.length;i++)if(n===r[i].getId())return r[i]},n.prototype._createPrintContent=function(n,t){var r,f,i;if(t.source==2&&t.taskId)r=this._taskManager.getTaskById(t.taskId),r&&r.hasPrintContent()&&n.addPrintContent(r.getPrintContent());else{var u=null,h=this._taskManager.getFocusedStack(),e=h&&h.getForegroundTask();e&&e.hasPrintContent()&&(u=e.getPrintContent(),n.addPrintContent(u));var o=new at,c=this._map.getLayers(),s=u&&u.getLayerIds();for(f=0;f<c.length;f++)if(i=c[f],i instanceof kt||i instanceof pt){if(s&&s.length>0&&s[0]===i.getId()||i.getId().indexOf("TrafficIncidents")>=0)continue;o.insert(i.getId())}o.length>0&&n.addPrintContent(new cr(null,o))}},n}(),vu=function(i){function r(){var r=this,u={};return r=i.call(this,u)||this,r._privates=u,u.defineProperty("sharingLinkAvailable",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("permalinkString",null,null,{defaultValue:t.L_Link_Generating_Text,isPrivate:!0}),u.defineProperty("isShortPermalinkDisplayed",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("errorMessage",null,null,{defaultValue:"",isPrivate:!0}),u.defineProperty("enableSharingVisibility",null,null,{defaultValue:d.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),u.defineProperty("hasAtLeastOneSharableStack",null,null,{defaultValue:!1,isPrivate:!0}),u.defineProperty("enableSocialSharing",null,null,{defaultValue:d.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),r.controlUpdated=new f,r.setTemplate(new nt(dr,{availableToLinkClass:function(n){return n?"":"nonClickable"},availableToShareButtonClass:function(n){return n?"shareButton":"shareButton nonClickable"},availableToButtonClass:function(n){return n?"textButton":" textButton nonClickable"},displayStateToLinkText:function(n){return n?t.L_LengthenButton_Text:t.L_ShortenButton_Text},errorMessageToVisibility:function(n){return n&&n.length>0?"visible":"hidden"},errorMessageToNotDisplay:function(n){return n&&n.length>0?"none":""},boolToDisplay:function(n){return n?"":"none"},boolToNotDisplay:function(n){return n?"none":""},onDlgKeydown:function(n){var t=n,i=t.keyCode||t.which;i===27&&r._rootElement.select("*[data-tag='Share.CloseButton']")[0].click()},resources:t})),r._keydownEventHandler=function(n){return r._onKeydownEvent(n)},n(".taskLayoutContainer").add_event("keydown",r._keydownEventHandler),r.rendered.addOne(function(n){var i=n||r,t;r._rootElement=i.getRootElement();t=document.execCommand&&window.clipboardData;t||r._rootElement.select("a[data-tag='Share.Copy']").set_style({visibility:"hidden"})}),r.dataContext=r,r._lvlParam="",r._cpParam="",r._setTwitterUrl(""),r._setFacebookUrl(""),r}return a(r,i),r.prototype.toggleLinkLength=function(n){this._isDisposed||(n.preventDefault(),this.getIsShortPermalinkDisplayed()?this._updateLongPermalink():this._updateShortPermalink())},r.prototype.copyToClipboard=function(n){this._isDisposed||(n.preventDefault(),this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select(),document.execCommand("Copy"))},r.prototype.openEmbedPage=function(n){if(!this._isDisposed){n.preventDefault();var t=d.embedPageUrl;this._lvlParam.length>0&&(t+="&"+this._lvlParam);this._cpParam.length>0&&(t+="&"+this._cpParam);t+="&form=LMLTEW";window.open(t,"EmbeddedMap");this._logEmbed(t)}},r.prototype.openEmail=function(n){var u=this,o,s,e,p,h,c,l,a;if(!this._isDisposed){n.preventDefault();o=t.L_Link_EmailTitleManyCards_Text;s=this._getOneCardShared();s!=null&&(o="Bing Maps: "+s.getTitle());var i="{0}\n",v=this._taskManager.getStacks(),f,r,y=0;for(e=0,p=v.length;e<p;e++)f=v[e],f&&f.getIsSelected()&&(r=f.getForegroundTask())&&(i+="{bullet}{0}\n".replace("{0}",r.getTitle()),(r.type==="LocalDetailsTask"||r.type==="PolygonEntityDetailsTask")&&(h=r.getOriginalName(),h&&(i+="{bullet}{0}\n".replace("{0}",h)),c=r.getNotes(),c&&(i+="{bullet}{0}\n".replace("{0}",c))),y++);i=i.replace(/{bullet}/g,y>1?" - ":"");i+="\n "+t.L_Link_EmailFooter_Text;l="mailto:?subject={0}&body={1}".replace("{0}",encodeURIComponent(o));a=function(){u._permalink.getCurrentLink(u._map,function(n){u._openEmail(n,l,i)},function(){window.console.log("Could not update permalink on the server, hence not showing email popup for stale content.")})};this.getIsShortPermalinkDisplayed()?this._permalink.shorten(function(n){u._openEmail(n,l,i)},a):a()}},r.prototype.openFacebook=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getFacebookUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,1))}},r.prototype.openTwitter=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getTwitterUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,2))}},r.prototype.setInitialData=function(n){n.container&&(this._container=n.container)},r.prototype.onSelectionChanged=function(n,t){if(!this._isDisposed&&this._selectedPermalinkParts&&this._selectedPermalinkParts[n]){if(this._selectedPermalinkParts[n].isEnabled=t,d.isShorteningEnabled){var i=this._permalink.isShorteningAvailable();this._privates.setEnableSharingVisibility(i?"visible":"hidden");this._privates.setEnableSocialSharing(i?"visible":"hidden")}this._updateLongPermalink()}},r.prototype.refresh=function(){var n=this;if(!this._container)throw"SharePanel cannot work without access to container";this._setState(1);this._permalink&&this._taskManager?this._recomputePanelDataAndUX():this._container.instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"},{name:"Map"},{name:"ShareDataHandler"}],function(t){n._permalink=t.Permalink;n._taskManager=t.TaskManager;n._map=t.Map;n._currentSharingOptions=t.ShareDataHandler.currentSharingOptions;t.ShareDataHandler.currentSharingOptions=null;n._permalink.getGeneralPermalink(n._map,function(){return n._recomputePanelDataAndUX()},function(){n._resetSharePanelUX();n._setState(3)},n._currentSharingOptions.entryPoint)})},r.prototype._setTwitterUrl=function(n){this._twitterUrl=n},r.prototype._getTwitterUrl=function(){return this._twitterUrl},r.prototype._setFacebookUrl=function(n){this._facebookUrl=n},r.prototype._getFacebookUrl=function(){return this._facebookUrl},r.prototype._onKeydownEvent=function(t){var i=t,f=i.keyCode||i.which,r,u;f===9&&(r=this.getFirstTabbableChild(n(".taskLayoutContainer")[0]),u=this._rootElement.select("*[data-tag='Share.Email']")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},r.prototype._trimEmailBodyIfNecessary=function(n,i,r){var u=i.replace("{0}",r),f=n.length+encodeURIComponent(u).length-3,e;return f>=k.maxIeUrlLength&&(e=f+t.L_Link_EmailFooter_Text.length+10-k.maxIeUrlLength,u=u.substr(0,u.length-e)+(" ...\n\n "+t.L_Link_EmailFooter_Text)),u},r.prototype._getOneCardShared=function(){for(var n,r=this._taskManager.getStacks(),t=null,i=0,u=r.length;i<u;i++)if(n=r[i],n&&n.getIsSelected()){if(t!=null)return null;t=n.getForegroundTask()}return t},r.prototype._recomputePanelDataAndUX=function(){var n=this;this._setState(1);this._recomputeDataModel(function(){n._resetSharePanelUX();d.isShorteningEnabled?n._updateShortPermalink():n._updateLongPermalink();var t=n._rootElement.select("*[data-tag='Share.UrlBox']")[0];t.focus();t.select()})},r.prototype.dispose=function(){i.prototype.dispose.call(this);n(".taskLayoutContainer").remove_event("keydown",this._keydownEventHandler);this._selectedPermalinkParts=null;this._taskManager=null;this._permalink=null;this._isDisposed=!0},r.prototype._recomputeDataModel=function(n){function h(n,t,i){n._permalink.getCurrentLink(n._map,function(u){var c,e,o,f,l,a,s;if(u&&u.length>=k.maxAllowedSharingLinkLength){c=n._findFarthestTaskId();n._selectedPermalinkParts[c].isEnabled=!1;h(n,!0,i);return}for(e=n._taskManager.getStacks(),o=n._taskManager.getFocusedStack(),f=0,l=e.length;f<l;f++)a=e[f].getForegroundTask().id,s=n._selectedPermalinkParts[a],e[f].setIsSelected(s&&s.isEnabled);o&&n._taskManager.focusTask(o.getForegroundTask().id);t==!0&&r.logError(u,3);i&&i()},function(){n._setState(3)})}var f,e,t,u,i,o;if(this._selectedPermalinkParts=this._permalink.getPermalinkParts(),this._currentSharingOptions&&this._currentSharingOptions.taskIds&&this._currentSharingOptions.taskIds.length>0)for(var s=Object.keys(this._selectedPermalinkParts),u=s.length,t=0;t<u;t++)f=s[t],this._currentSharingOptions.taskIds.indexOf(f)<0&&(this._selectedPermalinkParts[f].isEnabled=!1);for(e=this._taskManager.getStacks(),t=0,u=e.length;t<u;t++)i=e[t].getForegroundTask(),!i||i.isSharable()&&(i.type!=="CollectionsTask"||i.isPublicCollection())||(o=this._selectedPermalinkParts[i.id],o&&(o.isEnabled=!1));h(this,!1,n)},r.prototype._findFarthestTaskId=function(){for(var u,n=this._taskManager.getStacks(),o=this._taskManager.getFocusedStack(),e=0,t=0,s=n.length;t<s;t++)if(n[t]===o){e=t;break}for(var i=n.length-1,r=0,f=n[i].getForegroundTask().id;i>=e&&!this._selectedPermalinkParts[f]||!this._selectedPermalinkParts[f].isEnabled;)i--,f=n[i].getForegroundTask().id;for(u=n[r].getForegroundTask().id;r<=e&&!this._selectedPermalinkParts[u]||!this._selectedPermalinkParts[u].isEnabled;)r++,u=n[r].getForegroundTask().id;return t-r>i-t?u:f},r.prototype._resetSharePanelUX=function(){var u,i,t,f,r,e;if(this._privates.setHasAtLeastOneSharableStack(!1),this._rootElement.select(".svg").inlineDataSvgs().remove_class("svg"),this._setLightOrDark(this._map.getMode().mapModeType),u=this._map.getMode(),u.mapModeType===0)for(i=this._taskManager.getStacks(),t=0,f=i.length;t<f;t++)if(r=i[t],r&&(e=r.getForegroundTask())&&e.isSharable()){this._privates.setHasAtLeastOneSharableStack(!0);break}n(".taskLayoutContainer").select(".cardTitleText").set_attr("tabindex","-1")},r._getStackIndex=function(n,t,i){for(var u,r=0,f=t.length;r<f;r++)if(u=t[r],u&&(n!=null&&n==u.id||i!=null&&u.getForegroundTask().id==i))return r;return-1},r.prototype._updateLongPermalink=function(){var n=this,t;if(this._setState(1),this._selectedPermalinkParts==null){this.refresh();return}t=this._permalink.getCurrentLink(this._map,function(t){t.length>=k.maxAllowedSharingLinkLength?(n._setState(2),r.logError(t,2)):(n._privates.setPermalinkString(t),n._setTempParamValues(t),n._createSocialMediaLink(t),n._privates.setIsShortPermalinkDisplayed(!1),n._setState(0))},function(){n._setState(3);r.logError("",4)})},r.prototype._updateShortPermalink=function(){var n=this;this._currentState!=2&&(this._setState(1),this._permalink.shorten(function(t,i){n._privates.setEnableSharingVisibility("visible");n._privates.setIsShortPermalinkDisplayed(!0);n._privates.setPermalinkString(t);n._createSocialMediaLink(t);i&&n._setTempParamValues(i);n._setState(0)},function(){n._privates.setEnableSharingVisibility("hidden");n._updateLongPermalink();r.logError("",1)}))},r.prototype._setState=function(n){this._currentState=n;switch(n){case 0:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!0);this._privates.setEnableSocialSharing(d.isShorteningEnabled?"visible":"hidden");this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select();break;case 1:this._privates.setErrorMessage("");this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString(t.L_Link_Generating_Text);break;case 2:this._privates.setSharingLinkAvailable(!1);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setPermalinkString("");this._privates.setErrorMessage(t.L_Link_TooManyItemsSelected_Text);this._privates.setEnableSocialSharing("hidden");break;default:this._privates.setErrorMessage(t.L_Link_GenerationFailed_Text);this._privates.setIsShortPermalinkDisplayed(!1);this._privates.setSharingLinkAvailable(!1);this._privates.setPermalinkString("");this._privates.setEnableSocialSharing("hidden");this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()}this.controlUpdated.invoke({state:n,control:this})},r.prototype._logEmail=function(n){var t={PL:n};k.instLog(et.EC,t)},r.prototype._logEmbed=function(n){var t={PL:n};k.instLog(et.EMC,t)},r.prototype._logSocialMedia=function(n,t){var i={PL:n},r=t==1?et.FB:et.TW;k.instLog(r,i)},r.logError=function(n,t){var i={PL:n,ERR:t};k.instLog(et.SEW,i)},r.prototype._setLightOrDark=function(n){var i=!0,r=this._rootElement.select(".header"),u="dark",t;n===0&&(t=this._map.getMapType().id,i=t===y.aerial||t===y.birdseye);i?r.add_class(u):r.remove_class(u)},r.prototype._setTempParamValues=function(n){var t=/lvl=([^&]*)/ig.exec(n),i=/cp=([^&]*)/ig.exec(n),r=/style=[o|b]&/ig.exec(n);t&&t.length&&(this._lvlParam=t[0]);i&&i.length&&(this._cpParam=i[0])},r.prototype._createSocialMediaLink=function(n){var t,i;n?(t=d.twitterShareUrl.replace("{text}","").replace("{related}",encodeURIComponent("BingMaps,Bing")),this._setTwitterUrl(t.replace("{url}",encodeURIComponent(n))),i=d.facebookShareUrl.replace("{facebookpage}",encodeURIComponent(d.facebookRedirectUrl)),this._setFacebookUrl(i.replace("{url}",encodeURIComponent(n)))):this._privates.setEnableSocialSharing("hidden")},r.prototype._getPopUpOptions=function(){var n=(screen.availWidth-r._popupWidth)/2,t=(screen.availHeight-r._popupHeight)/2;return"width="+r._popupWidth+",height="+r._popupHeight+",screenX="+n+",screenY="+t+",left="+n+",top="+t+",status,scrollbars,resizable"},r.prototype._openEmail=function(n,t,i){i=this._trimEmailBodyIfNecessary(t,i,n);this._logEmail(n);window.location.href=t.replace("{1}",encodeURIComponent(i))},r._minEmbedHeight=530,r._minEmbedWidth=800,r._popupWidth=550,r._popupHeight=420,r}(ct);nt.registerControl("SharePanel",vu);var yu=function(t){function i(n,i,r,u){var f=this,e={};return f=t.call(this,gr,"shareContainer",{emailClick:function(n){return f._onEmailClick(n)},shortenClick:function(n){return f._onShortenClick(n)}},e)||this,e.defineProperty("permalinkString"),e.defineProperty("shortenButtonText"),f._permalink=u,f._map=n,f._taskManager=r,f.setPermalinkString(f.resources.L_Link_Generating_Text),f.setShortenButtonText(f.resources.L_ShortenButton_Text),f._isShortLinkDisplayed=!1,f.getRootElement().set_attr("data-tag","Share.Container"),f}return a(i,t),i.prototype._onPermalinkSuccess=function(t){d.isShorteningEnabled&&t.queryParameters?(n(".shareUrlShortenLink").add_class("visible"),this._permalinkResponse=t,this._makeShortenRequest(t)):this.setPermalinkString(t.permalink)},i.prototype._onPermalinkFail=function(){this.setPermalinkString(this.resources.L_Link_GenerationFailed_Text)},i.prototype._makeShortenRequest=function(n){var t=this,i=n.queryParameters,r;i.charAt(0)==="?"&&(i=n.queryParameters.substr(1));r=k.getShortenServiceUrl(i);sr.downloadJson(r,"sharedlg",function(n){t._shortPermalink=n.d;t._onShortenClick(null)},function(){t.setShortenButtonText(t.resources.L_ShortenButton_Text);t.setPermalinkString(t._permalinkResponse.permalink);t._isShortLinkDisplayed=!1})},i.prototype._onEmailClick=function(n){n&&n.preventDefault&&n.preventDefault();var t=this.getPermalinkString(),i={PL:t};window.location.href="mailto:?body="+encodeURIComponent(t);k.instLog(et.EC,i)},i.prototype._onShortenClick=function(n){n&&n.preventDefault&&n.preventDefault();this._isShortLinkDisplayed?(this.setPermalinkString(this._permalinkResponse.permalink),this.setShortenButtonText(this.resources.L_ShortenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):this._shortPermalink?(this.setPermalinkString(this._shortPermalink),this.setShortenButtonText(this.resources.L_LengthenButton_Text),this._isShortLinkDisplayed=!this._isShortLinkDisplayed):(this.setPermalinkString(this.resources.L_Link_Generating_Text),this._makeShortenRequest(this._permalinkResponse))},i.prototype.show=function(n){var t=this;this.OpenDialog();this._permalink.getGeneralPermalink(this._map,function(n){return t._onPermalinkSuccess(n)},function(){return t._onPermalinkFail()},n)},i}(bt),bi=function(){function n(){}return n}(),pu=function(i){function r(n,t,r,u,f){var e=this;return e=i.call(this,{},f,u)||this,e._slideOutMenu=n,e._container=t,e._map=r,e._initializeMenuItems(),e}return a(r,i),r.prototype.showMenu=function(){this._initMapTypeSelector();this.getControl().add_class("opened")},r.prototype.hideMenu=function(){this.getControl().remove_class("opened")},r.prototype.clickBackgroundHandler=function(){this.hideMenu()},r.prototype._clickHandler=function(){this.hideMenu()},r.prototype._initializeMenuItems=function(){this.menuItems=[];this._createAndAddDirectionsMenu();this._createAndAddTrafficMenu();this._createAndAddMapTypeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddSeeAllCardsMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddBingHomeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddFeedbackExitPreivewMenu()},r.prototype._createMenuSeparater=function(){var n=new bi;return n.type="menuSeparater",n},r.prototype._createMenuItem=function(n,t,i,r){var f=this,u;return i===void 0&&(i=undefined),r===void 0&&(r=!1),u=new bi,u.type="menuItem",u.name=n,u.cssClass=t,u.clickHandler=function(n){n.preventDefault();i&&i();r||f._clickHandler()},u},r.prototype._createAndAddMenuItem=function(n,t,i,r){i===void 0&&(i=undefined);r===void 0&&(r=!1);var u=this._createMenuItem(n,t,i,r);return this.menuItems.push(u),u},r.prototype._createAndAddDirectionsMenu=function(){this._createAndAddMenuItem(t.L_TaskBar_Label_Directions,"directionsMenu",function(){var n={type:s.directionsTask,state:{entryPoint:8}};o.invokeHandler(e.taskDataHandlerKey,n)})},r.prototype._createAndAddTrafficMenu=function(){var n=this;this._container.instanceAsync("TrafficLayerV2",function(t){n._trafficLayer=t;t&&n._showTrafficLayerAfterInstantiation&&t.show(4)});this._createAndAddMenuItem(t.L_TaskBar_Label_Traffic,"trafficMenu",function(){n._map.getMapType().id!==y.birdseye&&(n._trafficLayer?n._trafficLayer.toggle(4):n._showTrafficLayerAfterInstantiation=!0)})},r.prototype._createAndAddMapTypeMenu=function(){var n=this;this._createAndAddMenuItem(t.L_SlideOutMenu_MapType,"mapMenu",null,!0);this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Road,"mapTypeItem",function(){n._changeMapType(y.road)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Aerial,"mapTypeItem",function(){n._changeMapType(y.aerial)});this._createAndAddMenuItem(t.L_SlideOutMenu_MapType_Birdseye,"mapTypeItem",function(){n._changeMapType(y.birdseye)})},r.prototype._createAndAddSeeAllCardsMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_SeeAllCards,"allCardsMenu",function(){o.invokeHandler(e.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})})},r.prototype._createAndAddBingHomeMenu=function(){this._createAndAddMenuItem(t.L_SlideOutMenu_BingHome,"homeMenu",function(){window.location.href="/"})},r.prototype._createAndAddFeedbackExitPreivewMenu=function(){var i=this,r=this._createAndAddMenuItem(t.L_SlideOutMenu_Feedback,"feedbackMenu",function(){var n={type:s.feedbackTask,state:{entryPoint:5,feedbackTaskType:1,activeTaskId:null,title:t.L_SlideOutMenu_Feedback}};o.invokeHandler(e.taskDataHandlerKey,n)}),n;r.htmlId="sli_feedback";n=this._createAndAddMenuItem(t.L_SlideOutMenu_ExitPreview,"exitMenu",function(){i._slideOutMenu.exitPreview.invoke()});n.htmlId="sli_exit"},r.prototype._changeMapType=function(n){this._map.getNavigationBar().getAerialBirdsEyeTransitionManager().requestMapType(n);var t=this._map.getMapTypes()[n];if(t)this._map.setBaseLayers(t);else throw"Invalid map type id"+n;},r.prototype._initMapTypeSelector=function(){var t=this._map.getMapType().id,n=-1,i;t===y.road?n=0:t===y.aerial?(i=this._map.getNavigationBar(),n=i&&i.getAerialBirdsEyeTransitionManager().hasRequestedBirdsEye()?2:1):t===y.birdseye&&(n=2);n>=0&&this._selectMapType(n)},r.prototype._selectMapType=function(t){var i=n(".mapTypeItem");i.length==3&&(i.remove_class("selected"),n(i[t]).add_class("selected"))},r}(fi),ki=function(){function n(n,t,i){this._viewModel=new pu(this,n,t,pr,i);this.exitPreview=new f;var u=this._viewModel.getControl(),r=t.getRootElement();r.getParent().insertBefore(u,r);Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_feedback",!1,!0,!1);Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_exit",!1,!0,!1)}return n.prototype.showMenu=function(){this._viewModel.showMenu()},n}(),wu=function(){function t(n){this._rootElement=n;this.animationCompleted=new f}return t.prototype.startAnimation=function(n,t){var i=this;Microsoft.Maps.setTimeout(function(){i._startAnimationInternal(n,t)},1)},t.prototype._startAnimationInternal=function(t,i){this._capsulesList=n(".bm_cardItem",this._rootElement[0]);this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]);this._onCardChanged(t,i);this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i){t&&t.length>0&&this._capsulesList.length>=1&&n(this._capsulesList[0]).add_class("animatedOpen");i>0&&(this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),bu=function(){function r(t,i,u){var f=this;this._capsuleClicked=!1;this._taskBarViewModel=t;this._taskManager=i;this._map=u;this._taskbarConfigs=h.features.taskBar;this._nonXSRCategories=[r._categoryIdForDefaultSearchTask,r._categoryIdForAddressTask,r._categoryIdForPlaceTask,r._categoryIdForDirectionsTask,r._categoryIdForTrafficTask,r._categoryIdForMyPlacesTask,r._categoryIdForFeedbackTask,r._categoryIdForTransitTask,r._categoryIdForMeasureTask,r._categoryIdForItineraryTask];this._cardsList=new lt(50);this._taskManager.newStackListCreated.add(function(){f._onNewStacksAddedFromBrowserHistory(f._taskManager.getStacks())});this._taskManager.stackAdded.add(function(n){f._onStackAdded(n.stack,n.task)});this._taskManager.stackRemoved.add(function(n){var r=n&&n.stack,u,e,i,o,t;if(r)if(f._stackIdToBeRemovedDueToSearchFromSearchBox)for(f._stackIdToBeRemovedDueToSearchFromSearchBox=null,i=f._cardsList.convertToArray(),f._cardsList=new lt(50),o=i.length,t=o-1;t>=0;t--)i[t].getId()!==r.id&&f._cardsList.addItem(i[t].getId(),i[t]);else{if(u=f._entrypointForCloseFromCapsule?"closeFromCapsule":"closeFromCard",f._entrypointForCloseFromCapsule)for(i=f._cardsList.convertToArray(),t=0,e=i.length;t<e;t++)if(i[t].getId()===r.id){t>f._getMaxCountOnCapsuleList()&&(u="closeFromOverflow");break}f._updateCardsList(r.id,null,1,u);f._entrypointForCloseFromCapsule=!1}});this._taskManager.secondaryTaskAdded.add(function(n){var t=n&&n.stack,i;t&&(i=f._cardsList.convertToArray(),i&&i[0].getId()!==t.id&&(t.setDisplayState({isHidden:!1}),f._updateCardsList(t.id,f._getCardItem(t.id),2)))});this._taskManager.stackFocused.add(function(n){var r=n&&n.stack,t,i,u;r&&(t=f._getCardItem(r.id),i=f._cardsList.convertToArray(),i&&i.length>0&&t&&i.indexOf(t)!==0&&(u=f._taskManager.getStackById(i[0].getId()),u&&u.setDisplayState({isHidden:!0}),r&&r.setDisplayState({isHidden:!1}),f._updateCardsList(t.getId(),t,2)))});this._handleTextboxFocusAndBlurEvents();window.addEventListener("click",function(t){var i=n(t.target);i.has_class("bm_overflowCardClose")&&f._taskBarViewModel.getOverflowCapsuleListCount()>0||f._showOrHidePopout(!1)});this._cardsAnimationManager=new du(this._taskBarViewModel.getControl());this._cardsAnimationSearchInsideManager=new wu(this._taskBarViewModel.getControl());n(window).add_event("keyup",function(n){f._onEscapeEvent(n)})}return r.prototype._onEscapeEvent=function(t){var i,r;this._searchTermInsertedIntoSearchBoxFromCapsule&&(i=t,(i&&i.key&&(i.key==="Escape"||i.key==="Esc")||i.keyCode&&i.keyCode===27)&&(r=n("#maps_sb",this._taskBarViewModel.getControl()[0]),r&&r[0].blur()))},r.prototype._onNewStacksAddedFromBrowserHistory=function(n){var r=this,t,o,i,s;if(n&&n.length>0){this._previousSearchTooltipShown=!0;this._reactivateTooltipShown=!0;this._addSearchTipShown=!0;var u=[],f=0,e=function(t){var e,i,f;if(t===n.length){for(r._cardsList=new lt(50),i=0;i<u.length;i++)u[i].dispose();for(e=void 0,i=0;i<n.length;i++)f=n[i],f&&f.displayState&&!f.displayState.isHidden?e=i:r._onStackAdded(f,f.getFirstTask());typeof e!="undefined"&&r._onStackAdded(n[e],n[e].getFirstTask())}};for(t=0;t<n.length;t++)o=n[t],i=o.getFirstTask(),i?i.getPercentLoaded()===1?e(++f):(s=i.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&e(++f)}),u.push(s)):e(++f)}else this._cardsList=new lt(50),this._updateCapsuleListOnTaskBar()},r.prototype._onStackAdded=function(u,f){var e=this,o=function(){var t,s,o;e._stackIdToBeRemovedDueToSearchFromSearchBox&&e._taskManager.removeTaskStack(e._stackIdToBeRemovedDueToSearchFromSearchBox);t=e._getCardItem(u.id);t||(s=e._searchTermFromSearchBox?e._searchTermFromSearchBox:f.getTitle(),e._searchTermFromSearchBox=null,t=new gu(s,u.id),o=e._getCategory(f),e._setImageClass(o,t),e._setCardIcon(o,t),t.cardCloseHandler=function(n){e._entrypointForCloseFromCapsule=!0;e._taskManager.removeTaskStack(u.id);n.preventDefault()},t.titleClickHandler=function(n){if(i.showAdditiveSearchInsideSearchbox){e._capsuleClicked=!0;e._updateCapsuleListOnTaskBar(undefined,undefined,undefined,undefined,!0);var f=u.getFirstTask()._getTaskState&&u.getFirstTask()._getTaskState();f||(f=u.getFirstTask()._taskState);e._taskBarViewModel.setSearchTerm(f&&f.originalQuery?f.originalQuery:t.getTitle());e._taskBarViewModel.setSearchBoxFocus();e._searchTermInsertedIntoSearchBoxFromCapsule=!0;e._log({T:"CI.CapsuleExpanded",feature:r._featureName,action:"CI.CapsuleExpanded",data:null});n.preventDefault()}},t.titleMouseoverHandler=function(t){if(i.showAdditiveSearchInsideSearchbox){var r=n("#CapsuleTip",e._taskBarViewModel.getControl()[0]);r.add_class("opened");t.preventDefault()}},t.titleMouseoutHandler=function(t){if(i.showAdditiveSearchInsideSearchbox){var r=n("#CapsuleTip",e._taskBarViewModel.getControl()[0]);r.remove_class("opened");t.preventDefault()}},t.overflowTitleClickHandler=function(n){var i=e._taskManager.getStackById(t.getId()),u=e._taskManager.getFocusedStack(),f;i!==u&&(u&&u.setDisplayState({isHidden:!0}),i&&(i.displayState.cardTitleHoveringState===1&&i.setDisplayState({cardTitleHoveringState:2}),i.setDisplayState({isHidden:!1}),e._taskManager.toggleStack(i)),f=e._cardsList.convertToArray().indexOf(t),e._log({T:"CI.SearchCardReactivated",feature:r._featureName,action:"CI.SearchCardReactivated",data:{entryPoint:e._taskbarConfigs.showAdditiveSearchInsideSearchbox||f>e._getMaxCountOnCapsuleList()?"overflow":"capsule"}}));e._updateCardsList(t.getId(),t,2);n.preventDefault()},t.overflowTitleMouseoverHandler=function(n){var u=e._taskManager.getStackById(t.getId());i.showAdditiveSearchInsideSearchbox&&(u&&u.setDisplayState({cardTitleHoveringState:1}),e._log({T:"CI.CapsuleTitleHover",feature:r._featureName,action:"CI.CapsuleTitleHover",data:null}),n.preventDefault())},t.overflowTitleMouseoutHandler=function(n){var r=e._taskManager.getStackById(t.getId());i.showAdditiveSearchInsideSearchbox&&(r&&r.setDisplayState({cardTitleHoveringState:2}),n.preventDefault())},e._updateCardsList(t.getId(),t,0))},s;u&&f&&(s=this._getCardItem(u.id),s||(u.changed.add(function(n){var i,r;u.getAllTasks().length===1&&n&&n.name==="foregroundTask"&&(i=n.newValue,i&&(r=e._getCardItem(i.stackId),r&&(r.setTitle(i.getTitle()),r.setCloseTitle(t.L_RemoveFromMap),e._updateQueryTerm())))}),f.changed.add(function(n){if(n)if(n.name==="percentLoaded"&&n.newValue===1)o();else if(n.name==="title"){var r=e._getCardItem(f.stackId);r&&(i.showSearchTextOnCapsule||r.setTitle(n.newValue),r.setCloseTitle(t.L_RemoveFromMap),e._updateQueryTerm())}}),f.getPercentLoaded()===1&&o()))},r.prototype._getMaxCountOnCapsuleList=function(){return this._taskbarConfigs.showAdditiveSearchOutsideSearchbox?2:this._taskbarConfigs.showAdditiveSearchInsideSearchbox?1:this._taskbarConfigs.showReplaceSearchOutsideSearchbox?2:this._taskbarConfigs.showReplaceSearchInsideSearchbox?0:1},r.prototype._getStartingIndexOfCardOnCardsList=function(){return this._taskbarConfigs.showAdditiveSearchOutsideSearchbox?1:this._taskbarConfigs.showAdditiveSearchInsideSearchbox?0:this._taskbarConfigs.showReplaceSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchInsideSearchbox?1:0},r.prototype._getCardItem=function(n){for(var i=this._cardsList.convertToArray(),t=0,r=i.length;t<r;t++)if(i[t].getId()===n)return i[t];return null},r.prototype._updateCardsList=function(n,t,i,u){var f,s,o,h,e;if(i===0)this._cardsList.addItem(n,t);else if(i===2)this._changeMapModeOnCardSelection(),this._cardsList.getItem(n);else if(i===1)for(this._log({T:"CI.SearchCardDeleted",feature:r._featureName,action:"CI.SearchCardDeleted",data:{entryPoint:u}}),f=this._cardsList.convertToArray(),f&&f[0]&&f[0].getId()===n&&(s=f[1],s&&(o=this._taskManager.getStackById(s.getId()),o&&(o.setDisplayState({isHidden:!1}),this._taskManager.toggleStack(o)))),this._cardsList=new lt(50),h=f.length,e=h-1;e>=0;e--)f[e].getId()!==n&&this._cardsList.addItem(f[e].getId(),f[e]);this._updateCapsuleListOnTaskBar()},r.prototype._changeMapModeOnCardSelection=function(){var t=this,n=this._map.getMode(),r,i;n&&(n.mapModeType===2||n.mapModeType===3)?(r=n.getPreviousMapType()||this._map.createMapType(y.road),this._map.setMapType(r),i=n.getPreviousMode(),i?this._map.setMode(i):this._map.getContainer().instanceAsync("CompositeMapMode",function(n){t._map.setMode(n)})):this._map.getMapType().id===y.birdseyeV2&&this._map.getBirdseyeV2Manager().then(function(n){var i=t._map.getMapTypes()[n.previousMapState.mapTypeId||y.road];i&&t._map.setBaseLayers(i)})},r.prototype._updateCapsuleListOnTaskBar=function(t,i,u,f,e){var o=this,y,p,h,a;u===void 0&&(u=!0);f===void 0&&(f=!0);e===void 0&&(e=!1);typeof t=="undefined"&&(t=this._getStartingIndexOfCardOnCardsList());typeof i=="undefined"&&(i=this._getMaxCountOnCapsuleList());var c=new at,s=new at,l=this._cardsList.convertToArray(),v=0;for(h=t,a=l.length;h<a;h++)v>=i?s.insert(l[h]):e||c.insert(l[h]),v++;for(y=this._taskBarViewModel.getCapsuleList(),p=this._taskBarViewModel.getOverflowCapsuleListCount(),this._taskBarViewModel.setCapsuleList(c),this._taskBarViewModel.setOverflowCapsuleList(s),this._taskBarViewModel.getOverflowCapsuleListCount()===0&&s.length>0&&this._log({T:"CI.SearchOverflowCounter",feature:r._featureName,action:"CI.SearchOverflowCounterShown",data:null}),this._taskBarViewModel.setOverflowCapsuleListCount(s.length),s.length>10?(n(".bm_popoutTop1").add_class("scroll"),n(".bm_overflowPopout").add_class("scroll")):(n(".bm_popoutTop1").remove_class("scroll"),n(".bm_overflowPopout").remove_class("scroll")),u&&this._updateQueryTerm(),h=t,a=l.length;h<a;h++)l[h].insertIcon();this._taskbarConfigs.showAdditiveSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchOutsideSearchbox?(this._cardsAnimationManager.animationCompleted.addOne(function(){s.length>0&&o._showOrHidePreviousSearchTipOnOverflowShown(!0);c.length===1&&o._showOrHideReactivateTip(!0);!o._taskbarConfigs.showReplaceSearchOutsideSearchbox||o._reactivateTooltipShown&&o._previousSearchTooltipShown||o._showOrHideAddSearchTip(!0)}),this._cardsAnimationManager.startAnimation(y,c,p,s.length)):(this._taskbarConfigs.showAdditiveSearchInsideSearchbox||this._taskbarConfigs.showReplaceSearchInsideSearchbox)&&(this._cardsAnimationSearchInsideManager.animationCompleted.addOne(function(){f&&(o._taskbarConfigs.showAdditiveSearchInsideSearchbox&&c.length===1&&s.length>0?o._showOrHidePreviousSearchTipOnOverflowShown(!0):o._taskbarConfigs.showReplaceSearchInsideSearchbox&&s.length>0&&o._showOrHidePreviousSearchTipOnOverflowShown(!0))}),this._cardsAnimationSearchInsideManager.startAnimation(c,s.length),!this._taskbarConfigs.showReplaceSearchInsideSearchbox||this._reactivateTooltipShown&&this._previousSearchTooltipShown||this._showOrHideAddSearchTip(!0));this._showNewSearchUI();this._taskBarViewModel._adjustSearchBoxWidth()},r.prototype._showNewSearchUI=function(){var t=n(".bm_addNewSearchContainer",this._taskBarViewModel.getControl()[0]),i=this._cardsList.getCount()>=1?"block":"none";t.set_style({display:i})},r.prototype._updateQueryTerm=function(){var i=this._cardsList.convertToArray(),r;this._taskbarConfigs.showAdditiveSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchInsideSearchbox?this._taskBarViewModel.setSearchTerm(i&&i[0]?i[0].getTitle():""):this._taskbarConfigs.showAdditiveSearchInsideSearchbox&&(r=n("#maps_sb",this._taskBarViewModel.getControl()[0]),r&&r.length>0&&(this._taskBarViewModel.setSearchTerm(""),r[0].placeholder=this._taskbarConfigs.showGhostText?i&&i.length>0?t.AddAnotherSearchGhostText:t.SearchGhostText:i&&i.length>0?"":t.SearchGhostText))},r.prototype._handleTextboxFocusAndBlurEvents=function(){var i=this,u,f;this._taskbarConfigs.showAdditiveSearchInsideSearchbox?(u=n("#maps_sb",this._taskBarViewModel.getControl()[0]),u.add_event("click",function(){i._capsuleClicked||(i._showCapsuleInsideSearchboxOnOverflowPopoutHide=!1,i._updateCapsuleListOnTaskBar(0,0,!1,!1),u[0].placeholder=i._cardsList.getCount()>0?t.AddAnotherSearchGhostText:t.SearchGhostText)}),u.add_event("blur",function(){i._capsuleClicked=!1;Microsoft.Maps.setTimeout(function(){u[0].placeholder=i._taskbarConfigs.showGhostText?i._cardsList.getCount()>0?t.AddAnotherSearchGhostText:t.SearchGhostText:i._cardsList.getCount()>0?"":t.SearchGhostText;i._newSearchInitiatedFromTaskbar?i._newSearchInitiatedFromTaskbar=!1:i._overflowPopoutShown?i._showCapsuleInsideSearchboxOnOverflowPopoutHide=!0:i._updateCapsuleListOnTaskBar(undefined,undefined,!1,!1);i._searchTermInsertedIntoSearchBoxFromCapsule&&(i._taskBarViewModel.setSearchTerm(""),i._searchTermInsertedIntoSearchBoxFromCapsule=!1)},r._timeoutForHidePopout)})):(this._taskbarConfigs.showReplaceSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchInsideSearchbox)&&(f=n("#maps_sb",this._taskBarViewModel.getControl()[0]),f.add_event("blur",function(){Microsoft.Maps.setTimeout(function(){i._newSearchInitiatedFromTaskbar?i._newSearchInitiatedFromTaskbar=!1:i._changeAddNewSearchMode(!1)},r._timeoutForHidePopout)}))},r.prototype._showOrHidePopout=function(t){var i=n(".bm_overflowPopout",this._map.getRootElement().getParent()[0]).get_style("display");(t&&i==="none"||!t&&i==="block")&&(this._log({T:"CI.SearchOverflowPopout",feature:r._featureName,action:"CI.SearchOverflowPopout",data:{isShown:t}}),t&&(this._showOrHidePreviousSearchTip(!1),n(".bm_overflowBox",this._taskBarViewModel.getControl()[0]).add_class("active")),n(".bm_overflowPopout",this._taskBarViewModel.getControl()[0]).set_style({display:t?"block":"none"}),this._overflowPopoutShown=t,n(".bm_outsideBeak",this._taskBarViewModel.getControl()[0]).set_style({display:t?"block":"none"}),t||(n(".bm_overflowBox",this._taskBarViewModel.getControl()[0]).remove_class("active"),this._showCapsuleInsideSearchboxOnOverflowPopoutHide&&(this._showCapsuleInsideSearchboxOnOverflowPopoutHide=!1,this._updateCapsuleListOnTaskBar(undefined,undefined,!1,!1))))},r.prototype._showOrHideReactivateTip=function(t){var i=this;this._reactivateTooltipShown||(this._log({T:"CI.SearchReactivateTip",feature:r._featureName,action:"CI.SearchReactivateTip",data:{isShown:t}}),t?n("#ReactivateSearchTip").add_class("opened"):n("#ReactivateSearchTip").remove_class("opened"),t&&Microsoft.Maps.setTimeout(function(){i._showOrHideReactivateTip(!1);i._reactivateTooltipShown=!0},r._timeoutForTooltipHiding))},r.prototype._showOrHidePreviousSearchTipOnOverflowShown=function(n){var t=this;this._previousSearchTooltipShown||(this._log({T:"CI.PreviousSearchTip",feature:r._featureName,action:"CI.PreviousSearchTip",data:{isShown:n}}),this._showOrHidePreviousSearchTip(n),n&&Microsoft.Maps.setTimeout(function(){t._showOrHidePreviousSearchTipOnOverflowShown(!1);t._previousSearchTooltipShown=!0},r._timeoutForTooltipHiding))},r.prototype._showOrHidePreviousSearchTip=function(t){t?n("#PreviousSearchTip").add_class("opened"):n("#PreviousSearchTip").remove_class("opened")},r.prototype._showOrHideAddSearchTip=function(t){var i=this;this._addSearchTipShown||(this._log({T:"CI.AddSearchTip",feature:r._featureName,action:"CI.AddSearchTip",data:{isShown:t}}),t?n("#AddSearchTip").add_class("opened"):n("#AddSearchTip").remove_class("opened"),t&&Microsoft.Maps.setTimeout(function(){i._showOrHideAddSearchTip(!1);i._addSearchTipShown=!0},r._timeoutForTooltipHiding))},r.prototype._log=function(n){var t=Microsoft.Maps.logger;t&&t.logObject(n)},r.prototype.onSearchInvokedFromTaskbar=function(n){var t;this._newSearchInitiatedFromTaskbar=!0;this._searchTermFromSearchBox=n;this._searchTermInsertedIntoSearchBoxFromCapsule&&(t=this._cardsList.convertToArray(),t&&t.length>0&&(this._stackIdToBeRemovedDueToSearchFromSearchBox=t[0].getId()));(this._taskbarConfigs.showReplaceSearchOutsideSearchbox||this._taskbarConfigs.showReplaceSearchInsideSearchbox)&&(this._addNewSearchMode?this._changeAddNewSearchMode(!1,!1,!1):(t=this._cardsList.convertToArray(),t&&t.length>0&&(this._stackIdToBeRemovedDueToSearchFromSearchBox=t[0].getId())))},r.prototype.addNewSearchClick=function(){this._showOrHideAddSearchTip(!1);this._addSearchTipShown=!0;this._changeAddNewSearchMode(!0)},r.prototype._changeAddNewSearchMode=function(i,r,u){var f,e,o;r===void 0&&(r=!0);u===void 0&&(u=!0);this._addNewSearchMode!==i&&(this._addNewSearchMode=i,f=n("#maps_sb",this._taskBarViewModel.getControl()[0]),f&&(f[0].placeholder=i?t.AddAnotherSearchGhostText:t.SearchGhostText,e=this._cardsList.convertToArray(),o=e&&e[0]?e[0].getTitle():"",u&&this._taskBarViewModel.setSearchTerm(i?"":o),i&&f[0].focus()),r&&(i?this._updateCapsuleListOnTaskBar(0,undefined,!1,!0):this._updateCapsuleListOnTaskBar(undefined,undefined,!1,!0)))},r.prototype.overflowClick=function(n){window.clearTimeout(r._popoutHideHandler);this._overflowPopoutShown?this._showOrHidePopout(!1):this._showOrHidePopout(!0);n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation())},r.prototype.overflowMouseOver=function(n){this._overflowPopoutShown||this._showOrHidePreviousSearchTip(!0);n&&n.preventDefault()},r.prototype.overflowMouseOut=function(n){this._showOrHidePreviousSearchTip(!1);n&&n.preventDefault()},r.prototype.addSearchMouseOver=function(n){this._addSearchTipShown=!1;this._showOrHideAddSearchTip(!0);n&&n.preventDefault()},r.prototype.addSearchMouseOut=function(n){this._showOrHideAddSearchTip(!1);n&&n.preventDefault()},r.prototype.popoutMouseoverHandler=function(n){window.clearTimeout(r._popoutHideHandler);n&&n.preventDefault&&n.preventDefault()},r.prototype.popoutMouseoutHandler=function(n){var t=this;r._popoutHideHandler=Microsoft.Maps.setTimeout(function(){t._showOrHidePopout(!1)},r._timeoutForHidePopout);n&&n.preventDefault&&n.preventDefault()},r.prototype.getCardsWidth=function(){var r=179,n=i.searchBoxWidth,t=this._taskBarViewModel.getCapsuleList()?this._taskBarViewModel.getCapsuleList().length:0,u=this._taskBarViewModel.getOverflowCapsuleListCount()===0?!1:!0;return t!==0&&(t===1?n=n-r:t===2&&(n=n-r*2,u&&(n=n-44))),n},r.prototype._setImageClass=function(n,t){n&&(n.indexOf(r._categoryIdForDefaultSearchTask)>-1?t.setImageClass("maps_searchsvg"):n.indexOf(r._categoryIdForMyPlacesTask)>-1?t.setImageClass("maps_myplacessvg"):n.indexOf(r._categoryIdForPlaceTask)>-1||n.indexOf(r._categoryIdForAddressTask)>-1?t.setImageClass("maps_addresssvg"):n.indexOf(r._categoryIdForDirectionsTask)>-1?t.setImageClass("maps_carsvg"):n.indexOf(r._categoryIdForTrafficTask)>-1?t.setImageClass("maps_trafficsvg"):n.indexOf(r._categoryIdForFeedbackTask)>-1?t.setImageClass("maps_feedbacksvg"):n.indexOf(r._categoryIdForTransitTask)>-1?t.setImageClass("maps_transitpng"):n.indexOf(r._categoryIdForItineraryTask)>-1?t.setImageClass("maps_itinerarysvg"):n.indexOf(r._categoryIdForMeasureTask)>-1?t.setImageClass("maps_measurepng"):n.length>0&&t.setImageClass("category"))},r.prototype._setCardIcon=function(n,t){n&&this._nonXSRCategories.indexOf(n)===-1&&!t.getCanvas()&&this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i&&(t.setCanvas(i),t.insertIcon()))},n,null,25,25)})},r.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},r.prototype._getCategory=function(n){if(n){var t=n.type;return t===s.directionsTask||t===s.directionsFlipTask?"directions":t===s.trafficTask||t===s.trafficFlipTask?"traffic":t===s.collectionsTask?"myplaces":t===s.feedbackTask?"feedback":t===s.transitLineTask||t===s.transitStopTask||t===s.nearbyTransitTask?"transit":t===s.itineraryListingsTask||t===s.itineraryDetailsTask?"itinerary":t===s.venueMapDirectoryTask?"90892":t===s.measureMap?"measure":this._getSearchCategory(n)}return"search"},r.prototype._getSearchCategory=function(n){var i,r,u,e,o,t,f;if(n){if(i=n.viewModel,i){if(i.categoryFound)return n.viewModel.getCardCategoryId();if(r=i&&i.getEntities(),r&&r.length>-1&&(u=r[0],u)){if(e=u.getPrimaryCategoryPath(),e)return(o=ui.extractCategoryId(e,!1),!o)?"place":o;if(t=u.getSegmentTypes(),t&&t.length>0)return(f=t[0],["Place","City","Events"].indexOf(f)>-1)?"place":f.indexOf("Local")>-1?t.length>1?t[1]:"place":f}}return"place"}},r._timeoutForHidePopout=500,r._timeoutForTooltipHiding=4e3,r._featureName="SearchPrototype",r._categoryIdForDefaultSearchTask="search",r._categoryIdForPlaceTask="place",r._categoryIdForAddressTask="address",r._categoryIdForDirectionsTask="directions",r._categoryIdForTrafficTask="traffic",r._categoryIdForMyPlacesTask="myplaces",r._categoryIdForFeedbackTask="feedback",r._categoryIdForTransitTask="transit",r._categoryIdForMeasureTask="measure",r._categoryIdForItineraryTask="itinerary",r}(),ku=function(n){function r(){var u=this,o={},f,s,e,h,r;if(u=n.call(this,o)||this,o.defineProperty("categoryList"),o.defineProperty("checkCount"),o.defineProperty("dropdownButtonName"),o.defineProperty("showCreateAlertButton"),o.defineProperty("showImage"),u.setCheckCount(0),f=i.categoryLayers,s=[],f)for(e=0,h=f.length;e<h;e++){switch(f[e]){case"school":r=new ot(t.L_CategoryLayer_Schools,f[e]);r.setIcon("schoolsIcon");break;case"transit":r=new ot(t.L_CategoryLayer_Transit,f[e]);r.setIcon("transitIcon");break;case"commutability":r=new ot(t.L_CategoryLayer_Commutability,f[e]);r.setIcon("commuteIcon");break;case"coffee":r=new ot("Coffee",f[e]);break;case"grocery":r=new ot("Grocery Stores",f[e]);break;case"gasstation":r=new ot("Gas Stations",f[e]);break;case"attraction":r=new ot("Attractions",f[e])}r&&(r.onCheckedChanged.add(function(n){u._updateCheckCount(n)}),s.push(r))}return u.setCategoryList(s),u.setDropdownButtonName(t.L_CategoryLayerDropdownButton.replace("{0}","")),u.setShowCreateAlertButton(i.showCreateAlertUIForRealEstate),u.dropdownTitle=t.L_CategoryLayerDropdownTitle,u.setTemplate(new nt(wr,{boolToDisplay:function(n){return u._boolToDisplay(n)},itemCheckedClass:function(n){return u._itemCheckedClass(n)},countClassConverter:function(n){return u._countClassConverter(n)}})),u}return a(r,n),r.prototype.setRecommendedCategories=function(n){for(var t,u,i,f=this.getCategoryList(),e=n.length,r=0,o=f.length;r<o;r++){for(t=f[r],u=!1,i=0;i<e;i++)if(t.getCategory()===n[i]){t.setRecommended(!0);u=!0;break}u||t.setRecommended(!1)}},r.prototype.clearCategories=function(){for(var t=this.getCategoryList(),n=0,i=t.length;n<i;n++)t[n].setChecked(!1);this.setCheckCount(0);o.invokeHandler(e.layerManagerDataHandlerKey,{action:"removeAllLayers"})},r.prototype._countClassConverter=function(n){return n>0?"someCategoriesPadding":"noCategoriesPadding"},r.prototype._boolToDisplay=function(n){return n?"":"none"},r.prototype._itemCheckedClass=function(n){return"multiselectCheckbox"+(n?" checked":"")},r.prototype._updateCheckCount=function(n){var i=this.getCheckCount();n?i++:i--;this.setCheckCount(i);this.setDropdownButtonName(t.L_CategoryLayerDropdownButton.replace("{0}",i===0?"":"("+i+")"))},r}(ct);nt.registerControl("CategoryDropdown",ku);var ot=function(n){function t(t,i){var r=this,u={};return r=n.call(this,t,u)||this,u.defineProperty("category"),u.defineProperty("recommended"),u.defineProperty("collapseEnabled"),r.setCategory(i),r.onCheckedChanged.add(function(n){r._onCheckedChanged(n)}),r}return a(t,n),t.prototype._onCheckedChanged=function(n){n?this._makeActivateLayerRequest(this.getCategory()):this._makeRemoveLayerRequest(this.getCategory())},t.prototype._makeActivateLayerRequest=function(n){o.invokeHandler(e.layerManagerDataHandlerKey,{action:"activateLayer",category:n,entryPoint:c.TaskBar});var t={logData:{feature:rt.ShowMeCategoryLayers,action:g.Clicked,data:{Cat:n,S:!0}}};o.invokeHandler(e.instrumentationDataHandlerKey,t)},t.prototype._makeRemoveLayerRequest=function(n){o.invokeHandler(e.layerManagerDataHandlerKey,{action:"removeLayer",category:n,entryPoint:c.TaskBar});var t={logData:{feature:rt.ShowMeCategoryLayers,action:g.Clicked,data:{Cat:n,S:!1}}};o.invokeHandler(e.instrumentationDataHandlerKey,t)},t}(fr),ht=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.initialize=function(){if(!this.initialized){n(".bm_contextualAndShowMe").add_class("enabled");var t=n("#bm_categoryLayerDropdownContainer");this._categoryDropdownControl=nt.createControl("CategoryDropdown");t.append(this._categoryDropdownControl.getRootElement());t.add_class("enabled");this.initialized=!0;l._isSmallMapShownOnSerp()&&n("#MicrosoftNav").add_class("OnSerp")}},t.prototype.setRecommendedCategories=function(n){n&&n.length>0&&this.initialize();this._categoryDropdownControl&&this.initialized&&this._categoryDropdownControl.setRecommendedCategories(n)},t.prototype.clearCategories=function(){this._categoryDropdownControl&&this.initialized&&this._categoryDropdownControl.clearCategories()},t}(),du=function(){function t(n){this._rootElement=n;this.animationCompleted=new f}return t.prototype.startAnimation=function(n,t,i,r){var u=this;Microsoft.Maps.setTimeout(function(){u._startAnimationInternal(n,t,i,r)},1)},t.prototype._startAnimationInternal=function(t,i,r,u){if(this._capsulesList=n(".bm_cardItem",this._rootElement[0]),this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]),this._capsulesList.length>0&&this._overflowCounter.length>0){var o=t?t.length:0,f=i?i.length:0,e=f+u;this._onCardChanged(t,i,e)}this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i,r){var u="animatedOpen",f="animatedOpen",s=t&&t[0],h=i&&i[0],e,o;s===h&&(u="normalOpen");e=t&&t[1];o=i&&i[1];e===o&&(f="normalOpen");r===1&&this._capsulesList.length>=1?n(this._capsulesList[0]).add_class(u):r===2&&this._capsulesList.length>=2?(n(this._capsulesList[0]).add_class(u),n(this._capsulesList[1]).add_class(f)):r>2&&this._capsulesList.length>=2&&(n(this._capsulesList[0]).add_class(u),n(this._capsulesList[1]).add_class(f),this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),ii=function(){function t(){this._taskIdToContextualTaskbarMapping={}}return t.prototype.isEnabled=function(){return!0},t.prototype.initialize=function(n){this._map=n;!this._initialized&&this.isEnabled()&&(this._initialized=!0)},t.prototype.hasContent=function(){return this._currentContextualTaskbar&&this._currentContextualTaskbar.length!==0},t.prototype.getContainer=function(){return this._contextualTaskbarContainer||n("#"+this._contextualTaskBarContainerId)},t.prototype.showOrHideContainer=function(){var n=this.getContainer();n.set_style({display:this.hasContent()?"":"none"})},t.prototype.onCardFocusHandler=function(n){return this._populateTaskbar(n)},t.prototype.onCardRefreshHandler=function(n,t,i){return n&&n===i?(delete this._taskIdToContextualTaskbarMapping[i],this._populateTaskbar(t,i)):null},t.prototype.onAllTaskStacksRemovedHandler=function(){this._currentContextualTaskbar&&(this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar=null)},t.prototype.removeCurrentContextualTaskBar=function(){var n=this._currentContextualTaskbar;return this._currentContextualTaskbar&&(this.removeContextualTaskBar(this._currentTaskId),this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar=null,this._currentTaskId=null),n!==null},t.prototype.removeContextualTaskBar=function(n){delete this._taskIdToContextualTaskbarMapping[n]},t.prototype.getContextualTaskBlock=function(n){return n.select("#"+this._contextualTaskBarId)},t.prototype.handleInitialCardSetup=function(){return},t.prototype.refreshBarStyle=function(){return},t.prototype._populateTaskbar=function(t,i){var s=this,o=null;if(this._contextualTaskbarContainer=this.getContainer(),t&&this._contextualTaskbarContainer){var e=i||t.get_attr("data-taskid"),f=this.getContextualTaskBlock(t),u=this._taskIdToContextualTaskbarMapping[e],r=void 0;u?u===f||f[0]===u[0]?r=u:u.length>0&&f.length===0?r=u:u[0]!==f[0]&&(r=f):(r=f,this.handleInitialCardSetup(t));this._taskIdToContextualTaskbarMapping[e]=r;r!==this._currentContextualTaskbar&&(this._currentContextualTaskbar&&this._currentContextualTaskbar.removeFromParent(),r&&(this._currentContextualTaskbar=r,this._currentTaskId=e,o=e,this._currentContextualTaskbar.getParent()!==this._contextualTaskbarContainer&&(this._currentContextualTaskbar.removeFromParent(),this._currentContextualTaskbar.set_style({display:""})),this._contextualTaskbarContainer.append(this._currentContextualTaskbar),this.refreshBarStyle(),sj_evt.fire("filterattached")))}return n(window).add_event("resize",function(n){s._onResizeHandler(n)}),o},t.prototype._updateCategoryIconAfterDownload=function(n,t){this._selectorReady().then(function(i){i.getCategoryIconTemplate(function(n){var r=n&&n.icon,i;r&&(i=r.renderIcon(),i&&(t.clear(),t.remove_class("hidden"),t.append(i)))},n,null,25,25)})},t.prototype._selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},t.prototype._onResizeHandler=function(n){this.refreshBarStyle();n.preventDefault},t}(),di=function(r){function u(){var n=r.call(this)||this;return n.tipShown=!1,n._contextualTaskBarId="bm_categoriesBar",n._contextualTaskBarContainerId="bm_directionsTaskbarContainer",n}return a(u,r),u.getInstance=function(){return u._instance||(u._instance=new u),u._instance},u.prototype.isEnabled=function(){return i.directionsSearchEnabled},u.prototype.handleInitialCardSetup=function(){this._addXSRIcons()},u.prototype.showOrHideContainer=function(){r.prototype.showOrHideContainer.call(this);var n=this.getContainer().get_style("display"),t=n===""||n==="block";b.customSATREnabled&&(t?this.addCustomSatrTooltip():this.tipShown&&this.tooltip&&this.tooltip.removeTip())},u.prototype.refreshBarStyle=function(){this._addXSRIcons()},u.prototype.getContextualTaskBlock=function(n){return n.select("."+this._contextualTaskBarId)},u.prototype.addCustomSatrTooltip=function(){var t=null,o=null,i,s,f,r,e;ut&&ut.isEnabled()&&(t=ut.getItem(u.localStorageKey),o=ut.getItem(u.localStorageDateKey));(!t||t<b.maxSATRTipShownCount)&&(!o||Date.now()-o>u.oneDayInMilliSeconds)&&(i=n("."+this._contextualTaskBarId),i&&i.length>0&&(s=i.select(".category .attractionsIcon .bm_itemImage"),f=i.select(".category .customSatrIcon"),f&&f.length>0&&(r=n(".taskBar"),r&&r.length>0&&(e=n(r[r.length-1]),e&&e.length>0&&this._showMoreSearchesTip(e,f.getParent()[0].offsetLeft+(s.has_class("hidden")?u.xsrDelayLoadAdjustment:0),t?t:0)))))},u.prototype._addXSRIcons=function(){var e=n("."+this._contextualTaskBarId),r,i,t,u,f,o;if(e.length>0&&(r=n(".categories",e[0]),r.length>0))for(i=n(".category",r[0]),t=0;t<i.length;t++)u=n(i[t].querySelector("a")),f=u.length>0?u.get_attr("data-category"):null,f&&(o=n(".bm_itemImage",i[t]),this._updateCategoryIconAfterDownload(f,o))},u.prototype._showMoreSearchesTip=function(n,i,r){var o=this,f,e;n&&(f=new yt(null,"",[t.L_MoreSearchTip],!1,!0,!0,!1,null,b.tipShownTimeInSeconds*1e3),f.setShowClose(!1),f.setShowBeak(!0),f.tipRemoved.add(function(){o.tooltip=null}),e=f.getRootElement(),n.append(e),e.set_style({left:i}),this.tooltip&&this.tooltip.removeTip(),this.tooltip=f,this.tipShown=!0,ut&&ut.isEnabled()&&(ut.setItem(u.localStorageKey,++r),ut.setItem(u.localStorageDateKey,Date.now())))},u.localStorageKey="SatrMoreSrchTipCount",u.localStorageDateKey="SatrTipLastShown",u.oneDayInMilliSeconds=864e5,u.xsrDelayLoadAdjustment=198,u}(ii),gu=function(i){function r(n,r){var u=this,f={};return u=i.call(this,f)||this,f.defineProperty("title"),f.defineProperty("imageClass"),f.defineProperty("id"),f.defineProperty("canvas"),f.defineProperty("closeTitle"),f.defineProperty("capsuleTitle"),u.setTitle(n),u.setId(r),u.setCanvas(null),u.setCloseTitle(t.L_RemoveFromMap),u.setCapsuleTitle(t.L_EditYourSearch),u}return a(r,i),r.prototype.insertIcon=function(){var r=this.getCanvas(),i,t;r&&(i=n(document.getElementById(this.getId())),i&&i.length>0&&(t=n("#bm_cardImage",i[0]),t&&t.length>0&&(t.clear(),t.append(r))))},r}(si),yt=function(n){function i(i,r,u,e,o,s,h,c,l){var a=this,v={},p,y;return a=n.call(this,v)||this,v.defineProperty("title"),v.defineProperty("signInTitle"),v.defineProperty("messageLines"),v.defineProperty("isFaded"),v.defineProperty("isHidden"),v.defineProperty("showClose"),v.defineProperty("showBeak"),v.defineProperty("isDark"),v.defineProperty("preLink"),v.defineProperty("link"),v.defineProperty("postLink"),v.defineProperty("linkUrl"),h?u&&u.length&&(a._linkMessage=u[0],a._parseLinkMessage(),a.setLinkUrl("#")):a.setMessageLines(u),a.setTitle(r),a.setShowClose(!0),a.setShowBeak(!1),a.setIsDark(s),a.resources=t,a.tipRemoved=new f,a.signedIn=new f,a.messageLinkClicked=new f,a.tipHovered=new f,a._map=i,a._autoFadeHandlers=[],p=a._createTemplate(c),a.setTemplate(p),a._tipElement=a.getRootElement(),y=function(){window.clearTimeout(a._fadeTimeout);a._tipElement&&a.removeTip()},e||(a._map&&(a._autoFadeHandlers.push(a._map.mapPanStarted.addOne(y)),a._autoFadeHandlers.push(a._map.mapTapped.addOne(y)),a._autoFadeHandlers.push(a._map.mapZoomStarted.addOne(y))),a._fadeTimeout=Microsoft.Maps.setTimeout(function(){a._tipElement&&a.fadeTip()},l?l:4e3)),o&&(a._windowClickEventHandler=function(n){if(a&&a.rendered){var i=n.target,t=a.getRootElement();t&&t.has(i)||Microsoft.Maps.setTimeout(function(){a.removeTip()},1)}},Microsoft.Maps.setTimeout(function(){window.addEventListener("click",a._windowClickEventHandler)},1)),a}return a(i,n),i.prototype.fadeTip=function(){var n=this;this.setIsFaded(!0);Microsoft.Maps.setTimeout(function(){n.removeTip()},1e3)},i.prototype.removeTip=function(){this._tipElement&&this._tipElement.removeFromParent();this._tipElement=null;this.tipRemoved&&this.tipRemoved.invoke();this.dispose()},i.prototype.dispose=function(){window.removeEventListener("click",this._windowClickEventHandler);l._clearDisposables(this._autoFadeHandlers);n.prototype.dispose.call(this)},i.prototype._createTemplate=function(n){var t=this;return new nt(n||ou,{boolToDisplay:function(n){return t._boolToDisplay(n)},boolToNotDisplay:function(n){return t._boolToDisplay(!n)},boolToFadedClass:function(n){return t._boolToFadedClass(n)},nullToDisplayNone:function(n){return t._nullToDisplayNone(n)},closeClicked:function(n){n.preventDefault();t.removeTip()},onSignedIn:function(){t.signedIn&&t.signedIn.invoke();t.removeTip()},onTipHoverOver:function(n){n&&n.stopPropagation();n&&n.preventDefault();t.tipHovered&&t.tipHovered.invoke()},onTipHoverOut:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onLinkClicked:function(n){n&&n.stopPropagation();t.getLinkUrl()==="#"&&n&&n.preventDefault();t.messageLinkClicked&&t.messageLinkClicked.invoke();t.removeTip()}})},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._boolToFadedClass=function(n){return"bm_tooltips"+(this.getIsDark()?" dark":"")+(n?" reminderHiddenFade":"")},i.prototype._nullToDisplayNone=function(n){return n?"":"none"},i.prototype._parseLinkMessage=function(){var n=this._linkMessage,t,i,r;n&&(t=n.indexOf("<link>"),t!==-1?(i=n.slice(0,t),i&&this.setPreLink(i),n=n.substr(t).replace("<link>",""),t=n.indexOf("<\/link>"),r=n.slice(0,t),r&&this.setLink(r),n=n.substr(t).replace("<\/link>",""),n&&this.setPostLink(n)):this.setLink(n))},i}(ct),nf=function(n){function t(t,i){var r=n.call(this,null,null,[i],!0,!0,!1,!0,fu)||this;return r._privates.defineProperty("iconText",null,null,{defaultValue:t}),r.setShowClose(!1),r.setShowBeak(!0),r}return a(t,n),t}(yt),tf=function(n){function i(i,r,u){var f=this,e=[t.L_Tooltip_Itinerary_Saved_Text];return f=n.call(this,i,"",e,!1,!0,!0)||this,f.separator=" "+String.fromCharCode(183)+" ",f._privates.defineProperty("name",null,null,{defaultValue:u}),f._privates.defineProperty("showEditName",null,null,{defaultValue:!1}),f._relatedTaskId=r,f.setShowClose(!1),f.setShowBeak(!0),f}return a(i,n),i.prototype._createTemplate=function(){var n=this;return new nt(eu,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},renameClicked:function(t){t.preventDefault();n._onRenameClick()},onKeyPressed:function(t){t.keyCode===13&&n._onSaveLinkClick()},onSaveLinkClick:function(t){t.preventDefault();n._onSaveLinkClick()}})},i.prototype._onRenameClick=function(){window.clearTimeout(this._fadeTimeout);l._clearDisposables(this._autoFadeHandlers);var n=this.getRootElement().select(".nameEditBox");n&&n.length&&(n[0].value=this.getName());this.setIsDark(!1);this.setShowEditName(!0);this.setShowClose(!0);window.removeEventListener("click",this._windowClickEventHandler)},i.prototype._onSaveLinkClick=function(){var n=this.getRootElement().select(".nameEditBox"),t=n&&n.length&&n[0].value,i,r;t&&(i={action:6,title:t},r={type:s.itineraryDetailsTask,requestState:i,taskId:this._relatedTaskId},o.invokeHandler(e.taskProcessDataHandlerKey,r));this.fadeTip()},i}(yt),gi=function(t){function i(){var n=t.call(this)||this;return n._contextualTaskBarId="bm_contextualTaskbar",n._contextualTaskBarContainerId="bm_contextualTaskbarContainer",n}return a(i,t),i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype.refreshBarStyle=function(){var e=h.features.localSearch,t,r,i,u,f;e&&!e.showInlineFilters&&(t=n(".bm_filterBar"),t.length>0&&(r=t.get_attr("seg"),i=window.innerWidth,r&&r.toLowerCase().indexOf("hotel")>-1?i&&i<=1540&&i>1382?(u=n(".bm_searchSwitch",t[0]),u&&u.length>0&&t.set_style({"min-width":"1520px"})):i&&i<=1382&&(f=n(".b_filterCtrl",t[0]),f&&f.length===2?t.set_style({"min-width":"1382px"}):t.set_style({"min-width":"1280px"})):r&&r.toLowerCase().indexOf("restaurant")>-1?t.set_style({"min-width":"690px"}):t.set_style({"min-width":""})))},i}(ii),nr=function(t){function r(){var n=t.call(this)||this;return n._contextualTaskBarId="bm_relatedSearchesTaskbar",n._contextualTaskBarContainerId="bm_relatedSearchesTaskbarContainer",n}return a(r,t),r.getInstance=function(){return r._instance||(r._instance=new r),r._instance},r.prototype.isEnabled=function(){return i.relatedSearchesEnabled},r.prototype.handleInitialCardSetup=function(n){t.prototype.handleInitialCardSetup.call(this,n);this.logRelatedSearchesShownEvent(n);this.hideRecommendedSearches(n);this._getCategoryIconsForButtons()},r.prototype.refreshBarStyle=function(){this._getCategoryIconsForButtons()},r.prototype.hideRecommendedSearches=function(n){if(n&&n.length>0){var t=n.select(".bm_relatedSearchesTaskbar"),i=t.get_attr("data-keyword");i&&n.select(".searchSuggestionModule").set_style({display:"none"})}},r.prototype.logRelatedSearchesShownEvent=function(n){var f;if(n&&n.length>0){var t=n.select(".bm_relatedSearchesTaskbar"),i=t.get_attr("data-keyword"),u=t.get_attr("data-suggestions");i&&u&&(f={logData:{feature:r.featureName,action:r.actionName,data:{KEY:i,SUGG:u}},isMapsAction:!0},o.invokeHandler(e.instrumentationDataHandlerKey,f))}},r.prototype._getCategoryIconsForButtons=function(){var h=n("#bm_relatedSearchesTaskbar"),c=h.get_attr("data-categories"),t=c?c.split("~"):"",i,r,l,u,f,e,o,s;if(t&&t.length>0&&(i=n(".bm_relatedSearch",h[0]),i.length>0))for(r=0;r<t.length;r++)for(l=t[r],u=l.split("-"),f=0;f<i.length;f++)e=n(i[f]),o=e.get_attr("data-keyword").match(u[0]),o&&o.length>0&&ui.getBucketForCategory(u[1])&&(s=n(".bm_itemImage",e[0]),s.length>0&&this._updateCategoryIconAfterDownload(u[1],s))},r.featureName="RSTB",r.actionName="DSP",r}(ii),rf=function(){function t(){this._taskIdToRecommendedLayers={}}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.initialize=function(n){this._initialized||(this._map=n,this._barManagers=[],this._addToBarManager(gi.getInstance()),this._addToBarManager(nr.getInstance()),i.directionsSearchEnabled&&this._addToBarManager(di.getInstance()),this._initialized=!0,this._subscribeToTaskFocusEvent())},t.prototype._addToBarManager=function(n){n&&n.isEnabled()&&(n.initialize(this._map),this._barManagers.push(n))},t.prototype._subscribeToTaskFocusEvent=function(){var t=this;typeof sj_evt!="undefined"&&(sj_evt.bind("OnCardFocus",function(n){t.onCardFocusHandler(n&&n[1])}),sj_evt.bind("OnCardRefresh",function(n){if(n)t.onCardRefreshHandler(n[2],n[1])}),sj_evt.bind("OnAllTaskStacksRemoved",function(){t.onAllTaskStacksRemovedHandler()}),sj_evt.bind("OnTaskStackRemoved",function(n){t.onTaskStackRemovedHandler(n)}),sj_evt.bind("HideContextualTaskbar",function(){n(".bm_contextualAndShowMe").set_style({display:"none"});t.adjustElements(!0)}),sj_evt.bind("ShowContextualTaskbar",function(){n(".bm_contextualAndShowMe").set_style({display:""});t.adjustElements()}))},t.prototype.onCardFocusHandler=function(n){for(var i,r=!1,t=0;t<this._barManagers.length;t++)i=this._barManagers[t].onCardFocusHandler(n),i&&!r&&(this._currentTaskId=i,r=!0);this._promoteMapLayersInTaskBar(n);this.adjustElements()},t.prototype.onCardRefreshHandler=function(n,t){var r,i,u;if(n&&n===this._currentTaskId){for(delete this._taskIdToRecommendedLayers[this._currentTaskId],r=!1,i=0;i<this._barManagers.length;i++)u=this._barManagers[i].onCardRefreshHandler(n,t,this._currentTaskId),u&&!r&&(this._currentTaskId=u,r=!0);this._promoteMapLayersInTaskBar(t,this._currentTaskId)}this.adjustElements()},t.prototype.onAllTaskStacksRemovedHandler=function(){for(var n=0;n<this._barManagers.length;n++)this._barManagers[n].onAllTaskStacksRemovedHandler();this.adjustElements();this._currentTaskId=null;ht.getInstance().setRecommendedCategories([])},t.prototype.onTaskStackRemovedHandler=function(n){var t=n&&n[1];t&&(t.id===this._currentTaskId?this.removeCurrentContextualTaskBar():this.removeContextualTaskBar(t.id),this.adjustElements())},t.prototype.removeContextualTaskBar=function(n){for(var t=0;t<this._barManagers.length;t++)this._barManagers[t].removeContextualTaskBar(n)},t.prototype.removeCurrentContextualTaskBar=function(){for(var n=!1,t=0;t<this._barManagers.length;t++)n=this._barManagers[t].removeCurrentContextualTaskBar()||n;n&&(delete this._taskIdToRecommendedLayers[this._currentTaskId],this._currentTaskId=null,ht.getInstance().setRecommendedCategories([]))},t.prototype._promoteMapLayersInTaskBar=function(n,t){if(n){var r=t||n.get_attr("data-taskid"),i=this._taskIdToRecommendedLayers[r];i||(i=this._getMapLayers(n)||[]);ht.getInstance().setRecommendedCategories(i);this._taskIdToRecommendedLayers[r]=i}},t.prototype._getMapLayers=function(n){var r,t,i;return n&&(t=n.select("div[data-maplayers]"),t&&t.length&&(i=t.get_attr("data-maplayers"),i&&(r=i.split(",")))),r},t.prototype.adjustElements=function(t){var r,o,h,e,c,l,v,a;if(t===void 0&&(t=!1),r=!1,o=n(".toggleButton"),!t){var f=null,u=null,s=null;for(h=0;h<this._barManagers.length;h++)e=this._barManagers[h],e instanceof gi?f=e:e instanceof nr?u=e:e instanceof di&&(s=e);f&&(r=f.hasContent(),f.showOrHideContainer());u&&(c=u.hasContent(),u.showOrHideContainer(),l=u.getContainer(),!r&&c?l.add_class("relatedSearchOnly"):l.remove_class("relatedSearchOnly"),r=r||c);s&&(i.showTaskBarL2Nav?r=!1:(v=s.hasContent(),s.showOrHideContainer(),r||(f&&!f.hasContent()&&f.getContainer().set_style({display:"none"}),u&&!u.hasContent()&&u.getContainer().set_style({display:"none"})),r=r||v))}a=o&&o.getParent().has_class("slideout");r||ht.getInstance().initialized?(n(".taskLayoutContainer").add_class("WithContextualTaskBar"),n("#MicrosoftNav").add_class("WithContextualTaskBar"),a||o.add_class("noSlideout")):(n(".taskLayoutContainer").remove_class("WithContextualTaskBar"),n("#MicrosoftNav").remove_class("WithContextualTaskBar"),a||o.remove_class("noSlideout"))},t}(),ri=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("isActive"),t.defineProperty("cssClass"),t.defineProperty("dataTag"),t.defineProperty("showLabel"),t.defineProperty("popoutClass"),t.defineProperty("ariaExpanded"),i.url="#",i}return a(t,n),t}(si),ft=function(r){function u(e,o,s,c,a){var v=this,p={},w;return v=r.call(this,p,c,s)||this,p.defineProperty("searchTerm"),p.defineProperty("className"),p.defineProperty("asExpanded"),p.defineProperty("selectedSuggestionId"),p.defineProperty("isOnVertical"),p.defineProperty("capsuleList"),p.defineProperty("overflowCapsuleList"),p.defineProperty("overflowCapsuleListCount"),v._isMapsAnswer=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig&&Microsoft.Maps.GlobalConfig.isMapsAnswer,i.fullScreen=v._isMapsAnswer?!1:i.fullScreen,v._minimumActionButtonsWidth=i.minimumActionButtonsWidth,v._maxIdControlsWidth=i.maxIdControlsWidth,v._minIdControlsWidth=i.minIdControlWidth,v._searchBoxWidth=i.searchBoxWidth,v._navButtonWidth=i.navButtonWidth,v._minSearchBoxWidth=i.minSearchBoxWidth,v._searchButtonWidth=i.searchButtonWidth,v._noTextBuffer=i.taskbarTextBuffer,v._resizeBuffer=i.taskBarResizeBuffer,v._maxActionButtonsWidth=i.maximumActionButtonsWidth,v._searchBoxLeftBuffer=i.taskbarLeftBuffer,v._rightTaskbarBuffer=i.taskbarRightBuffer,v._smallSearchControlsWidth=v._minSearchBoxWidth,v._fullSearchControlsWidth=v._searchBoxWidth,v.setClassName("taskBar"),v.setSearchTerm(""),v._taskManager=a,v.taskBarItems=[],v.taskBarExtraItems=[],u._taskItems=[],v.createTaskItems(),v._map=o,u._staticMap=o,i.alwaysShowHomeWork&&v.setUpAlwaysOnPoi(),v._container=e,v.launchFeedbackMenu=new f,v.hideFeedbackMenu=new f,v.focusFeedback=new f,v.exitFullScreen=new f,v.exitFullScreen.add(function(){return u.exitFullScreen()}),v.setAsExpanded(!1),v._mouseOutPrevent=!1,v._map&&(v.disposables.push(v._map.viewChanged.add(function(){v._map.isPanning()||v.mapInteractedEvent()})),v.disposables.push(v._map.mapTapped.add(function(){return v.mapInteractedEvent()})),v.disposables.push(v._map.mapZoomStarted.add(function(){return v.mapInteractedEvent()})),v.disposables.push(v._map.primitiveTapped.add(function(){return v.mapInteractedEvent()}))),v.disposables.push(v._taskManager.stackFocused.add(function(){u.enableDirectionsSearch=!1})),sj_evt&&sj_evt.bind("identityHeaderShown",function(){Microsoft.Maps.setTimeout(function(){v._adjustSearchBoxWidth();v._showIdControls()},500)}),v._menuList=[],v._touchByPassMouseout=!1,(v._trafficItem||v.isFeatureEnabled("traffic"))&&v._container.instanceAsync("TrafficLayerV2",function(n){v._trafficLayer=n;n&&(v._showTrafficLayerAfterInstantiation&&n.show(1),v._setTrafficButtonSelected(n.getIsShowing()),v.disposables.push(v._trafficLayer.changed.add(function(n){n.name==="isShowing"&&v._setTrafficButtonSelected(n.newValue)})))}),v.resources=t,v.searchInstData=v.createInstrumentationData(u._searchFeatureName),o&&(v.disposables.push(a.stackRemoved.add(function(){a.getStacks().length===0&&(v.setSearchTerm(""),v._searchBox&&v._searchBox.focus())})),v.disposables.push(o.mapTypeChanged.add(function(n){n.newMapTypeId===y.birdseye?(v._trafficItem&&v._trafficItem.setCssClass("trafficIcon realign disabled"),v._trafficIsDisabled=!0):n.oldMapTypeId===y.birdseye&&(v._trafficIsDisabled=!1,v._trafficLayer&&v._setTrafficButtonSelected(v._trafficLayer.getIsShowing()));v._setTextAlignment(v.taskBarItems)}))),v._isMapsAnswer||v._setTextAlignment(v.taskBarItems),i.showTaskBarLabels&&(n(window).add_event("resize",function(n){v._onResizeHandler(n)}),i.fullScreen&&n(window).add_event("fullscreenChange,webkitfullscreenChange,mozfullscreenChange,msfullscreenchange,msfullscreenChange,MSFullscreenChange",function(n){v._onResizeHandler(n)})),w=i.isEnabled?"block":"none",l._isSmallMapShownOnSerp()&&(w="none"),v.getControl().set_style({display:w}),v.setIsOnVertical(h.isMapsVertical),v._isMapsAnswer&&(v.disposables.push(o.actualSizeChanged.addOne(function(){var i=n(".actions")[0],t;if(i&&(v.actionBarSize=i.getBoundingClientRect().width),t=n(".b_searchboxForm")[0],t){var r=n(".searchButton")[0],u=r?r.getBoundingClientRect().width:40,f=t.getBoundingClientRect().width-u;v._setSearchControlsWidth(n(".inputbox",v.getControl()[0])[0],f)}v._setTextAlignment(v.taskBarItems)})),v.disposables.push(o.actualSizeChanged.add(function(){v._setTextAlignment(v.taskBarItems)}))),l._isSearchPrototype()&&(v._cardsController=new bu(v,a,v._map)),v}return a(u,r),u.prototype.setSearchBox=function(t){var i=this;this._searchBox=t;n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)})},u.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!=null)this._cardsController.onSearchInvokedFromTaskbar(n)},u.prototype.overflowClick=function(n){this._cardsController.overflowClick(n)},u.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},u.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},u.prototype.addSearchMouseOver=function(n){this._cardsController.addSearchMouseOver(n)},u.prototype.addSearchMouseOut=function(n){this._cardsController.addSearchMouseOut(n)},u.prototype.dispose=function(){n(window).remove_event("keyup",this._windowEventHandler);n(window).remove_event("keyup",this.onEscapeEvent);n(window).remove_event("keydown",this._firefoxEscapeEventHandler);n(window).remove_event("fullscreenChange,webkitfullscreenChange,mozfullscreenchange,msfullscreenChange,MSFullscreenChange,msfullscreenchange",this._onResizeHandler)},u.prototype.setActionsOptions=function(i){for(var e,o,s,f=this.taskBarItems,r=0;r<f.length;r++)i===1023&&(f[r].action===8||f[r].action===256)?f[r].setIsActive(!1):(f[r].setIsActive((i&f[r].action)!=0),u.isFullScreen&&f[r].name===t.L_TaskBar_Label_Fullscreen&&(e=u._getTaskbarFullScreenButton(null),e.add_class("selected"),o=u.getMenuItem(t.L_TaskBar_Label_Fullscreen),s=n(".fullscreenIcon",o),s.add_class("selected")))},u.prototype.setActionsState=function(n,t){for(var i,o,r,e=this.taskBarItems,s=this.getControl(),f=0;f<e.length;f++)i=e[f],(n&i.action)!=0&&(o=i.getDataTag(),r=s.select('*[data-tag="'+o+'"]'),t==1?r.remove_class(u._pressedButtonClass):t==2&&r.add_class(u._pressedButtonClass),i.setCssClass(r.get_attr("class")))},u.prototype.stringify=function(t){return n.Internals.stringify(t)},u.prototype.setSearchBoxFocus=function(){if(this._searchBox)if(this._searchBox.focus(),u.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},u.prototype.mapInteractedEvent=function(){u.enableDirectionsSearch=!1;this.hideMenu()},u.prototype.hideMenu=function(){var t=this;window.clearTimeout(u._mouseOverDelayHandle);u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var i=n(".dropdownEntry",t._taskBarPopOutElement[0]),f,u,r;if(i&&i.length>0&&i[0].blur(),f=!1,u=n(".popOutTemplate",t._taskBarPopOutElement[0]),u&&u.length>0){if(u[0].querySelector(":focus")||u[0].querySelector(":hover")||u[0].querySelector(":active"))f=!0;else for(r=0;r<i.length;r++)if(i[r].parentElement.querySelector(":hover")||i[r].parentElement.querySelector(":active")||i[r].parentElement.querySelector(":focus")||i[r].querySelector(":focus")||i[r].querySelector(":hover")||i[r].querySelector(":active")){f=!0;break}f&&u.get_style("display")!=="none"||t.clearMenuElements()}},u._mouseTimeout*2);this._mouseOutPrevent=!1},u.prototype.mouseoverMenuHandler=function(t){var i=this;window.clearTimeout(u._mouseOverDelayHandle);u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"});i._initializeMenu(t)},u._mouseTimeout-100);t&&t.preventDefault&&t.preventDefault()},u.prototype.popoutMouseoverHandler=function(n){this._cardsController.popoutMouseoverHandler(n)},u.prototype.popoutMouseoutHandler=function(n){this._cardsController.popoutMouseoutHandler(n)},u.prototype.onFullScreenClick=function(i){var o=this;this._windowEventHandler||(this._windowEventHandler=function(n){return o.onEscapeEvent(n)},document.addEventListener("mozfullscreenchange",this.onEscapeEvent),document.addEventListener("webkitfullscreenchange",this.onEscapeEvent),document.addEventListener("msfullscreenChange",this.onEscapeEvent),document.addEventListener("MSFullscreenChange",this.onEscapeEvent),document.addEventListener("msfullscreenchange",this.onEscapeEvent),document.addEventListener("fullscreenchange",this.onEscapeEvent),n(window).add_event("keyup",this.onEscapeEvent));u.enableDirectionsSearch=!1;var r=u._getTaskbarFullScreenButton(i),f=u.getMenuItem(t.L_TaskBar_Label_Fullscreen),e=n(".fullscreenIcon",f),s=n("#container");r&&(r.has_class("selected")?(n(r).exit_full_screen(),r.remove_class("selected"),r[0].setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),e.remove_class("selected"),f.setAttribute("aria-label",t.L_TaskBar_Label_Fullscreen),u.isFullScreen=!1):(n(r).set_full_screen(s[0]),r.add_class("selected"),r.set_attr("aria-label",t.Taskbar_Label_ExitFullScreen),e.add_class("selected"),f.setAttribute("aria-label",t.Taskbar_Label_ExitFullScreen),u.isFullScreen=!0,u._logFullScreen(!0)),u._adjustContainerTop());i&&i.preventDefault()},u.getMenuItem=function(t){var e=n(".taskBarPopout",u._staticMap.getRootElement().getParent()[0])[0],f=n(".popOutInner",e)[0],r,i;if(f&&f.childElementCount>0)for(r=f.children,i=0;i<r.length;i++)if(r[i].innerHTML.indexOf(t)>-1)return r[i];return null},u.prototype.clearMenuElements=function(){this.hideFeedbackMenu.invoke();this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.setIsDisplayed(!1);n(".taskBarPopout",this._map.getRootElement().getParent()[0]).set_style({display:"none"});this._setMoreTaskItemState(!1)},u.prototype._setMoreTaskItemState=function(n){for(var i,t=u._taskItems.length-1;t>0;t--)if(u._taskItems[t].getCssClass().indexOf("moreIcon")>-1){i=u._taskItems[t];break}u._handleSelectedClass(i,n);i.setAriaExpanded(n)},u._handleSelectedClass=function(t,i){if(t)if(i)t.getCssClass().indexOf("selected")===-1&&t.setCssClass(t.getCssClass()+" selected");else while(t.getCssClass().indexOf("selected")>-1)t.setCssClass(t.getCssClass().replace(" selected","")),n(".moreIcon").fireEvent("blur")},u.prototype.mouseoutMenuHandler=function(n){var t=this;this._touchByPassMouseout||(window.clearTimeout(u._mouseOverDelayHandle),u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t.hideFeedbackMenu.invoke()},u._mouseTimeout));this._touchByPassMouseout=!1;n&&n.preventDefault&&n.preventDefault()},u.prototype.hoverFeedbackButton=function(){var t=n(".fullscreenMenuLink",this._taskBarPopOutElement[0]);t&&t.length>0&&t[0].parentElement.parentElement.focus()},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.nullToDisplayNone=function(n){return n?"":"none"},u.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},u.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},u.prototype.boolToHide=function(n){return n?"none":""},u.prototype.onEscapeEvent=function(n){var t=n,i=document.mozFullScreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;(t&&t.key&&(t.key==="Escape"||t.key==="Esc")||t.keyCode&&t.keyCode===27||(n.type==="mozfullscreenchange"||n.type==="webkitfullscreenchange"||n.type==="fullscreenchange"||n.type==="msfullscreenchange"||n.type==="MSFullscreenChange"||n.type==="msfullscreenChange")&&!i)&&(u.exitFullScreen(),u._logFullScreen(!1));n.preventDefault()},u.prototype.onOverlayCloseButtonClicked=function(){ht.getInstance().clearCategories();var n={logData:{feature:rt.TaskBar,action:g.Clicked,data:{FN:u._featureNameToAction.Overlay,CN:"Close"}}};h.dynamicProperties.serpIG&&(n.impressionGuid=h.dynamicProperties.serpIG);o.invokeHandler(e.instrumentationDataHandlerKey,n)},u.exitFullScreen=function(){var i=this._getTaskbarFullScreenButton(null),r=u.getMenuItem(t.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",r);i.has_class("selected")&&(n("#container").exit_full_screen(),i.remove_class("selected"),f.remove_class("selected"));u.isFullScreen=!1;u._adjustContainerTop()},u.prototype.setIconClass=function(){var f=this._getShowTaskBarItemLabel(),u=n(".actions",this.getControl()[0])[0],t,i,r;if(u&&u.style&&u.style.display!="none")if(t=n(".action"),!f&&t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&r.classList.contains("realign")&&r.classList.remove("realign");else if(t&&t.length>0)for(i=0;i<t.length;i++)r=t[i].firstElementChild,r&&!r.classList.contains("realign")&&r.classList.add("realign")},u._getTaskbarFullScreenButton=function(t){var i=t&&t.target;return i?i.className.indexOf("actionLabel")>-1?n(i.parentElement):i.className.indexOf("action")>-1?n(i.firstChild):n(i):n(".taskBar .fullScreenIcon")},u.prototype._onSearchBoxEnter=function(t){var r=t,s=r.keyCode||r.which,f,i;s===13&&(f=this._getInstData(u._searchFeatureName),o.invokeHandler(e.instrumentationDataHandlerKey,f),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},u.prototype._createTaskItemWithTaskOption=function(n,t,i,r,u){var f=new ri;return f.setCssClass(n),f.taskOption=t,f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},u.prototype.createTaskItemWithClickHandler=function(n,t,i,r,u){var e=this,f=new ri;return f.setCssClass(n),f.clickHandler=function(n){t(n);n.preventDefault();e._logEventForMapsOverlay(i)},f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},u.prototype.createTaskItemWithMouseHandlers=function(n,t,i,r,f){var o=this,e=new ri;return e.setCssClass(n),e.mouseoverHandler=function(n){window.clearTimeout(u._mouseOverDelayHandle);u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t(n)},u._mouseTimeout);n&&n.preventDefault&&n.preventDefault()},e.mouseoutHandler=function(n){o._touchByPassMouseout||(window.clearTimeout(u._mouseOverDelayHandle),u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){n.target.tagName==="A"&&(n&&n.preventDefault&&n.preventDefault(),o.hideMenu())},u._mouseTimeout));o._touchByPassMouseout=!1},e.clickHandler=function(n){(n.type==="touchend"||n.type==="pointerup")&&(o._touchByPassMouseout=!0);n&&n.preventDefault&&n.preventDefault();t(n);n.cancelBubble=!0;n.stopPropagation();o._logEventForMapsOverlay(i)},e.keydownHandler=function(n){var i=n,r=i.keyCode||i.which;r===40&&e.getCssClass().indexOf("selected")===-1&&(window.clearTimeout(u._mouseOverDelayHandle),u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){t(n)},u._mouseTimeout),n&&n.preventDefault&&n.preventDefault())},e.action=i,e.setIsActive(!0),e.setDataTag(f?f:""),e.setShowLabel(r),e.setPopoutClass("taskBarPopout"),e},u.prototype.createTaskItems=function(){if(i.showTaskBarL2Nav)this.addDirectionsItem(!1),this.addCollectionItem(!1),this.addTrafficItem(!1),this.addSharingItem(!1),this.addPrintItem(!1),this.addEmbedItem(!1),this.addfullScreenItem(!1,!0),this.addFeedbackItem(!1);else{var n=this._getShowTaskBarItemLabel();this.addDirectionsItem(n);this.addTrafficItem(n);this.addCollectionItem(n);this.addSharingItem(n);this.addMoreMenuItem(n);this.addfullScreenItem(n)}},u.prototype.addPrintItem=function(n){var s=this._taskManager,f=h.features.print,r;f&&f.isEnabled&&(r=this.createTaskItemWithClickHandler("printIcon",function(n){if(n.type!=="pointerup"){u.enableDirectionsSearch=!1;var t=u.getCurrentActiveTask(s);o.invokeHandler(e.printDataHandlerKey,{source:1,fullScreen:u.isFullScreen,taskType:t})}},4,!i.showTaskBarL2Nav&&n,"TaskBar.PrintButton"),r.name=t.L_TaskBar_Label_Print,r.instrumentationData=this.stringify(this._getMenuInstData(v.Print)),r.setIsActive(i.showTaskBarL2Nav),r.setAriaExpanded(undefined),this.taskBarItems.push(r),u._taskItems.push(r))},u.prototype.addEmbedItem=function(n){var f=this,r=this.createTaskItemWithClickHandler("embedIcon",function(n){n.type!=="pointerup"&&(f._openEmbedPage(n),f._logEventForMapsOverlay(512))},512,!i.showTaskBarL2Nav&&n,"TaskBar.EmbedButton");r.name=t.L_TaskBar_Label_Embed;r.instrumentationData=this.stringify(this._getMenuInstData(v.Embed));r.setIsActive(i.showTaskBarL2Nav);r.setAriaExpanded(undefined);this.taskBarExtraItems.push(r);u._taskItems.push(r)},u.prototype.addFeedbackItem=function(r){var e=this,f;f=this.createTaskItemWithClickHandler("feedbackIcon",function(t){if(t.type!=="pointerup"){var i=n(".feedbackIcon").parent();e.launchFeedbackMenu.invoke(i)}},0,!i.showTaskBarL2Nav&&r,"TaskBar.FeedbackButton");f.name=t.L_Menu_Feedback_Text;f.instrumentationData=this.stringify(this._getMenuInstData(v.Feedback));f.setIsActive(i.showTaskBarL2Nav);f.setAriaExpanded(undefined);this.taskBarExtraItems.push(f);u._taskItems.push(f)},u.prototype.addCollectionItem=function(n){if(this.isFeatureEnabled("collections")){var r=this.createTaskItemWithClickHandler("placesIcon realign",function(n){if(n.type!=="pointerup"){u.enableDirectionsSearch=!1;var t={entryPoint:1,action:ei.GetAllCollections},i={type:s.collectionsTask,state:t};o.invokeHandler(e.taskDataHandlerKey,i);n.preventDefault()}},2,!i.showTaskBarL2Nav&&n,"TaskBar.CollectionsButton");r.name=t.L_TaskBar_Label_Favorites;r.url="/maps/myplaces";r.instrumentationData=this.createInstrumentationData(s.collectionsTask);this.taskBarItems.push(r);u._taskItems.push(r)}},u.prototype.makeHomeWorkRequest=function(){var t={entryPoint:1,action:ei.ProcessCardlessPrimitives},i={type:s.collectionsTask,requestorType:"TaskBar",requestState:t,hiddenTask:!0},n=this._map.getFrameManager();n&&n.frameRendered&&n.frameRendered.addOne(function(){o.invokeHandler(e.taskProcessDataHandlerKey,i)})},u.prototype.setUpAlwaysOnPoi=function(){var t=this,n;l._isSmallMapShownOnSerp()?(n=function(){t.makeHomeWorkRequest();sj_evt.unbind("LargeMapShown",n)},sj_evt.bind("LargeMapShown",n)):this.makeHomeWorkRequest()},u.prototype.addSharingItem=function(n){var f=h.features.sharing,r;f&&f.isEnabled&&!f.disableOutboardSharing&&(r=this.createTaskItemWithClickHandler("shareIcon realign",function(n){n.type!=="pointerup"&&(u.enableDirectionsSearch=!1,o.invokeHandler(e.shareDataHandlerKey,{entryPoint:c.TaskBar}))},8,!i.showTaskBarL2Nav&&n,"TaskBar.ShareButton"),r.name=t.L_TaskBar_Label_Share,r.instrumentationData=this.createInstrumentationData(u._shareFeatureName),r.setIsActive(i.showTaskBarL2Nav),r.setAriaExpanded(undefined),this.taskBarItems.push(r),u._taskItems.push(r))},u.prototype.addMoreMenuItem=function(n){var r=this,i;i=this.createTaskItemWithMouseHandlers("moreIcon realign",function(n){r.mouseoverMenuHandler(n)},128,n,"Taskbar.MoreButton");i.name=t.L_TaskBar_Label_More;i.setAriaExpanded(!1);this.taskBarItems.push(i);u._taskItems.push(i)},u.prototype.addfullScreenItem=function(n,r){var e=this,f;i.fullScreen&&(f=this.createTaskItemWithClickHandler("fullScreenIcon",function(n){if(n.type!=="pointerup")e.onFullScreenClick(n)},256,!i.showTaskBarL2Nav&&n,"Taskbar.FullscreenButton"),f.name=t.L_TaskBar_Label_Fullscreen,f.setIsActive(i.showTaskBarL2Nav),f.setAriaExpanded(undefined),r?this.taskBarExtraItems.push(f):this.taskBarItems.push(f),u._taskItems.push(f))},u.prototype.addTrafficItem=function(n){var f=this,r;this.isFeatureEnabled("traffic")&&(this._trafficItem=r=this.createTaskItemWithClickHandler("trafficIcon",function(n){n.type!=="pointerup"&&(u.enableDirectionsSearch=!1,f._map.getMapType().id!==y.birdseye&&(f._trafficLayer?f._trafficLayer.toggle(1):f._showTrafficLayerAfterInstantiation=!0))},32,!i.showTaskBarL2Nav&&n,"TaskBar.TrafficButton"),r.name=t.L_TaskBar_Label_Traffic,r.url="/maps/traffic",r.setAriaExpanded(undefined),r.instrumentationData=this.createInstrumentationData(u._trafficFeatureName),this.taskBarItems.push(r),u._taskItems.push(r))},u.prototype.addDirectionsItem=function(n,r){var f=this,u;this.isFeatureEnabled("directions")&&(r?u=this._createTaskItemWithTaskOption("directionsIcon realign",{type:s.directionsTask,state:r},1,!i.showTaskBarL2Nav&&n,"TaskBar.DirectionsButton"):(u=this.createTaskItemWithClickHandler("directionsIcon realign",function(n){if(n.type!="pointerup")f.onDirectionsClick(n)},1,!i.showTaskBarL2Nav&&n,"TaskBar.DirectionsButton"),u.name=t.L_TaskBar_Label_Directions,u.url="/maps/directions",u.setAriaExpanded(undefined),u.instrumentationData=this.createInstrumentationData(s.directionsTask)),this.taskBarItems.push(u))},u.prototype.isFeatureEnabled=function(n){return h&&h.features[n]&&h.features[n].isEnabled},u.prototype.createInstrumentationData=function(n){var t=this._getInstData(n);return this.stringify(t)},u.prototype.onDirectionsClick=function(n){var t=this._taskManager.getFocusedStack()?this._taskManager.getFocusedStack().getForegroundTask():null,i,r;t&&(t.type===s.localDetailsTask||t.type===s.polygonEntityDetailsTask)&&!u.enableDirectionsSearch?(this._logDirectionsSearch(),this._getCardDetailsForDirections(t.type)):u.enableDirectionsSearch&&this._searchBox.value.length>0?(this._logDirectionsSearch(),this._getDetailsForDirections()):(i={entryPoint:1},r={type:s.directionsTask,state:i},o.invokeHandler(e.taskDataHandlerKey,r));u.enableDirectionsSearch=!1;n.preventDefault()},u.prototype._getCardDetailsForDirections=function(n){var t={searchEntitiesRequested:!0,entryPoint:c.TaskBar},i={requestorType:"TaskBar",type:n,requestState:t,useActiveTasks:!0};o.invokeHandler(e.taskProcessDataHandlerKey,i)},u.prototype._getDetailsForDirections=function(){var n={disableTaskActivate:!0,query:this._searchBox.value,noAds:!0,entryPoint:c.TaskBar},t={requestorType:"TaskBar",type:s.localDetailsTask,requestState:n,useActiveTasks:!1};o.invokeHandler(e.taskProcessDataHandlerKey,t)},u.prototype._logDirectionsSearch=function(){var n={logData:{feature:rt.TaskBar,action:g.Selected,data:{C:"DS"}}};o.invokeHandler(e.instrumentationDataHandlerKey,n)},u._logFullScreen=function(n){var t=n?"FSO":"FSE",i={logData:{feature:rt.TaskBar,action:"C",data:{FN:t}}};o.invokeHandler(e.instrumentationDataHandlerKey,i)},u.prototype._getInstData=function(n){return{logData:{feature:rt.TaskBar,action:g.Clicked,data:{FN:u._featureNameToAction[n]}}}},u.prototype._getMenuInstData=function(n){return{logData:{feature:rt.TaskBar,action:g.Clicked,data:{FN:n}}}},u.prototype._initializeMenu=function(t){var u=this,f,e,r,o;t&&t.preventDefault();f=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);f&&f.length>0&&(e=n(".feedbackPopOut")[0],e&&this._map.getRootElement().getParent().insertBefore(e,this._map.getRootElement()));this._menuList.length===0&&(r=h.features.sharing,r&&r.isEnabled&&!r.disableOutboardSharing&&this._menuList.push(this._createShareMenuItem()),this.isFeatureEnabled("print")&&this._menuList.push(this._createPrintMenuItem()),this.isFeatureEnabled("feedback")&&this._menuList.push(this._createFeedbackMenuItem()),i.fullScreen&&this._menuList.push(this._createFullscreenMenuItem()),i.embedInMoreMenu&&this._menuList.push(this._createEmbedMenuItem()));this._showDropdown(t);o=n("feedbackMenuLink");o.set_attr("aria-expanded","false");o.add_event("touchend",function(t){var i=n(".feedbackMenuLink").parent(),r;u.launchFeedbackMenu.invoke(i);r=u._map.getMode();t&&t.preventDefault&&t.preventDefault();u._touchByPassMouseout=!0});l._setFocusOnFirstMenuItem(this._taskBarPopOutElement)},u.prototype._createShareMenuItem=function(){var n=this;return{name:t.L_TaskBar_Label_Share,handler:function(){o.invokeHandler(e.shareDataHandlerKey,{entryPoint:c.TaskBar});n._setMoreTaskItemState(!1);n._logEventForMapsOverlay(8)},mouseouthandler:function(t){n.hideMenu();t&&t.stopPropagation()&&t.preventDefault()},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData(v.Share)}},u.getCurrentActiveTask=function(n){var i="",t;return n&&(t=n.getFocusedStack(),t?t.getForegroundTask()&&(i=t.getForegroundTask().type):i="BaseMap"),i},u.prototype._createPrintMenuItem=function(){var i=this,r=this._taskManager;return{name:t.L_TaskBar_Label_Print,handler:function(){var t=u.getCurrentActiveTask(r);o.invokeHandler(e.printDataHandlerKey,{source:1,fullScreen:u.isFullScreen,taskType:t});i._setMoreTaskItemState(!1);i._logEventForMapsOverlay(4);ti.onPrintDialogClose.addOne(function(){window.clearTimeout(u._mouseOverDelayHandle);u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i._setMoreTaskItemState(!0);n(".taskBarPopout",i._map.getRootElement().getParent()[0]).set_style({display:"block"});i._taskbarPopOutButtonViewModel.setIsDisplayed(!0);i._mouseOutPrevent=!0;Microsoft.Maps.setTimeout(function(){var t=n(".printMenuLink"),i=t&&t.length>0?t[0].parentElement:null;i&&i.focus()},150)},u._mouseTimeout)})},mouseouthandler:function(n){i._mouseOutPrevent||i.hideMenu();i._mouseOutPrevent=!1;n&&n.stopPropagation()&&n.preventDefault()},cssClass:"printMenuLink",iconClass:"printIcon menuLinkIcon",instData:this._getMenuInstData(v.Print)}},u.prototype._createFeedbackMenuItem=function(){var i=this;return{name:t.L_Menu_Feedback_Text,mouseoverhandler:function(){window.clearTimeout(u._submenuMouseOverDelayHandle);u._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},u._mouseTimeout)},handler:function(){var t=n(".feedbackMenuLink").parent();i.launchFeedbackMenu.invoke(t)},mouseouthandler:function(n){i._touchByPassMouseout||(window.clearTimeout(u._submenuMouseOverDelayHandle),u._submenuMouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){i.hideFeedbackMenu.invoke()},u._mouseTimeout*2));i._touchByPassMouseout=!1;n&&n.stopPropagation()&&n.preventDefault()},cssClass:"feedbackMenuLink",iconClass:"feedbackIcon menuLinkIcon",subMenu:!0,instData:this._getMenuInstData(v.Feedback)}},u.prototype._createFullscreenMenuItem=function(){var i=this,u=n(".fullScreenIcon.realign"),r="fullscreenIcon menuLinkIcon";return u.has_class("selected")&&(r+=" selected"),{name:t.L_TaskBar_Label_Fullscreen,handler:function(n){i.onFullScreenClick(n);i._setMoreTaskItemState(!1);i._logEventForMapsOverlay(256)},mouseouthandler:function(n){i.hideMenu();n&&n.stopPropagation()&&n.preventDefault()},cssClass:"fullscreenMenuLink",iconClass:r,instData:this._getMenuInstData(v.Fullscreen)}},u.prototype._createEmbedMenuItem=function(){var n=this,i=this._taskManager;return{name:t.L_TaskBar_Label_Embed,handler:function(t){n._openEmbedPage(t);n._logEventForMapsOverlay(512)},mouseouthandler:function(t){n.hideMenu();t&&t.stopPropagation()&&t.preventDefault()},cssClass:"embedMenuLink",iconClass:"embedIcon menuLinkIcon",instData:this._getMenuInstData(v.Embed)}},u.prototype._openEmbedPage=function(){if(this._map){var n=l._formatString(d.embedPageUrl,this._map.getBounds().center.latitude,this._map.getBounds().center.longitude,this._map.getMercatorZoomLevel());window.open(n,"EmbeddedMap");this._logEmbed(n)}},u.prototype._showDropdown=function(t){var e=this,i=t&&t.target,u;i.className.indexOf("actionLabel")>-1?i=t.target.parentElement.parentElement:i.className.indexOf("Icon")>-1&&(i=i.parentElement);this._taskbarDropdownViewModel?this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.getIsDisplayed()===!0&&(this._taskbarPopOutButtonViewModel.setIsDisplayed(!1),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(i)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):(this._taskbarDropdownViewModel=new yr(this._menuList,n(i)),this._taskbarPopOutButtonViewModel=new hr(this._taskbarDropdownViewModel,null,this._taskbarDropdownViewModel.taskBarListDropDownTemplate),u=this._taskbarPopOutButtonViewModel.buildPopOut(),this._taskBarPopOutElement=n(".taskBarPopout",this._map.getRootElement().getParent()[0]),this._taskBarPopOutElement.append(u));var r=i.getBoundingClientRect(),o=r.height+10,f=n(window).get_scroll_pos().x,s=window.innerHeight/window.document.documentElement.offsetHeight*100<80,h=!(f===0||s);h?(this._taskBarPopOutElement.set_style({left:r.left+f+"px"}),this._taskBarPopOutElement.set_style({right:""})):(this._taskBarPopOutElement.set_style({left:r.left+"px"}),this._taskBarPopOutElement.set_style({right:""}));this._taskBarPopOutElement.set_style({top:o+"px"});n(".taskBarPopout").add_event("keydown",function(n){e._onMenuKeyDown(n)});this._taskbarPopOutButtonViewModel.setIsDisplayed(!0)},u.prototype._showIdControls=function(){var c=n("#b_header")[0],e,s;if(c&&(e=n("#id_h",c),e.length>0)){var t=n(".id_nc",e[0]),o=t&&t.length>0&&!t.has_class("bnc-hide"),r=n("#id_sc");if(h.isMapsAnswer)s=o?this._minIdControlsWidth:r.length>0?r[0].clientWidth:0,window.innerWidth<i.taskbarButtonsShowTextWidth+s?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),r.length>0&&!r.has_class("hide")&&r.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),r.length>0&&r.has_class("hide")&&r.remove_class("hide"));else{var u=n("#id_l",e[0]),f=n("#id_rh",e[0]),s=o?this._maxIdControlsWidth:100;window.innerWidth<i.taskbarButtonsShowTextWidth+s?(u.length>0&&!u.has_class("hide")&&u.add_class("hide"),f.length>0&&!f.has_class("hide")&&f.add_class("hide"),o&&t.length>0&&!t.has_class("hide")&&t.add_class("hide")):(u.length>0&&u.has_class("hide")&&u.remove_class("hide"),f.length>0&&f.has_class("hide")&&f.remove_class("hide"),o&&t.length>0&&t.has_class("hide")&&t.remove_class("hide"))}l._isSearchPrototype()&&(this._adjustActionRightMargin(c),s=o?this._minIdControlsWidth:r.length>0?r[0].clientWidth:0,window.innerWidth<i.taskbarButtonsShowTextWidth+this._maxIdControlsWidth?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),r.length>0&&!r.has_class("hide")&&r.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),r.length>0&&r.has_class("hide")&&r.remove_class("hide")))}},u.prototype._adjustActionRightMargin=function(t){var r,f,e,o,s,u;i.showAdditiveSearchOutsideSearchbox&&(r=0,f=n("#id_h",t),f.length>0&&(e=f[0].clientWidth,r=e+(this._isMapsAnswer?10:50)+40),this._isMapsAnswer&&(o=n(".overlayCloseBtn",this.getControl()[0]),s=o[0].getBoundingClientRect().width,r+=s),u=n(".actions",this.getControl()[0])[0],u&&(u.style.cssFloat="right",u.style.marginRight=r+"px"))},u.prototype._setTextAlignment=function(n){for(var i=n,r=this._getShowTaskBarItemLabel(),t=0;t<i.length;t++)i[t].setShowLabel(r);this._adjustSearchBoxWidth();this._showIdControls()},u.prototype.addNewSearchClick=function(n){this._cardsController.addNewSearchClick(n)},u.prototype._adjustSearchBoxWidth=function(){var r=this.getControl()[0],t,u,o,e;if(r.clientWidth>0)if(t=n(".inputbox",r)[0],u=n("#taskbarPrimer")[0],u&&u.clientWidth>0)o=n(".inputbox",u)[0],this._setSearchControlsWidth(t,o.getBoundingClientRect().width);else{if(l._isSearchPrototype()){r&&(r.style.minWidth=i.taskBarMapTypeTextMinWidth+"px");(i.showAdditiveSearchOutsideSearchbox||i.showReplaceSearchOutsideSearchbox)&&this._setSearchControlsWidth(t,this._cardsController.getCardsWidth());return}if(this._isMapsAnswer&&this.actionBarSize<this._minimumActionButtonsWidth&&(this.actionBarSize=this._maxActionButtonsWidth),t){var h=n("#b_header")[0],c=n("#id_h",h),f=n(".id_nc",c[0]),a=f&&f.length>0&&!f.has_class("bnc-hide"),v=a?47:0,y=this._rightTaskbarBuffer+this._searchBoxLeftBuffer+this._navButtonWidth+this._maxActionButtonsWidth+v,p=this._fullSearchControlsWidth-this._minSearchBoxWidth,s=window.innerWidth-(this._fullSearchControlsWidth+y);s>0?this._setSearchControlsWidth(t,this._searchBoxWidth):(e=p-Math.abs(s),e<0?this._setSearchControlsWidth(t,this._minSearchBoxWidth):this._setSearchControlsWidth(t,this._minSearchBoxWidth+e))}}},u.prototype._setSearchControlsWidth=function(t,i){var u,f,r;t&&(u=38,f=n("#maps_sb",t)[0],t.setAttribute("style","width: "+i+"px"),r=n(".as_container_search",t),r&&r.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&r.set_style({width:i+"px"}))},u.prototype.insertPopoutInMap=function(){var t=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);t&&t.length!==0||(this._taskBarPopOutElement=l._createElement("div"),this._taskBarPopOutElement.set_attr("class","taskBarPopout"),this._map.getRootElement().getParent().insertBefore(this._taskBarPopOutElement[0],this._map.getRootElement()))},u.prototype._onResizeHandler=function(){var c=this._getShowTaskBarItemLabel(),o,e,r,s,u,t,h,f;for(this._showIdControls(),this._setTextAlignment(this.taskBarItems),o=this.taskBarItems,e=0;e<o.length;e++)o[e].setShowLabel(c);if(this.setIconClass(),l._isLargeMapShownOnSerp()||l._isTravelOverlayShownOnSerp()){if(r=document.getElementById("b_header"),s=window.innerWidth,r)if(u=n(".id_button",r),s<=i.taskBarMapTypeTextMinWidth)if(i.showAdditiveSearchOutsideSearchbox)n("#id_h",r[0]).set_style({display:"none"}),this._adjustActionRightMargin(r);else for(t=0;t<u.length;t++)u[t].style.padding="0";else for(i.showAdditiveSearchOutsideSearchbox&&(n("#id_h",r[0]).set_style({display:""}),this._adjustActionRightMargin(r)),t=0;t<u.length;t++)u[t].removeAttribute("style");h=document.getElementsByTagName("html")[0];f=n(".b_footer.b_slimFoot.bm_oneMap")[0];s<=i.windowMinWidth?(h.style.overflowX="auto",f&&(f.style.zIndex="1001")):(h.style.overflowX="hidden",f&&f.removeAttribute("style"))}},u._adjustContainerTop=function(){var t=n("#container")[0];u.isFullScreen&&(t.style.top="0",t.style.bottom="0")},u.prototype._onMenuKeyDown=function(t){var s=this,o=t,r=o.keyCode||o.which,i,f,e;r===9?this.hideMenu():r===37?this.clearMenuElements():r===13||r===39?(i=t.target,i.className.indexOf("dropdownEntry")>-1&&(i=i.children[0],i&&(i=i.children[0])),i.className.indexOf("feedback")>-1&&this.launchFeedbackMenu.invoke(n(".feedbackMenuLink").parent()),window.clearTimeout(u._mouseOverDelayHandle),u._mouseOverDelayHandle=Microsoft.Maps.setTimeout(function(){s.focusFeedback.invoke()},u._mouseTimeout*2)):r===40?(f=t.target.nextElementSibling,f&&n(f)[0].focus()):r===38&&(e=t.target.previousElementSibling,e?n(e)[0].focus():this.clearMenuElements())},u.prototype._setTrafficButtonSelected=function(t){var i=n(".trafficIcon")[0];i&&(t&&!i.classList.contains("selected")?i.classList.add("selected"):!t&&i.classList.contains("selected")&&i.classList.remove("selected"));this._trafficIsSelected=t},u.prototype._getShowTaskBarItemLabel=function(){return this._searchBoxWidth==null?!1:i.showTaskBarLabels&&!i.showTaskBarL2Nav&&window.innerWidth>i.taskbarButtonsShowTextWidth+(l._isLargeMapShownOnSerp()?50:0)},u.prototype._logEventForMapsOverlay=function(n){var i=h.dynamicProperties.serpIG,t;h.features.localSearch.sendMoreInstrumentationForOverlay&&i&&(t=Microsoft.Maps.logger,t&&t.logObject({T:"CI.OverlayTaskBarClick",feature:"MapsOverlay",action:"CI.OverlayTaskBarClick",data:{AN:n}},i,!1))},u.prototype._logEmbed=function(n){var t={PL:n};k.instLog(et.EMC,t)},u._shareFeatureName="Share",u._searchFeatureName="Search",u._trafficFeatureName="Traffic",u._fullscreenFeatureName="Fullscreen",u._embedFeatureName="Embed",u._overlayFeatureName="Overlay",u._taskbarStyleSet="",u._taskbarStyle="",u._mouseTimeout=150,u._featureNameToAction=function(){var n={};return n[s.collectionsTask]=v.Collections,n[s.directionsTask]=v.Directions,n[u._shareFeatureName]=v.Share,n[u._searchFeatureName]=v.Search,n[u._trafficFeatureName]=v.Traffic,n[u._fullscreenFeatureName]=v.Fullscreen,n[u._embedFeatureName]=v.Embed,n[u._overlayFeatureName]=v.Overlay,n}(),u.hiddenStyle={visibility:"hidden"},u.visibleStyle={visibility:"visible"},u._pressedButtonClass="pressed",u._fullScreenModalDialogContentTemplate='<div class="fullscreenEscape"><p>{escText}<\/p><\/div>',u.isFullScreen=!1,u}(fi),uf=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,u,f)||this;return e._slideOutMenuItem&&t.instanceAsync("SlideOutMenu",function(n){e._slideOutMenu=n}),e}return a(t,n),t.prototype.createTaskItems=function(){var i=this,n;this.addDirectionsItem(!1,{entryPoint:1});this.isFeatureEnabled("slideOutMenu")&&(this._slideOutMenuItem=n=this.createTaskItemWithClickHandler("slideOutIcon",function(){i._slideOutMenu&&i._slideOutMenu.showMenu()},64,!1,"TaskBar.SlideOutMenu"),n.instrumentationData=this.createInstrumentationData(t._slideOutMenuFeatureName),this.taskBarItems.push(n))},t._slideOutMenuFeatureName="SlideOutMenu",t}(ft),ff=function(){function u(t,r,u,e){var o=this,l=this._getTemplate(),a,s,c;if(l)this._taskManager=e,this._viewModel=this._CreateTaskBarViewModel(t,r,l,u,this._taskManager),a=this._viewModel.getControl(),this._map=r,this._controlTemplateFactory=u,s=r.getRootElement(),this.feedbackInitialize=new f,this._viewModel.launchFeedbackMenu.add(function(n){o.feedbackInitialize.invoke(n)}),this.dismissMenu=new f,this.dismissMenu.add(function(){o._viewModel.hideMenu()}),this.dismissFeedbackMenu=new f,this.focusFeedbackMenu=new f,this._viewModel.focusFeedback.add(function(){o.focusFeedbackMenu.invoke()}),this._viewModel.hideFeedbackMenu.add(function(){o.dismissFeedbackMenu.invoke()}),this.hoverFeedbackButton=new f,this.hoverFeedbackButton.add(function(){o._viewModel.hoverFeedbackButton()}),this.exitFullScreen=new f,this.exitFullScreen.add(function(){o._viewModel.exitFullScreen.invoke()}),this._visibilityChangedEvent=new f,this._visibilityChangedEvent.add(function(n){o._viewModel.setAsExpanded(n)}),this._selectionChangedEvent=new f,this._selectionChangedEvent.add(function(n){o._viewModel.setSelectedSuggestionId(n)}),this._map.mapTapped.add(function(){o._searchBox&&o._searchBox.blur()}),s.getParent().insertBefore(a,s),c=n("#maps_sb"),this._viewModel.setIconClass(),this._viewModel._adjustSearchBoxWidth(),c.length>0&&(this._searchBox=c[0],this._viewModel.setSearchBox(this._searchBox)),n(".searchIcon").add_event("click",function(n){o.handleSearchButtonEvents(n)}),h.features.autosuggest.isEnabled&&(this._suggestionItemSelected=new f,this._suggestionItemSelected.add(function(n){o._onSuggestionItemSelected(n)}),this._suggestionItemClicked=new f,this._suggestionItemClicked.add(function(n){o._onSuggestionItemClicked(n)}),this._onAutosuggestKeydown=new f,this._onAutosuggestKeydown.add(function(n){o.onAutosuggestKeydownFunction(n)}),this._clickHandler=new f,this._clickHandler.add(function(){o.handleClick()}),b.customSATREnabled&&!b.isSDK&&(this._onAutosuggestBlur=new f,this._onAutosuggestBlur.add(function(n){o.onAutosuggestBlurHandler(n)}))),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_exit",!1,!0,!1),this._viewModel.insertPopoutInMap(),this.fullScreenEnabled=i.fullScreen;else throw"Template is not defined!";this._clearSuggestions=!1;i.showCategoryLayers&&ht.getInstance().initialize();rf.getInstance().initialize(this._map);ni.initialize(this._map,this._taskManager)}return u.prototype.initializeAutosuggest=function(){var r=n("#maps_sb_container"),u=n("#maps_sb"),t=new ar,i;this._searchBoxAutosuggestDataModel=t;this._autosuggestViewModel=new rr(t,this._controlTemplateFactory,!0,"TaskBarSearch",this._visibilityChangedEvent,this._selectionChangedEvent);i="as_container_search";this._autosuggest=new ur(r,u,i,this._autosuggestViewModel,this._map);this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown);this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected);this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked);this._autosuggest.setClickEventHandler(this._clickHandler);b.customSATREnabled&&!b.isSDK&&this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur)},u.prototype.handleSearchButtonEvents=function(n){ft.enableDirectionsSearch=!1;this._autosuggest&&this._autosuggest.instrumentSearchButtonClickEvent();var t=this._autosuggestViewModel&&this._autosuggestViewModel.getSelectedSuggestion(),i=t?c.Autosuggest:c.SearchButton;this._performSearch(i,t);n&&n.preventDefault&&n.preventDefault()},u.prototype.handleClick=function(){ft.enableDirectionsSearch=!0;this._autosuggest&&this._autosuggest.refreshAutosuggest();this._clearSuggestions&&(ft.enableDirectionsSearch=!1,this._clearSuggestions=!1,this._searchBox&&this._searchBox.removeAttribute("placeholder"),this._searchBoxAutosuggestDataModel.clearDefaultSuggestions())},u.prototype.onAutosuggestKeydownFunction=function(n){var r=n,u=r.keyCode||r.which,t,i;u==13&&(ft.enableDirectionsSearch=!1,i=c.SearchBox,this._autosuggestViewModel&&(t=this._autosuggestViewModel.getSelectedSuggestion()),t&&(i=c.Autosuggest),this._performSearch(i,t))},u.prototype.processCallback=function(n){var t,i,r,u,f,h;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===s.localDetailsTask||n.processorType===s.polygonEntityDetailsTask)&&(t={entryPoint:1},i=n.inData.requestState,i&&(i.searchEntitiesRequested||i.disableTaskActivate)&&n.outData&&n.outData.length>0&&(r=this._getEventTime(n.outData),r&&(u={dateTime:r,timeType:vr.arrival}),f=this._getWaypoint(n.outData),f&&(t.waypoints=[f],u&&(t.options=u))),h={type:s.directionsTask,state:t},o.invokeHandler(e.taskDataHandlerKey,h))},u.prototype._getTemplate=function(){return i.showTaskBarL2Nav?nu:i.showAdditiveSearchOutsideSearchbox?uu:i.showAdditiveSearchInsideSearchbox?ru:i.showReplaceSearchInsideSearchbox?iu:i.showReplaceSearchOutsideSearchbox?tu:pi},u.prototype._getWaypoint=function(n){var u=null,i,r,f,t;if(n.length>1||n[0]&&n[0].processorId){for(i=0;i<n.length;i++)if(n[i]&&n[i].data&&(r=n[i],f=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===f&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&!t.isApproximateLocation))){u=new vi(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5);break}}else n[0]&&n[0]&&n[0].data.entities&&n[0].data.entities.length>0&&(t=n[0].data.entities[0],t&&!t.isApproximateLocation&&(u=new vi(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,5)));return u},u.prototype._getEventTime=function(n){var f,i,u,e,t,o,s;if(n[0]&&n[0]&&n[0].data&&n[0].data.length==1)for(i=0;i<n.length;i++)n[i]&&n[i].data&&(u=n[i],e=u.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===e&&(t=u.data&&u.data.length>0?u.data[0]:null,t&&t.id&&t.id.indexOf("event")>-1&&(o=r.GlobalConfig.features.localSearch.eventPreArrivalTime,t.getDateTime&&t.getDateTime()&&(s=new Date(t.getDateTime()),f=t.getDateTime()+t.getUtcOffset()*6e4-o*6e4))));return f},u.prototype._onSuggestionItemSelected=function(n){this.getSearchTerm()===n.searchText&&this._searchBox&&(this._searchBox.value=n.searchText);this.setSearchTerm(n.searchText)},u.prototype._onSuggestionItemClicked=function(n){this._performSearch(c.Autosuggest,n)},u.prototype.onAutosuggestBlurHandler=function(){var n=this;this._routePoints&&(this._searchBox&&this._searchBox.setAttribute("placeholder",""),Microsoft.Maps.setTimeout(function(){n._routePoints=null;n._searchBoxAutosuggestDataModel.clearDefaultSuggestions();n._autosuggest&&n._autosuggest.setIsSearchAlongRoute(!1)},2e3))},u.prototype._performSearch=function(n,r){var v=this,l=this._searchBox?this._searchBox.value.trim():this._viewModel.getSearchTerm().trim(),u,f,p,w,a,k;if(i.showSearchTextOnCapsule)this._viewModel.onSearchInvokedFromTaskbar(r&&r.searchText?r.searchText:l);else this._viewModel.onSearchInvokedFromTaskbar(null);if(this._autosuggest&&this._autosuggest.stopAutosuggest(),u={},u.query=l,n!==c.Autosuggest&&(u.originalQuery=l),u.entryPoint=n,u.asConversationId=this._autosuggest&&this._autosuggest.getConversationId(),r&&(this.setSearchTerm(r.searchText),u.query=r.searchText,u.fullQuery=r.searchText,u.filterUrlParam=r.entityId,u.mapBounds=r.mapBounds,r.type==="Favorite"?(!r.entityId&&r.location&&(u.query=r.location.latitude+","+r.location.longitude,u.fullQuery=u.query),u.taskTitle=r.alternateName||r.name,u.asName=r.name,u.asFormattedAddress=r.formatedAddress):(u.asName=r.formatedLine1,u.asFormattedAddress=r.formatedLine2)),f=this._map.getMode(),f&&(f.mapModeType===2||f.mapModeType===3)&&l?(p=f.getPreviousMapType(),this._map.setMapType(p),w=f.getPreviousMode(),this._map.setMode(w),this.setActionsOptions(1023)):this._map.getMapType().id===y.birdseyeV2&&l&&this._map.getBirdseyeV2Manager().then(function(n){var t=v._map.getMapTypes()[n.previousMapState.mapTypeId||y.road];t&&v._map.setBaseLayers(t)}),a=h.features,r&&r.title===t.L_SearchNearbyTransit&&a&&a.transit&&a.transit.isEnabled){k={location:st.getMapCenter(this._map),title:this._nearbyLocationTitle,entryPoint:1};o.invokeHandler(e.taskDataHandlerKey,{state:k,type:s.nearbyTransitTask});return}b.customSATREnabled&&!b.isSDK&&this._routePoints&&this._routePoints.length>0&&(u.keyRoutePoints=this._routePoints,u.entryPoint=c.CategoriesBar,u.isCustomSatrSearch=!0,u.disableComputingMapViewForLoadingOnly=!0,u.forceDisableMicroPoi=!0,u.directionsTaskId=this._directionsTaskId,this.logSatrSearchRequest(this.getSearchTerm()));o.invokeHandler(e.taskProcessDataHandlerKey,{requestState:u,type:s.localSearchTask})},u.prototype.setActionsOptions=function(n){this._viewModel.setActionsOptions(n)},u.prototype.setActionsState=function(n,t){this._viewModel.setActionsState(n,t)},u.prototype.setSearchTerm=function(n,t){this._viewModel.setSearchTerm(n);t&&o.invokeHandler(e.taskProcessDataHandlerKey,{type:s.localSearchTask,requestState:{query:n}})},u.prototype.getSearchTerm=function(){return this._viewModel.getSearchTerm()},u.prototype.setSearchBoxFocus=function(){this._viewModel.setSearchBoxFocus()},u.prototype.getSearchBox=function(){return n(this._searchBox)},u.prototype.setSearchBoxGhostText=function(n){this._searchBox&&(this.setSearchTerm(""),this._searchBox.setAttribute("placeholder",n),this.setSearchBoxFocus(),this._clearSuggestions=!0)},u.prototype.updateSearchBoxAutosuggestDefault=function(n,t,i,r){b.customSATREnabled&&!b.isSDK&&i&&(this._routePoints=i,this._directionsTaskId=r,this._autosuggest&&this._autosuggest.setIsSearchAlongRoute(i&&i.length>0));this._searchBoxAutosuggestDataModel.updateDefaultSuggestions(n,t);this._autosuggest&&this._autosuggest.refreshAutosuggest()},u.prototype.setNearbyLocationTitle=function(n){this._nearbyLocationTitle=n},u.prototype._CreateTaskBarViewModel=function(n,t,i,r,u){return h.isMobile?new uf(n,t,pi,r,u):new ft(n,t,this._getTemplate(),r,u)},u.prototype.logSatrSearchRequest=function(n){var t={logData:{feature:rt.TaskBar,action:g.Submitted,data:{Q:n,TYP:"SATR"}}};o.invokeHandler(e.instrumentationDataHandlerKey,t)},u}();r.TaskBar=ff;u.SharingDialogViewModel=yu;u.PrintManager=ti;u.SlideOutMenu=typeof ki!="undefined"?ki:undefined;u.BirdsEyeV2DialogViewModel=typeof wi!="undefined"?wi:undefined;u.CommutabilityControl=su;u.CommutabilityControlV2=cu;u.CommutabilityControlOverlay=hu;u.CommutabilityControlV2Overlay=lu;u.UserTipControl=yt;u.SaveSuccessTipControl=tf;u.SaveOnSerpConfirmationTip=nf}catch(tr){if(r.logger)r.logger.logCriticalError(tr);else throw tr;}}).call(window)